import{r as n,u as $,k as U,e as S,an as I,ao as T,j as e,t as _,ak as R,p as E,ap as z}from"./index-BDAcJp4Y.js";const L=n.createContext(),M=()=>n.useContext(L);function K({children:l}){const{pop:s}=$(),{token:m,user:a}=U(),[o,f]=n.useState([]),[i,y]=n.useState(null),[j,h]=n.useState([]),[k,w]=n.useState(!1),[d,p]=n.useState(!0),b=n.useRef(null),t=n.useCallback(r=>{r.chat_room_id===i&&(h(c=>[...c,r]),b.current&&b.current.emit("mark_chat_as_read",{roomId:r.chat_room_id,messageId:r.id})),f(c=>c.some(g=>g.roomId===r.chat_room_id)?c.map(g=>{if(g.roomId===r.chat_room_id){const A=r.chat_room_id===i,D=r.sender_id===(a==null?void 0:a.id)||A?0:(g.unreadCount||0)+1;return{...g,lastMessage:r.content,unreadCount:D,roomUpdatedAt:new Date().toISOString()}}return g}).sort((g,A)=>new Date(A.roomUpdatedAt)-new Date(g.roomUpdatedAt)):(s("Bạn có cuộc trò chuyện mới từ khách hàng!","s"),typeof x=="function"&&x(),c))},[i,a==null?void 0:a.id,s]),x=n.useCallback(async()=>{if(m){p(!0);try{const r=await S.get("/admin/agent/chats");r.data.success&&f(r.data.data)}catch{s("Không thể tải danh sách cuộc trò chuyện.","e")}finally{p(!1)}}},[m,s]);n.useEffect(()=>{if(!m||!(a!=null&&a.id))return;const r=I();return b.current=r,T(m),x(),r.on("new_chat_message",t),()=>r.off("new_chat_message",t)},[m,a==null?void 0:a.id,t,x]);const u=n.useCallback(r=>{if(!i||!a)return!1;a.id,r.trim(),new Date().toISOString(),a.id,a.name,a.avatar;const c={roomId:i,content:r.trim(),senderId:a.id};return b.current.emit("send_chat_message",c),!0},[i,a]),v=n.useCallback(async r=>{if(r!==i){y(r),h([]),w(!0);try{const c=await S.get(`/admin/agent/chats/${r}`);c.data.success&&h(c.data.data.messages||[])}catch(c){s("Không thể tải tin nhắn: "+c.message,"e"),y(null)}finally{w(!1)}f(c=>c.map(C=>C.roomId===r?{...C,unreadCount:0}:C))}},[i,s]),N={chatList:o,activeChatId:i,messages:j,isLoading:k,isListLoading:d,selectChat:v,sendMessage:u,currentUser:a};return e.jsx(L.Provider,{value:N,children:l})}const O=()=>e.jsx("div",{className:"p-2 sm:p-4 space-y-3",children:[...Array(8)].map((l,s)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-xl animate-pulse",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-600 dark:to-gray-700"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 sm:w-4 sm:h-4 bg-gray-200 dark:bg-gray-600 rounded-full border-2 border-white dark:border-gray-800"})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-600 rounded-lg w-20 sm:w-24"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-600 rounded w-8 sm:w-12"})]}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-600 rounded w-24 sm:w-32"})]})]},s))}),V=l=>{if(!l)return"";const s=new Date(l),a=(new Date-s)/(1e3*60*60);return a<24?s.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):a<168?s.toLocaleDateString("vi-VN",{weekday:"short"}):s.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit"})};function H(){const{chatList:l,activeChatId:s,selectChat:m,isListLoading:a}=M();return a?e.jsxs("div",{className:"w-full sm:w-80 md:w-96 lg:w-80 xl:w-96 bg-white dark:bg-gray-800 border-r border-gray-100 dark:border-gray-700 flex flex-col",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-gray-100 dark:border-gray-700 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-700",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-200 dark:bg-gray-600 rounded animate-pulse"}),e.jsx("div",{className:"h-5 sm:h-6 bg-gray-200 dark:bg-gray-600 rounded w-24 sm:w-32 animate-pulse"})]})}),e.jsx(O,{})]}):e.jsxs("div",{className:"w-full sm:w-80 md:w-96 lg:w-80 xl:w-96 bg-white dark:bg-gray-800 border-r border-gray-100 dark:border-gray-700 flex flex-col",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-gray-100 dark:border-gray-700 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-700 sticky top-0 z-10",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-1.5 sm:p-2 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(_,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-800 dark:text-gray-200",children:"Trò chuyện"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[l.length," cuộc hội thoại"]})]})]})}),e.jsx("div",{className:"overflow-y-auto flex-grow custom-scrollbar",children:l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 sm:p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mb-4",children:e.jsx(_,{className:"w-6 h-6 sm:w-8 sm:h-8 text-gray-400 dark:text-gray-500"})}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium text-sm sm:text-base",children:"Chưa có cuộc trò chuyện nào"}),e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-xs sm:text-sm mt-1",children:"Các tin nhắn mới sẽ hiển thị tại đây"})]}):e.jsx("div",{className:"p-1 sm:p-2 space-y-1",children:l.map(o=>e.jsxs("div",{onClick:()=>m(o.roomId),className:`group p-2 sm:p-3 cursor-pointer transition-all duration-200 rounded-xl border-2 ${o.roomId===s?"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 border-blue-200 dark:border-blue-600 shadow-md transform scale-[1.02]":"border-transparent hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:shadow-sm hover:scale-[1.01]"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:o.customerAvatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(o.customerName)}&background=4f46e5&color=ffffff&bold=true&size=48`,alt:"Avatar",className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover border-2 border-white dark:border-gray-600 shadow-sm"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 sm:w-4 sm:h-4 bg-green-400 rounded-full border-2 border-white dark:border-gray-800 shadow-sm"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-gray-800 dark:text-gray-200 truncate group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:o.customerName}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 flex-shrink-0 ml-2",children:[o.lastMessageTime&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(R,{className:"w-3 h-3"}),e.jsx("span",{children:V(o.lastMessageTime)})]}),o.unreadCount>0&&e.jsx("span",{className:"bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs font-bold rounded-full h-4 min-w-[1rem] sm:h-5 sm:min-w-[1.25rem] px-1 flex items-center justify-center shadow-lg animate-pulse",children:o.unreadCount>99?"99+":o.unreadCount})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-sm truncate flex-1 mr-2",children:o.lastMessage||"Chưa có tin nhắn"})})]})]}),o.isTyping&&e.jsxs("div",{className:"flex items-center space-x-2 mt-2 pl-12 sm:pl-15",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"đang nhập..."})]})]},o.roomId))})}),e.jsx("style",{jsx:!0,children:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #e5e7eb;
          border-radius: 2px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #4b5563;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #d1d5db;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #6b7280;
        }
      `})]})}const P=()=>e.jsx("div",{className:"flex-1 p-4 sm:p-6 space-y-4 sm:space-y-6 animate-pulse",children:[...Array(5)].map((l,s)=>e.jsx("div",{className:`flex ${s%2===0?"justify-start":"justify-end"}`,children:e.jsxs("div",{className:`flex items-end space-x-2 max-w-xs ${s%2===0?"":"flex-row-reverse space-x-reverse"}`,children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-gray-200 dark:bg-gray-600"}),e.jsxs("div",{className:`p-2 sm:p-3 rounded-2xl ${s%2===0?"bg-gray-200 dark:bg-gray-600":"bg-blue-200 dark:bg-blue-700"}`,children:[e.jsx("div",{className:"h-3 sm:h-4 bg-gray-300 dark:bg-gray-500 rounded w-20 sm:w-24 mb-1"}),e.jsx("div",{className:"h-2 sm:h-3 bg-gray-300 dark:bg-gray-500 rounded w-12 sm:w-16"})]})]})},s))}),G=({timestamp:l})=>{const s=m=>m?new Date(m).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):"";return e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 ml-2 flex-shrink-0",children:s(l)})};function B(){const{messages:l,activeChatId:s,sendMessage:m,currentUser:a,isLoading:o,chatList:f}=M(),[i,y]=n.useState(""),[j,h]=n.useState(!1),k=n.useRef(null),w=n.useRef(null),d=s?f.find(t=>t.roomId===s):null;n.useEffect(()=>{var t;(t=k.current)==null||t.scrollIntoView({behavior:"smooth"})},[l]),n.useEffect(()=>{var t;s&&((t=w.current)==null||t.focus())},[s]);const p=()=>{i.trim()&&(m(i.trim()),y(""),h(!1))},b=t=>{y(t.target.value),j||(h(!0),setTimeout(()=>h(!1),1e3))};return s?e.jsxs("div",{className:"flex-1 flex flex-col bg-white dark:bg-gray-800",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-gray-100 dark:border-gray-700 bg-gradient-to-r from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:(d==null?void 0:d.customerAvatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent((d==null?void 0:d.customerName)||"User")}&background=4f46e5&color=ffffff&bold=true&size=40`,alt:"Avatar",className:"w-8 h-8 sm:w-10 sm:h-10 rounded-full object-cover border-2 border-white dark:border-gray-600 shadow-sm"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 bg-green-400 rounded-full border border-white dark:border-gray-800"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-gray-800 dark:text-gray-200",children:(d==null?void 0:d.customerName)||"Khách hàng"}),e.jsx("p",{className:"text-xs text-green-500 dark:text-green-400 font-medium",children:"Đang hoạt động"})]})]})})}),o?e.jsx(P,{}):e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar bg-gradient-to-b from-gray-50/50 to-white dark:from-gray-700/50 dark:to-gray-800",children:e.jsxs("div",{className:"p-3 sm:p-4 space-y-3 sm:space-y-4",children:[l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 sm:py-12 text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-blue-100 dark:bg-blue-900/50 rounded-full flex items-center justify-center mb-4",children:e.jsx(_,{className:"w-6 h-6 sm:w-8 sm:h-8 text-blue-500 dark:text-blue-400"})}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium text-sm sm:text-base",children:"Cuộc trò chuyện mới"}),e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-xs sm:text-sm mt-1",children:"Gửi tin nhắn đầu tiên để bắt đầu"})]}):l.map((t,x)=>{const u=t.sender_id===a.id,v=l[x-1],N=!v||v.sender_id!==t.sender_id,r=!l[x+1]||l[x+1].sender_id!==t.sender_id;return e.jsxs("div",{className:`group flex items-end gap-2 ${u?"justify-end":"justify-start"}`,children:[!u&&e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 flex-shrink-0",children:N&&e.jsx("img",{src:(d==null?void 0:d.customerAvatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent((d==null?void 0:d.customerName)||"User")}&background=e5e7eb&color=6b7280&size=32`,alt:"Avatar",className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full object-cover"})}),e.jsxs("div",{className:"flex flex-col max-w-xs sm:max-w-md lg:max-w-lg",children:[e.jsx("div",{className:`relative px-3 py-2 sm:px-4 sm:py-2 ${u?"bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-2xl rounded-br-md":"bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-600 shadow-sm rounded-2xl rounded-bl-md"} transition-all duration-200 hover:shadow-md`,children:e.jsx("p",{className:"text-sm leading-relaxed break-words",children:t.content})}),e.jsxs("div",{className:`flex items-center mt-1 ${u?"justify-end":"justify-start"}`,children:[e.jsx(G,{timestamp:t.created_at}),u&&e.jsxs("div",{className:"flex space-x-1 ml-2",children:[e.jsx("div",{className:"w-1 h-1 bg-gray-400 dark:bg-gray-500 rounded-full opacity-60"}),e.jsx("div",{className:"w-1 h-1 bg-blue-500 dark:bg-blue-400 rounded-full"})]})]})]}),u&&e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 flex-shrink-0",children:N&&e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center",children:e.jsx(E,{className:"w-3 h-3 sm:w-4 sm:h-4 text-white"})})})]},t.id)}),e.jsx("div",{ref:k})]})}),j&&e.jsx("div",{className:"px-3 sm:px-4 py-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("img",{src:(d==null?void 0:d.customerAvatar)||`https://ui-avatars.com/api/?name=${encodeURIComponent((d==null?void 0:d.customerName)||"User")}&background=e5e7eb&color=6b7280&size=24`,alt:"Avatar",className:"w-5 h-5 sm:w-6 sm:h-6 rounded-full object-cover"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"đang nhập..."})]})}),e.jsx("div",{className:"p-3 sm:p-4 border-t border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-end space-x-2 sm:space-x-3",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{ref:w,className:"w-full p-2.5 sm:p-3 pr-10 sm:pr-12 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent transition-all duration-200 placeholder-gray-400 dark:placeholder-gray-500 text-gray-800 dark:text-gray-200 text-sm sm:text-base",placeholder:"Nhập tin nhắn...",value:i,onChange:b,onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),p())},rows:1,style:{minHeight:"40px",maxHeight:"120px"}})}),e.jsx("button",{className:`p-2.5 sm:p-3 rounded-xl transition-all duration-200 flex-shrink-0 ${i.trim()?"bg-gradient-to-r from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700 shadow-lg hover:shadow-xl transform hover:scale-105":"bg-gray-100 dark:bg-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed"}`,onClick:p,disabled:!i.trim(),children:e.jsx(z,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})}),e.jsx("style",{jsx:!0,children:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #e5e7eb;
          border-radius: 3px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #4b5563;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #d1d5db;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #6b7280;
        }

        textarea {
          field-sizing: content;
        }

        @media (max-width: 640px) {
          .custom-scrollbar::-webkit-scrollbar {
            width: 3px;
          }
        }
      `})]}):e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center bg-gradient-to-br from-gray-50 to-blue-50 p-8",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(_,{className:"w-10 h-10 text-blue-500"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:"Chào mừng đến với Admin Chat"}),e.jsx("p",{className:"text-gray-500 leading-relaxed",children:"Chọn một cuộc trò chuyện từ danh sách bên trái để bắt đầu hỗ trợ khách hàng. Tất cả tin nhắn sẽ được hiển thị tại đây."}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-400 mt-6",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{children:"Sẵn sàng hỗ trợ"})]})]})})}function F(){return e.jsx(K,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800",children:e.jsx("div",{className:"h-screen flex p-2 sm:p-4",children:e.jsxs("div",{className:"flex w-full max-w-full lg:max-w-7xl mx-auto bg-white dark:bg-gray-800 shadow-xl lg:shadow-2xl rounded-lg lg:rounded-2xl overflow-hidden border border-gray-200/50 dark:border-gray-700/50",children:[e.jsx(H,{}),e.jsx(B,{})]})})})})}export{F as default};
