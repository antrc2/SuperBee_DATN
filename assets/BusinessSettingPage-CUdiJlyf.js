import{u as I,r as c,j as e,o as U,X as S,q as M,M as q,t as G,F as D,e as P}from"./index-BDAcJp4Y.js";import{S as A}from"./square-pen-DBBk7FQ3.js";import{S as H}from"./save-DMv6XSqM.js";import{M as B}from"./mail-DmgTA-FO.js";const X=()=>{const{pop:j}=I(),[t,w]=c.useState(!1),[C,_]=c.useState(!0),[l,L]=c.useState({id:1,shop_name:"",slogan:"",logo_url:"",favicon_url:"",phone_number:"",email:"",address:"",zalo_link:"",facebook_link:"",template_name:"default",auto_post:!1,auto_transaction:!1,auto_post_interval:60}),[i,h]=c.useState(l),[k,b]=c.useState(null),[N,f]=c.useState(null),[d,y]=c.useState(null),[g,v]=c.useState(null),$=c.useRef(null),E=c.useRef(null);c.useEffect(()=>{(async()=>{_(!0);try{const s=await P.get("/admin/business_settings");if(s.data.status&&s.data.data){const r=Array.isArray(s.data.data)?s.data.data[0]:s.data.data,o={...r,auto_post:!!r.auto_post,auto_transaction:!!r.auto_transaction,shop_name:r.shop_name||"",template_name:r.template_name||"default"};L(o),h(o),b(r.logo_url?{image_url:r.logo_url}:null),f(r.favicon_url?{image_url:r.favicon_url}:null),y(null),v(null)}else console.error("error:",s.data.message),j(s.data.message||"Không thể tải dữ liệu cấu hình")}catch(s){console.error("Error:",s),j("Có lỗi xảy ra khi tải dữ liệu: "+s.message)}finally{_(!1)}})()},[]),c.useEffect(()=>()=>{d&&URL.revokeObjectURL(d.preview),g&&URL.revokeObjectURL(g.preview)},[d,g]);const F=()=>{w(!0),h({...l}),b(l.logo_url?{image_url:l.logo_url}:null),f(l.favicon_url?{image_url:l.favicon_url}:null),y(null),v(null)},T=()=>{w(!1),h(l),b(l.logo_url?{image_url:l.logo_url}:null),f(l.favicon_url?{image_url:l.favicon_url}:null),y(null),v(null)},V=async()=>{var a,s;_(!0);try{if(!i.shop_name)throw new Error("Tên cửa hàng là bắt buộc.");if(!i.template_name)throw new Error("Template là bắt buộc.");if(!k&&!d)throw new Error("Vui lòng chọn một ảnh logo.");if(!N&&!g)throw new Error("Vui lòng chọn một ảnh favicon.");const r=new FormData;Object.entries(i).forEach(([n,p])=>{n!=="id"&&n!=="logo_url"&&n!=="favicon_url"&&(n==="auto_post"||n==="auto_transaction"?r.append(n,p?1:0):p!=null&&p!==""&&r.append(n,p))}),d?r.append("logo_url",d):k&&r.append("keep_image_logo","1"),g?r.append("favicon_url",g):N&&r.append("keep_image_favicon","1");for(let[n,p]of r.entries())console.log(`FormData: ${n} = ${p}`);r.append("_method","put");const o=await P.post("/admin/business_settings",r,{headers:{"Content-Type":"multipart/form-data"}});if(o.data.status){const n={...o.data.data,auto_post:!!o.data.data.auto_post,auto_transaction:!!o.data.data.auto_transaction};L(n),h(n),b(n.logo_url?{image_url:n.logo_url}:null),f(n.favicon_url?{image_url:n.favicon_url}:null),y(null),v(null),w(!1),j(o.data.message||"Cập nhật thành công")}else throw new Error(o.data.message||"Cập nhật thất bại")}catch(r){console.error("Error updating config:",r),j("Có lỗi xảy ra: "+(((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.message)||r.message))}finally{_(!1)}},u=(a,s)=>{let r=s;a==="auto_post"||a==="auto_transaction"?r=s:a==="auto_post_interval"&&(r=parseInt(s)||60),h(o=>({...o,[a]:r}))},O=(a,s)=>{if(!s)return;const r=Object.assign(s,{preview:URL.createObjectURL(s)});a==="logo_url"?(y(r),b(null),h(o=>({...o,logo_url:""}))):a==="favicon_url"&&(v(r),f(null),h(o=>({...o,favicon_url:""})))},R=a=>{a==="logo_url"?(d&&URL.revokeObjectURL(d.preview),y(null),b(null),h(s=>({...s,logo_url:""}))):a==="favicon_url"&&(g&&URL.revokeObjectURL(g.preview),v(null),f(null),h(s=>({...s,favicon_url:""})))},z=[{value:"default",label:"Mặc định"},{value:"modern",label:"Hiện đại"},{value:"classic",label:"Cổ điển"},{value:"minimal",label:"Tối giản"}],m="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300",x="w-full p-2.5 bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500";return C?e.jsx(U,{}):e.jsx("div",{className:"font-sans bg-slate-50 dark:bg-gray-900 min-h-screen p-4 sm:p-6 lg:p-8",children:e.jsx("div",{className:"flex",children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Cấu hình Website"}),e.jsx("p",{className:"mt-1 text-md text-gray-600 dark:text-gray-400",children:"Quản lý thông tin cơ bản của website"})]}),t?e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:T,className:"w-full sm:w-auto inline-flex justify-center items-center py-3 px-6 border border-transparent shadow-sm text-base font-medium rounded-lg text-white bg-gray-500 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:focus:ring-offset-gray-900 transition-colors",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Hủy"]}),e.jsxs("button",{onClick:V,disabled:C,className:"w-full sm:w-auto inline-flex justify-center items-center py-3 px-6 border border-transparent shadow-sm text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-blue-400 disabled:cursor-not-allowed dark:focus:ring-offset-gray-900 transition-colors",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),C?"Đang lưu...":"Cập nhật"]})]}):e.jsxs("button",{onClick:F,className:"w-full sm:w-auto inline-flex justify-center items-center py-3 px-6 border border-transparent shadow-sm text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900 transition-colors",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Chỉnh sửa"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 p-6 bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h3",{className:"mb-6 text-lg font-semibold text-gray-900 dark:text-white",children:"Thông tin cơ bản"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:m,children:"Tên cửa hàng *"}),e.jsx("input",{type:"text",value:t?i.shop_name:l.shop_name,onChange:a=>u("shop_name",a.target.value),readOnly:!t,className:`${x} ${t?"":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,placeholder:"Ví dụ: Cửa hàng ABC"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:m,children:"Slogan"}),e.jsx("input",{type:"text",value:t?i.slogan:l.slogan,onChange:a=>u("slogan",a.target.value),readOnly:!t,className:`${x} ${t?"":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,placeholder:"Ví dụ: Chất lượng hàng đầu"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:m,children:[e.jsx(M,{className:"w-4 h-4 inline mr-1 text-gray-600 dark:text-gray-400"}),"Số điện thoại"]}),e.jsx("input",{type:"tel",value:t?i.phone_number:l.phone_number,onChange:a=>u("phone_number",a.target.value),readOnly:!t,className:`${x} ${t?"":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,placeholder:"Ví dụ: 0123 456 789"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:m,children:[e.jsx(B,{className:"w-4 h-4 inline mr-1 text-gray-600 dark:text-gray-400"}),"Email"]}),e.jsx("input",{type:"email",value:t?i.email:l.email,onChange:a=>u("email",a.target.value),readOnly:!t,className:`${x} ${t?"":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,placeholder:"Ví dụ: contact@example.com"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:m,children:[e.jsx(q,{className:"w-4 h-4 inline mr-1 text-gray-600 dark:text-gray-400"}),"Địa chỉ"]}),e.jsx("input",{type:"text",value:t?i.address:l.address,onChange:a=>u("address",a.target.value),readOnly:!t,className:`${x} ${t?"":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,placeholder:"Ví dụ: 123 Đường ABC, Quận 1, TP.HCM"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:m,children:[e.jsx(G,{className:"w-4 h-4 inline mr-1 text-gray-600 dark:text-gray-400"}),"Link Zalo"]}),e.jsx("input",{type:"url",value:t?i.zalo_link:l.zalo_link,onChange:a=>u("zalo_link",a.target.value),readOnly:!t,className:`${x} ${t?"":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,placeholder:"https://zalo.me/..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:m,children:[e.jsx(D,{className:"w-4 h-4 inline mr-1 text-gray-600 dark:text-gray-400"}),"Link Facebook"]}),e.jsx("input",{type:"url",value:t?i.facebook_link:l.facebook_link,onChange:a=>u("facebook_link",a.target.value),readOnly:!t,className:`${x} ${t?"":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,placeholder:"https://facebook.com/..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Template *"}),e.jsx("select",{value:t?i.template_name:l.template_name,onChange:a=>u("template_name",a.target.value),disabled:!t,className:`${x} ${t?"":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:z.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Khoảng thời gian tự động đăng (phút)"}),e.jsx("input",{type:"number",min:"1",max:"1440",value:t?i.auto_post_interval:l.auto_post_interval,onChange:a=>u("auto_post_interval",parseInt(a.target.value)),readOnly:!t,className:`${x} ${t?"":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"}`,placeholder:"Ví dụ: 60"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"auto_post",checked:t?i.auto_post:l.auto_post,onChange:a=>u("auto_post",a.target.checked),disabled:!t,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"}),e.jsx("label",{htmlFor:"auto_post",className:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-200",children:"Tự động đăng bài"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"auto_transaction",checked:t?i.auto_transaction:l.auto_transaction,onChange:a=>u("auto_transaction",a.target.checked),disabled:!t,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"}),e.jsx("label",{htmlFor:"auto_transaction",className:"ml-2 text-sm font-medium text-gray-900 dark:text-gray-200",children:"Tự động xử lý giao dịch"})]})]})]})]}),e.jsxs("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h3",{className:"mb-6 text-lg font-semibold text-gray-900 dark:text-white",children:"Hình ảnh"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:m,children:"Logo"}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml",ref:$,onChange:a=>O("logo_url",a.target.files[0]),disabled:!t,className:"hidden"}),k||d?e.jsxs("div",{className:"relative group w-full aspect-square border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden",children:[e.jsx("img",{src:d?d.preview:k.image_url,alt:"Logo Preview",className:"w-full h-full object-contain"}),t&&e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{type:"button",onClick:()=>$.current.click(),className:"text-white text-sm bg-gray-800 bg-opacity-70 py-1 px-3 rounded-md mr-2",children:"Thay đổi"}),e.jsx("button",{type:"button",onClick:()=>R("logo_url"),className:"absolute top-2 right-2 bg-black/60 text-white rounded-full p-1",children:e.jsx(S,{size:16})})]})]}):e.jsxs("div",{onClick:()=>t&&$.current.click(),className:`flex flex-col items-center justify-center w-full aspect-square border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition ${t?"":"opacity-70 cursor-not-allowed"}`,children:[e.jsx(ImagePlus,{size:40,className:"text-gray-400 dark:text-gray-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.jsx("span",{className:"font-semibold",children:"Nhấn để tải logo lên"})}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"PNG, JPG hoặc SVG"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Favicon"}),e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/svg+xml,image/x-icon",ref:E,onChange:a=>O("favicon_url",a.target.files[0]),disabled:!t,className:"hidden"}),N||g?e.jsxs("div",{className:"relative group w-full aspect-square border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden",children:[e.jsx("img",{src:g?g.preview:N.image_url,alt:"Favicon Preview",className:"w-full h-full object-contain"}),t&&e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{type:"button",onClick:()=>E.current.click(),className:"text-white text-sm bg-gray-800 bg-opacity-70 py-1 px-3 rounded-md mr-2",children:"Thay đổi"}),e.jsx("button",{type:"button",onClick:()=>R("favicon_url"),className:"absolute top-2 right-2 bg-black/60 text-white rounded-full p-1",children:e.jsx(S,{size:16})})]})]}):e.jsxs("div",{onClick:()=>t&&E.current.click(),className:`flex flex-col items-center justify-center w-full aspect-square border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition ${t?"":"opacity-70 cursor-not-allowed"}`,children:[e.jsx(ImagePlus,{size:40,className:"text-gray-400 dark:text-gray-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.jsx("span",{className:"font-semibold",children:"Nhấn để tải favicon lên"})}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:"PNG, JPG, SVG hoặc ICO"})]})]})]})]})]})})})})};export{X as default};
