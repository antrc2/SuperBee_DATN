import{d as P,u as q,r as l,j as e,h}from"./index-DGRL5TTe.js";const D=()=>{const u=P(),{pop:r}=q(),[c,v]=l.useState({username:"",email:"",password:""}),[d,p]=l.useState("role"),[g,f]=l.useState(""),[b,y]=l.useState(new Set),[k,w]=l.useState([]),[S,C]=l.useState({}),[j,N]=l.useState(!1),[n,o]=l.useState({});l.useEffect(()=>{(async()=>{try{const[a,t]=await Promise.all([h.get("/admin/accounts/staff-roles"),h.get("/admin/accounts/assignable-permissions")]);a.data.status&&(w(a.data.data),a.data.data.length>0&&f(a.data.data[0].name)),t.data.status&&C(t.data.data)}catch{r("Không thể tải dữ liệu phân quyền.","e")}})()},[r]);const x=s=>{const{name:a,value:t}=s.target;v(i=>({...i,[a]:t})),n[a]&&o(i=>({...i,[a]:null}))},T=s=>{y(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},_=async s=>{var t,i;s.preventDefault(),N(!0),o({});let a={...c,assignment_type:d};d==="role"?a.role_name=g:a.permissions=Array.from(b);try{await h.post("/admin/accounts/create-staff",a),r("Tạo tài khoản nhân viên thành công!","s"),u("/admin/users")}catch(m){m.response&&m.response.status===422?(o(m.response.data.errors),r("Dữ liệu không hợp lệ, vui lòng kiểm tra.","e")):r(((i=(t=m.response)==null?void 0:t.data)==null?void 0:i.message)||"Đã có lỗi xảy ra.","e")}finally{N(!1)}};return e.jsxs("div",{className:"p-4 sm:p-6 bg-slate-50 dark:bg-slate-900 min-h-screen font-sans",children:[e.jsxs("header",{className:"mb-6",children:[e.jsx("button",{onClick:()=>u(-1),className:"text-sm text-slate-600 dark:text-slate-300 flex items-center gap-2 mb-4 hover:text-indigo-500",children:"← Quay lại"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100",children:"Tạo tài khoản nhân viên mới"})]}),e.jsxs("form",{onSubmit:_,className:"space-y-8",children:[e.jsxs("div",{className:"p-6 bg-white dark:bg-slate-800 rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200 mb-4",children:"Thông tin đăng nhập"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",htmlFor:"username",children:"Tên đăng nhập"}),e.jsx("input",{type:"text",id:"username",name:"username",value:c.username,onChange:x,required:!0,className:"form-input w-full dark:bg-slate-700"}),n.username&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.username[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:c.email,onChange:x,required:!0,className:"form-input w-full dark:bg-slate-700"}),n.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.email[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",htmlFor:"password",children:"Mật khẩu"}),e.jsx("input",{type:"password",id:"password",name:"password",value:c.password,onChange:x,required:!0,className:"form-input w-full dark:bg-slate-700"}),n.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.password[0]})]})]})]}),e.jsxs("div",{className:"p-6 bg-white dark:bg-slate-800 rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200 mb-4",children:"Phương thức phân quyền"}),n.assignment_type&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.assignment_type[0]}),e.jsxs("div",{className:"flex space-x-4 mb-6",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"assignmentType",value:"role",checked:d==="role",onChange:s=>p(s.target.value),className:"form-radio"}),e.jsx("span",{children:"Gán theo vai trò có sẵn"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"assignmentType",value:"permissions",checked:d==="permissions",onChange:s=>p(s.target.value),className:"form-radio"}),e.jsx("span",{children:"Gán quyền trực tiếp"})]})]}),d==="role"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",htmlFor:"role_name",children:"Chọn vai trò"}),e.jsx("select",{id:"role_name",name:"role_name",value:g,onChange:s=>f(s.target.value),className:"form-select w-full dark:bg-slate-700",children:k.map(s=>e.jsx("option",{value:s.name,children:s.description||s.name},s.id))}),n.role_name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.role_name[0]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("p",{className:"text-sm text-slate-500",children:["Nhân viên sẽ được gán vai trò"," ",e.jsx("span",{className:"font-mono bg-slate-100 dark:bg-slate-700 p-1 rounded",children:"staff-nhan-vien"})," ","và các quyền bạn chọn dưới đây."]}),n.permissions&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.permissions[0]}),Object.entries(S).map(([s,a])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold mb-3",children:s}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:a.map(t=>e.jsxs("label",{className:"flex items-center space-x-3 bg-slate-50 dark:bg-slate-700/50 p-3 rounded-md",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox",checked:b.has(t.name),onChange:()=>T(t.name)}),e.jsx("span",{className:"text-sm",children:t.description})]},t.id))})]},s))]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:j,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 disabled:bg-indigo-400",children:j?"Đang xử lý...":"Tạo tài khoản"})})]})]})};export{D as default};
