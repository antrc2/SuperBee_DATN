import{l as q,u as J,r as l,j as e,e as B}from"./index-BDAcJp4Y.js";import{U as Q}from"./UserSelectionModal-I3o8ew99.js";const X=({children:m,className:o})=>e.jsx("span",{className:`inline-block w-5 h-5 mr-2 align-middle ${o}`,children:m}),Y=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6h.008v.008H6V6z"})]}),Z=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M-4.5 12h27"})}),D=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962c.51.054.994.093 1.485.127a18.154 18.154 0 010 2.863m-7.5 0a9.094 9.094 0 013.741-.479 3 3 0 014.682-2.72M13.5 5.25h3V7.5h-3V5.25zm-8.25 5.25h3V13.5h-3V10.5z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),y=({title:m,icon:o,children:t})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800/50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900 dark:text-gray-100 flex items-center",children:[e.jsx(X,{className:"text-sky-600 dark:text-sky-400",children:o}),m]})}),e.jsx("div",{className:"p-5 space-y-6",children:t})]}),n=({label:m,id:o,error:t,children:b})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:o,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:m}),b,t&&e.jsx("p",{className:"mt-1.5 text-sm text-red-600 dark:text-red-500",children:t})]}),te=()=>{var S,M,T,L,U,V,I,A,E,F,z;const m=q(),{pop:o}=J(),[t,b]=l.useState({code:"",description:"",usage_limit:"",per_user_limit:"",discount_value:"",min_discount_amount:"",max_discount_amount:"",start_date:"",end_date:""}),[j,H]=l.useState(1),[r,p]=l.useState({}),[k,f]=l.useState(!1),[g,K]=l.useState("all"),[O,v]=l.useState([]),[h,N]=l.useState([]),[P,W]=l.useState([]),[G,w]=l.useState(!1);l.useEffect(()=>{(async()=>{var s;try{const c=await B.get("/admin/discountcode/user");W(((s=c.data)==null?void 0:s.data)||[])}catch(c){console.error("Lỗi khi tải danh sách người dùng:",c),o("Không thể tải danh sách người dùng.","e")}})()},[o]);const d=a=>{const{name:s,value:c}=a.target,_=["usage_limit","per_user_limit","discount_value","min_discount_amount","max_discount_amount","start_date","end_date"];b(u=>({...u,[s]:_.includes(s)?c:c.toUpperCase()})),r[s]&&p(u=>({...u,[s]:null}))},R=a=>{N(a),v(a.map(s=>s.id))},C=a=>{const s=a.target.value;K(s),s==="all"&&(N([]),v([]))},$=async a=>{var _,u;a.preventDefault(),f(!0),p({});let s={...t};g==="specific"&&(s.usage_limit=s.per_user_limit);const c={...s,discount_value:s.discount_value?Number(s.discount_value):null,usage_limit:s.usage_limit!==""?Number(s.usage_limit):-1,per_user_limit:s.per_user_limit!==""?Number(s.per_user_limit):-1,min_discount_amount:s.min_discount_amount!==""?Number(s.min_discount_amount):null,max_discount_amount:s.max_discount_amount!==""?Number(s.max_discount_amount):null,target_user_id:O,status:Number(j)};try{await B.post("/admin/discountcode",c),o("Tạo mã giảm giá thành công!","s"),m("/admin/discountcode")}catch(x){x.response&&x.response.status===422?p(x.response.data.errors||{form:x.response.data.message}):p({form:((u=(_=x.response)==null?void 0:_.data)==null?void 0:u.message)||"Đã có lỗi hệ thống xảy ra."})}finally{f(!1)}},i="mt-1 block w-full px-3 py-2 bg-gray-50 dark:bg-gray-700/50 border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-sky-500 focus:border-sky-500 dark:text-white transition-colors";return e.jsxs("div",{className:"font-sans bg-slate-50 dark:bg-gray-900 min-h-screen p-4 sm:p-6 lg:p-8",children:[e.jsxs("form",{onSubmit:$,className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Tạo Khuyến Mãi Mới"}),e.jsx("p",{className:"mt-1 text-md text-gray-600 dark:text-gray-400",children:"Điền thông tin chi tiết để tạo chương trình khuyến mãi."})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{type:"submit",disabled:k,className:"w-full sm:w-auto inline-flex justify-center items-center py-3 px-6 border border-transparent shadow-sm text-base font-medium rounded-lg text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:bg-sky-400 disabled:cursor-not-allowed dark:focus:ring-offset-gray-900 transition-colors",children:k?"Đang xử lý...":"Lưu và Phát hành"})})]}),r.form&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 p-4 rounded-lg text-sm",children:r.form}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs(y,{title:"Thông tin cơ bản",icon:e.jsx(Y,{}),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{label:"Mã giảm giá",id:"code",error:(S=r.code)==null?void 0:S[0],children:e.jsx("input",{type:"text",name:"code",id:"code",value:t.code,onChange:d,className:i,placeholder:"VD: SALEHE2025"})}),e.jsx(n,{label:"Phần trăm giảm (%)",id:"discount_value",error:(M=r.discount_value)==null?void 0:M[0],children:e.jsx("input",{type:"number",name:"discount_value",id:"discount_value",value:t.discount_value,onChange:d,className:i,placeholder:"VD: 20"})})]}),e.jsx(n,{label:"Mô tả",id:"description",error:(T=r.description)==null?void 0:T[0],children:e.jsx("textarea",{name:"description",id:"description",value:t.description,onChange:d,rows:"4",className:i,placeholder:"Mô tả ngắn gọn..."})})]}),e.jsx(y,{title:"Điều kiện áp dụng",icon:e.jsx(D,{}),children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[g==="all"&&e.jsx(n,{label:"Tổng lượt sử dụng",id:"usage_limit",error:(L=r.usage_limit)==null?void 0:L[0],children:e.jsx("input",{type:"number",name:"usage_limit",id:"usage_limit",value:t.usage_limit,onChange:d,className:i,placeholder:"-1 là không giới hạn"})}),e.jsx(n,{label:"Lượt dùng/Người",id:"per_user_limit",error:(U=r.per_user_limit)==null?void 0:U[0],children:e.jsx("input",{type:"number",name:"per_user_limit",id:"per_user_limit",value:t.per_user_limit,onChange:d,className:i,placeholder:"-1 là không giới hạn"})}),e.jsx(n,{label:"Giá trị giảm tối thiểu (VNĐ)",id:"min_discount_amount",error:(V=r.min_discount_amount)==null?void 0:V[0],children:e.jsx("input",{type:"number",name:"min_discount_amount",id:"min_discount_amount",value:t.min_discount_amount,onChange:d,className:i,placeholder:"Bỏ trống nếu không có"})}),e.jsx(n,{label:"Giá trị giảm tối đa (VNĐ)",id:"max_discount_amount",error:(I=r.max_discount_amount)==null?void 0:I[0],children:e.jsx("input",{type:"number",name:"max_discount_amount",id:"max_discount_amount",value:t.max_discount_amount,onChange:d,className:i,placeholder:"Bỏ trống nếu không có"})})]})})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[e.jsxs(y,{title:"Thời gian hiệu lực",icon:e.jsx(Z,{}),children:[e.jsx(n,{label:"Ngày bắt đầu",id:"start_date",error:(A=r.start_date)==null?void 0:A[0],children:e.jsx("input",{type:"datetime-local",name:"start_date",id:"start_date",value:t.start_date,onChange:d,className:i})}),e.jsx(n,{label:"Ngày kết thúc",id:"end_date",error:(E=r.end_date)==null?void 0:E[0],children:e.jsx("input",{type:"datetime-local",name:"end_date",id:"end_date",value:t.end_date,onChange:d,className:i})})]}),e.jsxs(y,{title:"Cấu hình",icon:e.jsx(D,{}),children:[e.jsx(n,{label:"Trạng thái",id:"status",error:(F=r.status)==null?void 0:F[0],children:e.jsxs("select",{id:"status",name:"status",value:j,onChange:a=>H(a.target.value),className:i,children:[e.jsx("option",{value:1,children:"Kích hoạt"}),e.jsx("option",{value:0,children:"Ẩn"})]})}),e.jsx(n,{label:"Đối tượng áp dụng",id:"target_type",error:(z=r.target_user_id)==null?void 0:z[0],children:e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("label",{htmlFor:"target_all",className:"flex items-center p-3 w-full bg-gray-50 dark:bg-gray-700/50 border dark:border-gray-700 rounded-lg cursor-pointer hover:bg-sky-50 hover:border-sky-300 dark:hover:bg-gray-700 transition-all",children:[e.jsx("input",{id:"target_all",name:"target_type",type:"radio",value:"all",checked:g==="all",onChange:C,className:"h-4 w-4 text-sky-600 border-gray-300 focus:ring-sky-500"}),e.jsx("span",{className:"ml-3 block text-sm font-medium text-gray-900 dark:text-gray-200",children:"Tất cả người dùng"})]}),e.jsxs("label",{htmlFor:"target_specific",className:"flex items-center p-3 w-full bg-gray-50 dark:bg-gray-700/50 border dark:border-gray-700 rounded-lg cursor-pointer hover:bg-sky-50 hover:border-sky-300 dark:hover:bg-gray-700 transition-all",children:[e.jsx("input",{id:"target_specific",name:"target_type",type:"radio",value:"specific",checked:g==="specific",onChange:C,className:"h-4 w-4 text-sky-600 border-gray-300 focus:ring-sky-500"}),e.jsx("span",{className:"ml-3 block text-sm font-medium text-gray-900 dark:text-gray-200",children:"Người dùng cụ thể"})]})]})}),g==="specific"&&e.jsxs("div",{className:"space-y-3 p-3 border border-dashed dark:border-gray-600 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:["Người dùng đã chọn (",h.length,")"]}),e.jsx("button",{type:"button",onClick:()=>w(!0),className:"text-sm font-medium text-sky-600 hover:text-sky-800 dark:text-sky-400 dark:hover:text-sky-200",children:h.length>0?"Thay đổi danh sách":"Chọn người dùng"})]}),h.length>0&&e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2",children:h.map(a=>e.jsxs("div",{className:"flex items-center p-2 bg-gray-100 dark:bg-gray-700/50 rounded-md text-xs",children:[e.jsx("p",{className:"flex-1 font-medium text-gray-800 dark:text-gray-200 truncate",children:a.username}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 truncate ml-2",children:a.email})]},a.id))})]})]})]})]})]}),e.jsx(Q,{isOpen:G,onClose:()=>w(!1),onConfirm:R,allUsers:P,initialSelectedUsers:h})]})};export{te as default};
