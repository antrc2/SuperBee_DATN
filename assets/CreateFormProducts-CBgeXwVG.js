import{u as W,r as u,j as e,E as K,X as _,z as Q,e as V}from"./index-BDAcJp4Y.js";import{E as Y}from"./eye-off-BAWBfQHX.js";import{C as Z}from"./circle-plus-BeqJaH6W.js";import{I as D}from"./image-plus-C5pcu-jQ.js";const j=15,p=({label:i,htmlFor:b,error:o,children:f})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:b,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:i}),f,o&&e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:o})]}),v=({title:i,children:b,error:o})=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900 dark:text-gray-100",children:i}),o&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:o})]}),e.jsx("div",{className:"space-y-4",children:b})]})});function ae({initialData:i,onSubmit:b,isEditing:o=!1,isLoading:f=!1}){const{pop:w}=W(),[n,y]=u.useState({category_id:"",price:"",import_price:"",sale:"",username:"",password:"",email:"",phone:"",cccd:"",description:"",attributes:[]}),[x,C]=u.useState([]),[g,N]=u.useState([]),[T,A]=u.useState([]),[k,M]=u.useState(!1),F=u.useRef(null),[c,U]=u.useState({});u.useEffect(()=>{(async()=>{var t,s;try{const a=await V.get("/categories");A(((s=(t=a.data)==null?void 0:t.data)==null?void 0:s.treeCategories)||[])}catch(a){console.error("Error fetching categories:",a)}})()},[]),u.useEffect(()=>{o&&i&&(y(r=>{var t,s,a,l,m,I,R,$,z,G,O;return{...r,category_id:i.category_id||"",import_price:i.import_price||"",username:((s=(t=i.credentials)==null?void 0:t[0])==null?void 0:s.username)||"",password:(l=(a=i.credentials)==null?void 0:a[0])==null?void 0:l.password,email:((I=(m=i.credentials)==null?void 0:m[0])==null?void 0:I.email)||"",phone:(($=(R=i.credentials)==null?void 0:R[0])==null?void 0:$.phone)||"",cccd:((G=(z=i.credentials)==null?void 0:z[0])==null?void 0:G.cccd)||"",description:i.description||"",attributes:((O=i.game_attributes)==null?void 0:O.map(P=>({attribute_key:P.attribute_key,attribute_value:P.attribute_value})))||[],price:i.price||0,sale:i.sale||""}}),C(i.images||[]),N([]))},[i,o]);const h=r=>{const{name:t,value:s}=r.target;y(a=>({...a,[t]:s}))},S=(r,t)=>{const{name:s,value:a}=t.target,l=[...n.attributes];l[r][s]=a,y(m=>({...m,attributes:l}))},L=()=>{y(r=>({...r,attributes:[...r.attributes,{attribute_key:"",attribute_value:""}]}))},q=r=>{y(t=>({...t,attributes:t.attributes.filter((s,a)=>a!==r)}))},J=r=>{const t=Array.from(r.target.files),s=t.filter(m=>m.type.startsWith("image/"));if(s.length!==t.length&&w("Một số file không phải là ảnh và đã được bỏ qua.","w"),x.length+g.length+s.length>j){w(`Chỉ được tối đa ${j} ảnh.`,"w");return}const l=s.map(m=>Object.assign(m,{preview:URL.createObjectURL(m)}));N(m=>[...m,...l]),r.target.value=null},X=r=>C(t=>t.filter((s,a)=>a!==r)),B=r=>{URL.revokeObjectURL(g[r].preview),N(t=>t.filter((s,a)=>a!==r))};u.useEffect(()=>()=>g.forEach(r=>URL.revokeObjectURL(r.preview)),[g]);const H=r=>{r.preventDefault();let t={};if(n.category_id||(t.category_id="Danh mục không được để trống"),n.price||(t.price="Giá bán không được để trống"),n.import_price||(t.import_price="Giá nhập không được để trống"),n.sale&&Number(n.sale)>=Number(n.price)&&(t.sale="Giá sale phải nhỏ hơn giá bán."),n.username||(t.username="Username không được để trống"),!o&&!n.password&&(t.password="Password không được để trống"),n.attributes.length||(t.attributes="Cần có ít nhất 1 thuộc tính"),n.attributes.forEach((a,l)=>{a.attribute_key||(t[`attribute_key_${l}`]="Tên thuộc tính không được để trống"),a.attribute_value||(t[`attribute_value_${l}`]="Giá trị thuộc tính không được để trống")}),!o&&x.length+g.length===0&&(t.images="Cần chọn ít nhất 1 ảnh"),U(t),Object.keys(t).length>0)return;const s=new FormData;Object.entries(n).forEach(([a,l])=>s.append(a,typeof l=="object"?JSON.stringify(l):l)),g.forEach(a=>s.append("images[]",a)),o&&s.append("existing_images",JSON.stringify(x.map(a=>a.image_url))),b(s)},d=r=>`w-full p-2 rounded-md border bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-colors ${c[r]?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"}`,E=(r,t=0)=>r.flatMap(s=>{if(s.id===1)return[];const a=s.parent_id===null,l=t>0?`${"—".repeat(t)} `:"";return[e.jsxs("option",{value:s.id,disabled:a,className:a?"font-bold text-gray-500":"",children:[l,s.name]},s.id),...s.children?E(s.children,t+1):[]]});return e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs(v,{title:"Thông tin cơ bản",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Danh mục",htmlFor:"category_id",error:c.category_id,children:e.jsxs("select",{name:"category_id",id:"category_id",value:n.category_id,onChange:h,className:d("category_id"),children:[e.jsx("option",{value:"",children:"-- Chọn danh mục --"}),E(T)]})}),e.jsx(p,{label:"Giá Nhập",htmlFor:"import_price",error:c.import_price,children:e.jsx("input",{name:"import_price",type:"number",value:n.import_price,onChange:h,className:d("import_price")})}),e.jsx(p,{label:"Giá Bán",htmlFor:"price",error:c.price,children:e.jsx("input",{name:"price",type:"number",value:n.price,onChange:h,className:d("price")})}),e.jsx(p,{label:"Giá Sale",htmlFor:"sale",error:c.sale,children:e.jsx("input",{name:"sale",type:"number",value:n.sale,onChange:h,className:d("sale")})})]}),e.jsx("div",{className:"col-span-1 md:col-span-2",children:e.jsx(p,{label:"Mô tả (tùy chọn)",htmlFor:"description",children:e.jsx("textarea",{name:"description",id:"description",value:n.description,onChange:h,rows:4,className:d("description"),placeholder:"Nhập mô tả sản phẩm..."})})})]}),e.jsx(v,{title:"Thông tin đăng nhập",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Tài khoản đăng nhập",htmlFor:"username",error:c.username,children:e.jsx("input",{type:"text",name:"username",id:"username",value:n.username,onChange:h,className:d("username")})}),e.jsx(p,{label:"Mật khẩu ",htmlFor:"password",error:c.password,children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:k?"text":"password",name:"password",id:"password",value:n.password,onChange:h,className:d("password")}),e.jsx("button",{type:"button",onClick:()=>M(!k),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:k?e.jsx(Y,{size:18}):e.jsx(K,{size:18})})]})}),e.jsx(p,{label:"Email của tài khoản",htmlFor:"email",error:c.email,children:e.jsx("input",{type:"text",name:"email",id:"email",value:n.email,onChange:h,className:d("email")})}),e.jsx(p,{label:"Số điện thoại của tài khoản",htmlFor:"phone",error:c.phone,children:e.jsx("input",{type:"text",name:"phone",id:"phone",value:n.phone,onChange:h,className:d("phone")})}),e.jsx(p,{label:"Số CCCD của tài khoản",htmlFor:"cccd",error:c.cccd,children:e.jsx("input",{type:"text",name:"cccd",id:"cccd",value:n.cccd,onChange:h,className:d("cccd")})})]})}),e.jsxs(v,{title:"Thuộc tính sản phẩm",error:c.attributes,children:[e.jsx("div",{className:"space-y-4",children:n.attributes.map((r,t)=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("input",{type:"text",name:"attribute_key",placeholder:"Tên thuộc tính (ví dụ: Rank)",value:r.attribute_key,onChange:s=>S(t,s),className:d(`attribute_key_${t}`)}),c[`attribute_key_${t}`]&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:c[`attribute_key_${t}`]})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("input",{type:"text",name:"attribute_value",placeholder:"Giá trị (ví dụ: Tinh Anh)",value:r.attribute_value,onChange:s=>S(t,s),className:d(`attribute_value_${t}`)}),c[`attribute_value_${t}`]&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:c[`attribute_value_${t}`]})]}),e.jsx("button",{type:"button",onClick:()=>q(t),className:"flex-shrink-0 p-2 text-gray-400 hover:text-red-500 rounded-md",children:e.jsx(_,{size:18})})]},t))}),e.jsxs("button",{type:"button",onClick:L,className:"mt-4 inline-flex items-center gap-2 text-sm font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300",children:[e.jsx(Z,{size:16})," Thêm thuộc tính"]})]}),e.jsxs(v,{title:"Hình ảnh minh họa",error:c.images,children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",ref:F,onChange:J,className:"hidden"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsxs("button",{type:"button",onClick:()=>F.current.click(),className:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-lg text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700",disabled:x.length+g.length>=j,children:[e.jsx(D,{size:18}),e.jsx("span",{children:"Chọn từ máy tính"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Đã chọn: ",x.length+g.length," / ",j," ","ảnh."]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4",children:[x.map((r,t)=>e.jsxs("div",{className:"relative aspect-square border dark:border-gray-600 rounded-md overflow-hidden group",children:[e.jsx("img",{src:r.image_url,alt:"Ảnh đã có",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>X(t),className:"absolute top-1 right-1 bg-black/50 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(_,{size:14})})]},t)),g.map((r,t)=>e.jsxs("div",{className:"relative aspect-square border dark:border-gray-600 rounded-md overflow-hidden group",children:[e.jsx("img",{src:r.preview,alt:r.name,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>B(t),className:"absolute top-1 right-1 bg-black/50 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(_,{size:14})})]},r.name+t))]})]}),e.jsx("div",{className:"pt-5",children:e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:f,className:"inline-flex justify-center items-center gap-2 py-2 px-6 border border-transparent shadow-sm text-sm font-semibold rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:[f&&e.jsx(Q,{className:"animate-spin",size:18}),f?"Đang xử lý...":o?"Cập Nhật Sản Phẩm":"Tạo Mới Sản Phẩm"]})})})]})}export{ae as C};
