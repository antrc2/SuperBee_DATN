import{u as L,r as m,j as e,E as q,X as k,l as J,h as X}from"./index-DGRL5TTe.js";import{E as B}from"./eye-off-CIT6F4Wd.js";import{C as H}from"./circle-plus-De4KFbl6.js";import{I as W}from"./image-plus-DPB0hQbH.js";const j=15,p=({label:o,htmlFor:b,error:c,children:f})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:b,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:o}),f,c&&e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:c})]}),v=({title:o,children:b,error:c})=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border dark:border-gray-700",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold leading-6 text-gray-900 dark:text-gray-100",children:o}),c&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:c})]}),e.jsx("div",{className:"space-y-4",children:b})]})});function Z({initialData:o,onSubmit:b,isEditing:c=!1,isLoading:f=!1}){const{pop:w}=L(),[i,y]=m.useState({category_id:"",price:"",import_price:"",sale:"",username:"",password:"",description:"",attributes:[]}),[x,C]=m.useState([]),[h,_]=m.useState([]),[R,$]=m.useState([]),[N,G]=m.useState(!1),F=m.useRef(null),[l,O]=m.useState({});m.useEffect(()=>{(async()=>{var t,s;try{const a=await X.get("/categories");$(((s=(t=a.data)==null?void 0:t.data)==null?void 0:s.treeCategories)||[])}catch(a){console.error("Error fetching categories:",a)}})()},[]),m.useEffect(()=>{c&&o&&(y(r=>{var t,s,a,n,d;return{...r,category_id:o.category_id||"",import_price:o.import_price||"",username:((s=(t=o.credentials)==null?void 0:t[0])==null?void 0:s.username)||"",password:(n=(a=o.credentials)==null?void 0:a[0])==null?void 0:n.password,description:o.description||"",attributes:((d=o.game_attributes)==null?void 0:d.map(I=>({attribute_key:I.attribute_key,attribute_value:I.attribute_value})))||[],price:o.price||0,sale:o.sale||""}}),C(o.images||[]),_([]))},[o,c]);const g=r=>{const{name:t,value:s}=r.target;y(a=>({...a,[t]:s}))},S=(r,t)=>{const{name:s,value:a}=t.target,n=[...i.attributes];n[r][s]=a,y(d=>({...d,attributes:n}))},P=()=>{y(r=>({...r,attributes:[...r.attributes,{attribute_key:"",attribute_value:""}]}))},T=r=>{y(t=>({...t,attributes:t.attributes.filter((s,a)=>a!==r)}))},z=r=>{const t=Array.from(r.target.files),s=t.filter(d=>d.type.startsWith("image/"));if(s.length!==t.length&&w("Một số file không phải là ảnh và đã được bỏ qua.","w"),x.length+h.length+s.length>j){w(`Chỉ được tối đa ${j} ảnh.`,"w");return}const n=s.map(d=>Object.assign(d,{preview:URL.createObjectURL(d)}));_(d=>[...d,...n]),r.target.value=null},A=r=>C(t=>t.filter((s,a)=>a!==r)),M=r=>{URL.revokeObjectURL(h[r].preview),_(t=>t.filter((s,a)=>a!==r))};m.useEffect(()=>()=>h.forEach(r=>URL.revokeObjectURL(r.preview)),[h]);const U=r=>{r.preventDefault();let t={};if(i.category_id||(t.category_id="Danh mục không được để trống"),i.price||(t.price="Giá bán không được để trống"),i.import_price||(t.import_price="Giá nhập không được để trống"),i.sale&&Number(i.sale)>=Number(i.price)&&(t.sale="Giá sale phải nhỏ hơn giá bán."),i.username||(t.username="Username không được để trống"),!c&&!i.password&&(t.password="Password không được để trống"),i.attributes.length||(t.attributes="Cần có ít nhất 1 thuộc tính"),i.attributes.forEach((a,n)=>{a.attribute_key||(t[`attribute_key_${n}`]="Tên thuộc tính không được để trống"),a.attribute_value||(t[`attribute_value_${n}`]="Giá trị thuộc tính không được để trống")}),!c&&x.length+h.length===0&&(t.images="Cần chọn ít nhất 1 ảnh"),O(t),Object.keys(t).length>0)return;const s=new FormData;Object.entries(i).forEach(([a,n])=>s.append(a,typeof n=="object"?JSON.stringify(n):n)),h.forEach(a=>s.append("images[]",a)),c&&s.append("existing_images",JSON.stringify(x.map(a=>a.image_url))),b(s)},u=r=>`w-full p-2 rounded-md border bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-colors ${l[r]?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600"}`,E=(r,t=0)=>r.flatMap(s=>{if(s.id===1)return[];const a=s.parent_id===null,n=t>0?`${"—".repeat(t)} `:"";return[e.jsxs("option",{value:s.id,disabled:a,className:a?"font-bold text-gray-500":"",children:[n,s.name]},s.id),...s.children?E(s.children,t+1):[]]});return e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsxs(v,{title:"Thông tin cơ bản",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Danh mục",htmlFor:"category_id",error:l.category_id,children:e.jsxs("select",{name:"category_id",id:"category_id",value:i.category_id,onChange:g,className:u("category_id"),children:[e.jsx("option",{value:"",children:"-- Chọn danh mục --"}),E(R)]})}),e.jsx(p,{label:"Giá Nhập",htmlFor:"import_price",error:l.import_price,children:e.jsx("input",{name:"import_price",type:"number",value:i.import_price,onChange:g,className:u("import_price")})}),e.jsx(p,{label:"Giá Bán",htmlFor:"price",error:l.price,children:e.jsx("input",{name:"price",type:"number",value:i.price,onChange:g,className:u("price")})}),e.jsx(p,{label:"Giá Sale",htmlFor:"sale",error:l.sale,children:e.jsx("input",{name:"sale",type:"number",value:i.sale,onChange:g,className:u("sale")})})]}),e.jsx("div",{className:"col-span-1 md:col-span-2",children:e.jsx(p,{label:"Mô tả (tùy chọn)",htmlFor:"description",children:e.jsx("textarea",{name:"description",id:"description",value:i.description,onChange:g,rows:4,className:u("description"),placeholder:"Nhập mô tả sản phẩm..."})})})]}),e.jsx(v,{title:"Thông tin đăng nhập",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(p,{label:"Tài khoản đăng nhập",htmlFor:"username",error:l.username,children:e.jsx("input",{type:"text",name:"username",id:"username",value:i.username,onChange:g,className:u("username")})}),e.jsx(p,{label:"Mật khẩu ",htmlFor:"password",error:l.password,children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:N?"text":"password",name:"password",id:"password",value:i.password,onChange:g,className:u("password")}),e.jsx("button",{type:"button",onClick:()=>G(!N),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:N?e.jsx(B,{size:18}):e.jsx(q,{size:18})})]})})]})}),e.jsxs(v,{title:"Thuộc tính sản phẩm",error:l.attributes,children:[e.jsx("div",{className:"space-y-4",children:i.attributes.map((r,t)=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2",children:[e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("input",{type:"text",name:"attribute_key",placeholder:"Tên thuộc tính (ví dụ: Rank)",value:r.attribute_key,onChange:s=>S(t,s),className:u(`attribute_key_${t}`)}),l[`attribute_key_${t}`]&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:l[`attribute_key_${t}`]})]}),e.jsxs("div",{className:"w-full sm:w-1/2",children:[e.jsx("input",{type:"text",name:"attribute_value",placeholder:"Giá trị (ví dụ: Tinh Anh)",value:r.attribute_value,onChange:s=>S(t,s),className:u(`attribute_value_${t}`)}),l[`attribute_value_${t}`]&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:l[`attribute_value_${t}`]})]}),e.jsx("button",{type:"button",onClick:()=>T(t),className:"flex-shrink-0 p-2 text-gray-400 hover:text-red-500 rounded-md",children:e.jsx(k,{size:18})})]},t))}),e.jsxs("button",{type:"button",onClick:P,className:"mt-4 inline-flex items-center gap-2 text-sm font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300",children:[e.jsx(H,{size:16})," Thêm thuộc tính"]})]}),e.jsxs(v,{title:"Hình ảnh minh họa",error:l.images,children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",ref:F,onChange:z,className:"hidden"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsxs("button",{type:"button",onClick:()=>F.current.click(),className:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-lg text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700",disabled:x.length+h.length>=j,children:[e.jsx(W,{size:18}),e.jsx("span",{children:"Chọn từ máy tính"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Đã chọn: ",x.length+h.length," / ",j," ","ảnh."]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4",children:[x.map((r,t)=>e.jsxs("div",{className:"relative aspect-square border dark:border-gray-600 rounded-md overflow-hidden group",children:[e.jsx("img",{src:r.image_url,alt:"Ảnh đã có",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>A(t),className:"absolute top-1 right-1 bg-black/50 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(k,{size:14})})]},t)),h.map((r,t)=>e.jsxs("div",{className:"relative aspect-square border dark:border-gray-600 rounded-md overflow-hidden group",children:[e.jsx("img",{src:r.preview,alt:r.name,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>M(t),className:"absolute top-1 right-1 bg-black/50 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(k,{size:14})})]},r.name+t))]})]}),e.jsx("div",{className:"pt-5",children:e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:f,className:"inline-flex justify-center items-center gap-2 py-2 px-6 border border-transparent shadow-sm text-sm font-semibold rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:[f&&e.jsx(J,{className:"animate-spin",size:18}),f?"Đang xử lý...":c?"Cập Nhật Sản Phẩm":"Tạo Mới Sản Phẩm"]})})})]})}export{Z as C};
