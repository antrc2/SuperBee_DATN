import{u as q,r as d,j as e,E as B,X as N,h as J}from"./index-CBuA2RNo.js";import{E as X}from"./eye-off-B0ZnyQpX.js";import{C as H}from"./circle-plus--tG_coD0.js";import{I as K}from"./image-plus-C5BOd0Ss.js";const j=15;function Z({initialData:n,onSubmit:E,isEditing:h=!1,isLoading:_=!1}){const{pop:w}=q(),[c,b]=d.useState({category_id:"",import_price:"",username:"",password:"",description:"",attributes:[]}),[g,C]=d.useState([]),[i,k]=d.useState([]),[F,R]=d.useState([]),[v,P]=d.useState(!1),I=d.useRef(null),[l,T]=d.useState({});d.useEffect(()=>{(async()=>{var t,s;try{const a=await J.get("/categories");R(((s=(t=a.data)==null?void 0:t.data)==null?void 0:s.treeCategories)||[])}catch(a){console.error("Error fetching categories:",a)}})()},[]),d.useEffect(()=>{n&&(b(r=>{var t,s,a,o,x;return{...r,category_id:n.category_id||"",import_price:n.import_price||"",username:((s=(t=n.credentials)==null?void 0:t[0])==null?void 0:s.username)||"",password:((o=(a=n.credentials)==null?void 0:a[0])==null?void 0:o.password)||"",description:n.description||"",attributes:((x=n.game_attributes)==null?void 0:x.map(m=>({attribute_key:m.attribute_key,attribute_value:m.attribute_value})))||[]}}),C(n.images||[]),k([]))},[n]);const f=r=>{const{name:t,value:s}=r.target;b(a=>({...a,[t]:s}))},S=(r,t)=>{const{name:s,value:a}=t.target,o=[...c.attributes];o[r][s]=a,b(x=>({...x,attributes:o}))},O=()=>{b(r=>({...r,attributes:[...r.attributes,{attribute_key:"",attribute_value:""}]}))},z=r=>{b(t=>({...t,attributes:t.attributes.filter((s,a)=>a!==r)}))},U=r=>{const t=Array.from(r.target.files),s=["image/jpeg","image/png","image/jpg","image/webp","image/gif","image/svg+xml","image/avif","image/heic","image/heif"],a=t.filter(m=>s.includes(m.type));if(a.length!==t.length&&w("Chỉ chấp nhận các định dạng ảnh: jpg, jpeg, png, webp, gif, svg, avif, heic","w"),g.length+i.length+a.length>j){w(`Chỉ được tối đa ${j} ảnh.`,"w");return}const x=a.map(m=>Object.assign(m,{preview:URL.createObjectURL(m)}));k(m=>[...m,...x])},A=r=>C(t=>t.filter((s,a)=>a!==r)),G=r=>{URL.revokeObjectURL(i[r].preview),k(t=>t.filter((s,a)=>a!==r))};d.useEffect(()=>()=>i.forEach(r=>URL.revokeObjectURL(r.preview)),[i]);const L=r=>{r.preventDefault();let t={};if(c.category_id||(t.category_id="Danh mục không được để trống"),c.import_price?c.import_price>999999999&&(t.import_price="Giá phải nhỏ hơn 999.999.999đ"):t.import_price="Giá bán không được để trống",c.username||(t.username="Username không được để trống"),!h&&!c.password&&(t.password="Password không được để trống"),!h&&g.length+i.length===0&&(t.images="Cần chọn ít nhất 1 ảnh"),c.attributes.length||(t.attributes="Cần có ít nhất 1 thuộc tính"),c.attributes.forEach((a,o)=>{a.attribute_key||(t[`attribute_key_${o}`]="Tên thuộc tính không được để trống"),a.attribute_value||(t[`attribute_value_${o}`]="Giá trị thuộc tính không được để trống")}),!h&&g.length+i.length===0&&(t.images="Cần chọn ít nhất 1 ảnh"),T(t),Object.keys(t).length>0)return;const s=new FormData;s.append("category_id",c.category_id),s.append("import_price",c.import_price),s.append("username",c.username),s.append("password",c.password),s.append("description",c.description),s.append("attributes",JSON.stringify(c.attributes)),i.forEach(a=>s.append("images[]",a)),h&&s.append("existing_images",JSON.stringify(g.map(a=>a.image_url))),E(s)},$=(r,t=0)=>r.flatMap(s=>{if(s.id===1)return[];const a=s.parent_id===null,o=t>0?`${">".repeat(t*1)} `:"";return[e.jsxs("option",{value:s.id,disabled:a,children:[o,s.name]},s.id),...s.children?$(s.children,t+1):[]]}),u="w-full p-2 rounded-md border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#1c1c1c] text-gray-900 dark:text-gray-200 placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/30 transition",y="p-6 border bg-white dark:bg-[#121212] rounded-lg shadow-md transition",M="flex items-center gap-2 text-sm text-white bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-400 py-2 px-4 rounded-lg transition",p="text-gray-500 dark:text-gray-400";return e.jsxs("form",{onSubmit:L,className:"space-y-8",children:[e.jsxs("div",{className:y,children:[e.jsx("h3",{className:"mb-4 font-medium text-gray-900 dark:text-white",children:"Thông tin cơ bản"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category_id",className:"block mb-1 text-sm text-gray-700 dark:text-gray-200",children:"Danh mục"}),e.jsxs("select",{name:"category_id",id:"category_id",value:c.category_id,onChange:f,className:u,children:[e.jsx("option",{value:"",children:"-- Chọn --"}),$(F)]}),l.category_id&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:l.category_id})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"import_price",className:"block mb-1 text-sm text-gray-700 dark:text-gray-200",children:"Giá Bán"}),e.jsx("input",{name:"import_price",type:"number",value:c.import_price,onChange:f,className:u,disabled:h&&((n==null?void 0:n.status)===1||(n==null?void 0:n.status)===4),placeholder:"Nhập giá bán"}),l.import_price&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:l.import_price}),h&&((n==null?void 0:n.status)===1||(n==null?void 0:n.status)===4)&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Không thể sửa giá khi sản phẩm đang bán hoặc đã bán."})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{htmlFor:"description",className:"block mb-1 text-sm text-gray-700 dark:text-gray-200",children:"Mô tả (tùy chọn)"}),e.jsx("textarea",{name:"description",id:"description",value:c.description,onChange:f,rows:3,className:u,placeholder:"Nhập mô tả sản phẩm (không bắt buộc)"})]})]}),e.jsxs("div",{className:y,children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900 dark:text-white mb-4",children:"Thông tin đăng nhập"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Tài khoản đăng nhập"}),e.jsx("input",{type:"text",name:"username",id:"username",value:c.username,onChange:f,className:u,placeholder:"Nhập tài khoản"}),l.username&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:l.username})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:["Mật khẩu ",h&&"(Bỏ trống nếu không đổi)"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:v?"text":"password",name:"password",id:"password",value:c.password,onChange:f,className:u,placeholder:"Nhập mật khẩu"}),e.jsx("button",{type:"button",onClick:()=>P(!v),className:`absolute right-3 top-1/2 transform -translate-y-1/2 ${p}`,tabIndex:-1,children:v?e.jsx(X,{size:18}):e.jsx(B,{size:18})})]}),l.password&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:l.password})]})]})]}),e.jsxs("div",{className:y,children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900 dark:text-white mb-4",children:"Thuộc tính sản phẩm"}),l.attributes&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:l.attributes}),e.jsx("div",{className:"space-y-4",children:c.attributes.map((r,t)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("input",{type:"text",name:"attribute_key",placeholder:"Tên thuộc tính",value:r.attribute_key,onChange:s=>S(t,s),className:u}),l[`attribute_key_${t}`]&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:l[`attribute_key_${t}`]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("input",{type:"text",name:"attribute_value",placeholder:"Giá trị",value:r.attribute_value,onChange:s=>S(t,s),className:u}),l[`attribute_value_${t}`]&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:l[`attribute_value_${t}`]})]}),e.jsx("button",{type:"button",onClick:()=>z(t),className:`text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-200 ${p}`,tabIndex:-1,children:e.jsx(N,{size:18})})]},t))}),e.jsxs("button",{type:"button",onClick:O,className:"mt-4 flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 transition",children:[e.jsx(H,{size:18,className:p})," Thêm thuộc tính"]})]}),e.jsxs("div",{className:y,children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900 dark:text-white mb-4",children:"Hình ảnh minh họa"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/png, image/jpeg, image/gif, image/webp",ref:I,onChange:U,className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>I.current.click(),className:"mb-4 flex items-center gap-2 text-sm text-white bg-gray-700 dark:bg-[#2d2d2d] hover:bg-gray-800 dark:hover:bg-[#3a3a3a] py-2 px-3 rounded-lg transition",disabled:g.length+i.length>=j,children:[e.jsx(K,{size:18,className:p})," Chọn ảnh từ máy tính"]}),l.images&&e.jsx("p",{className:"text-xs text-red-500 mb-2",children:l.images}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Đã chọn: ",g.length+i.length," / ",j," ảnh."]}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4",children:[g.map((r,t)=>e.jsxs("div",{className:"relative aspect-square border rounded-md overflow-hidden border-gray-300 dark:border-[#333]",children:[e.jsx("img",{src:`${r.image_url}`,alt:"Ảnh cũ",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>A(t),className:`absolute top-1 right-1 bg-black/50 text-white rounded-full p-0.5 ${p}`,tabIndex:-1,children:e.jsx(N,{size:14})})]},t)),i.map((r,t)=>e.jsxs("div",{className:"relative aspect-square border rounded-md overflow-hidden border-gray-300 dark:border-[#333]",children:[e.jsx("img",{src:r.preview,alt:r.name,className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>G(t),className:`absolute top-1 right-1 bg-black/50 text-white rounded-full p-0.5 ${p}`,tabIndex:-1,children:e.jsx(N,{size:14})})]},r.name+t))]})]}),e.jsx("div",{className:"pt-6 flex justify-end",children:e.jsx("button",{type:"submit",disabled:_,className:M,children:_?"Đang lưu...":h?"Cập Nhật":"Tạo Sản Phẩm"})})]})}export{Z as C};
