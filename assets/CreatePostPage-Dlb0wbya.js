import{d as ae,u as ie,r as i,j as t,g as oe,h as E}from"./index-DGRL5TTe.js";import{T as se,F as ne}from"./file.min-BlceajW0.js";import{A as le}from"./arrow-left-CpInBLIv.js";const H=u=>u.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-"),ce=u=>u===null||u.trim()===""||u.replace(/<[^>]*>/g,"").trim()==="",de=u=>{const y=new DOMParser().parseFromString(u||"<div></div>","text/html");return y.querySelectorAll("img").forEach(n=>{n.style.display="block",n.style.marginLeft="auto",n.style.marginRight="auto",n.classList.remove("fr-fic","fr-dib","fr-fil","fr-fir")}),y.querySelectorAll("video, iframe").forEach(n=>{n.tagName==="VIDEO"&&!n.getAttribute("controls")&&n.setAttribute("controls",""),n.style.display="block",n.style.marginLeft="auto",n.style.marginRight="auto",n.style.width="100%",n.tagName==="IFRAME"&&(n.style.height="auto")}),y.body.innerHTML};function he(){const u=ae(),{pop:s}=ie(),y=i.useMemo(()=>{const e=new se({headingStyle:"atx",bulletListMarker:"*",codeBlockStyle:"fenced"});return e.addRule("videoLink",{filter:function(r){return r.nodeName==="VIDEO"&&(r.getAttribute("src")||r.querySelector("source"))},replacement:function(r,a){const o=a.getAttribute("src")||(a.querySelector("source")?a.querySelector("source").getAttribute("src"):null);return o?`![Video](${o})`:""}}),e.addRule("iframeEmbed",{filter:function(r){return r.nodeName==="IFRAME"&&(r.getAttribute("src")||r.getAttribute("data-src"))},replacement:function(r,a){const o=a.getAttribute("src")||a.getAttribute("data-src"),l=a.getAttribute("width")||"560",d=a.getAttribute("height")||"315";return`<iframe src="${o}" width="${l}" height="${d}" frameborder="0" allowfullscreen></iframe>`}}),e.addRule("fileLink",{filter:function(r){return r.nodeName==="A"&&r.classList.contains("fr-file")},replacement:function(r,a){const o=a.getAttribute("href");return`[${a.textContent.trim()}](${o})`}}),e},[]),[V,j]=i.useState([]),[n,S]=i.useState(""),[L,D]=i.useState(!1),[k,R]=i.useState(""),[P,U]=i.useState(""),[I,A]=i.useState(""),[w,J]=i.useState(""),[O,G]=i.useState(""),[M,Q]=i.useState(""),[F,W]=i.useState(null),[z,X]=i.useState(null),[Y,B]=i.useState(!0),[N,C]=i.useState(!1),[m,T]=i.useState({}),[K,f]=i.useState(null),b="https://superbee.site/backend/public/index.php/api",_=sessionStorage.getItem("access_token"),[q,Z]=i.useState(!1);i.useEffect(()=>{const e=()=>{Z(document.documentElement.classList.contains("dark"))};e();const r=new MutationObserver(e);return r.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>r.disconnect()},[]);const $=i.useMemo(()=>({theme:q?"dark":"gray",placeholderText:"Nhập nội dung bài viết...",toolbarButtons:{moreText:{buttons:["bold","italic","underline","strikeThrough","subscript","superscript","fontFamily","fontSize","textColor","backgroundColor","clearFormatting"],buttonsVisible:6},moreParagraph:{buttons:["alignLeft","alignCenter","alignRight","alignJustify","formatOL","formatUL","paragraphFormat","paragraphStyle","lineHeight","outdent","indent"],buttonsVisible:5},moreRich:{buttons:["insertLink","insertImage","insertVideo","insertFile","insertTable","emoticons","specialCharacters","insertHR","undo","redo"],buttonsVisible:6},moreMisc:{buttons:["quote","codeView","fullscreen","help","selectAll","print","getPDF","html","save"],buttonsVisible:3}},imageUpload:!0,imageUploadURL:`${b}/admin/post/upload`,requestHeaders:{Authorization:"Bearer "+_},imageUploadMethod:"POST",imageManagerLoadURL:`${b}/admin/post/load-images`,imageManagerDeleteURL:`${b}/admin/post/delete-image`,imageManagerDeleteMethod:"POST",imageAllowedTypes:["jpeg","jpg","png","gif"],imageMaxSize:5*1024*1024,imageEditButtons:["imageDisplay","imageAlign","imageSize","imageRemove","imageLink","imageAlt"],imageDefaultAlign:"center",imageDefaultDisplay:"block",videoUpload:!0,videoUploadURL:`${b}/admin/post/upload`,videoUploadMethod:"POST",videoAllowedTypes:["mp4","webm","ogg","avi","mov"],videoMaxSize:50*1024*1024,videoEditButtons:["videoDisplay","videoAlign","videoSize","videoRemove","videoLink"],videoDefaultAlign:"center",videoDefaultDisplay:"block",videoAllowedProviders:["youtube","vimeo","dailymotion","tiktok"],videoInsertButtons:["videoBack","|","videoByURL","videoEmbed","videoUpload"],fileUpload:!0,fileUploadURL:`${b}/admin/post/upload`,fileUploadMethod:"POST",fileAllowedTypes:["pdf","doc","docx","xls","xlsx","ppt","pptx","zip","rar","txt","csv","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/zip","application/x-rar-compressed","text/plain","text/csv"],fileMaxSize:20*1024*1024,htmlAllowedTags:[".*"],htmlAllowedAttrs:[".*"],htmlAllowedEmptyTags:["video","source","iframe"],events:{"image.inserted":function(e,r){e.css({display:"block","margin-left":"auto","margin-right":"auto"}),e.removeClass("fr-fic fr-dib fr-fil fr-fir")},"image.replaced":function(e,r){e.css({display:"block","margin-left":"auto","margin-right":"auto"}),e.removeClass("fr-fic fr-dib fr-fil fr-fir")},"video.inserted":function(e,r){try{let a=null;typeof r=="string"?a=JSON.parse(r).link:r&&r.link?a=r.link:e.attr("src")?a=e.attr("src"):e.find("source").length&&(a=e.find("source").attr("src")),a?e[0].tagName==="VIDEO"&&(e.attr("controls","true"),e.css({display:"block","margin-left":"auto","margin-right":"auto",width:"100%",height:"auto"}),e.removeClass("fr-fic fr-dib fr-fil fr-fir"),s("Video đã được chèn thành công!","s")):e[0].tagName==="IFRAME"?(e.css({display:"block","margin-left":"auto","margin-right":"auto",width:"100%",height:"auto",border:"none"}),s("Video nhúng đã được chèn thành công!","s")):(console.warn("Không xác định được loại video được chèn:",e,r),s("Có lỗi xảy ra: Không xác định được loại video được chèn.","e"))}catch(a){console.error("Lỗi khi chèn video Froala:",a),s("Có lỗi xảy ra khi chèn video. Vui lòng thử lại.","e")}},"video.replaced":function(e,r){e.css({display:"block","margin-left":"auto","margin-right":"auto",width:"100%",height:"auto"}),e[0].tagName==="VIDEO"?e.attr("controls","true"):e[0].tagName==="IFRAME"&&e.css("border","none"),e.removeClass("fr-fic fr-dib fr-fil fr-fir")},"video.error":function(e,r){console.error("Lỗi Froala Video:",e),s(`Có lỗi khi tải lên/chèn video: ${e.message||"Không rõ lỗi"}. Vui lòng thử lại.`,"e")},"file.inserted":function(e,r){try{const a=typeof r=="string"?JSON.parse(r):r,o=a.link,l=a.name||"Tệp đính kèm";if(!o){s("Có lỗi xảy ra: Không nhận được liên kết tệp từ máy chủ.","e");return}e.html(`<i class="fas fa-file-alt"></i> ${l}`),e.attr("href",o),e.attr("target","_blank"),e.attr("download",l),s(`Tệp "${l}" đã được chèn.`,"s")}catch(a){console.error("Lỗi khi chèn file:",a),s("Có lỗi xảy ra khi chèn tệp. Vui lòng thử lại.","e")}},"file.error":function(e,r){console.error("Lỗi Froala File:",e),s(`Có lỗi khi tải lên/chèn tệp: ${e.message||"Không rõ lỗi"}. Vui lòng thử lại.`,"e")}},heightMin:400,heightMax:800,charCounterCount:!0,wordPasteKeepFormatting:!1}),[q,b,_,s]);i.useEffect(()=>{(async()=>{var r,a,o;try{B(!0);const l=await E.get("/admin/categoryPost");j(((a=(r=l.data)==null?void 0:r.data)==null?void 0:a.data)||[])}catch(l){console.error("Lỗi khi lấy danh mục:",((o=l.response)==null?void 0:o.data)||l.message),f("Không thể tải danh mục. Vui lòng thử lại."),s("Không thể tải danh mục. Vui lòng thử lại.","e")}finally{B(!1)}})()},[s]);const ee=async e=>{var r,a,o,l;if(e.preventDefault(),!k.trim()){A("Tên danh mục không được để trống.");return}A(""),C(!0),f(null);try{const d=await E.post("/admin/categoryPost/new",{name:k.trim(),slug:H(k.trim()),description:P.trim()}),c=d.data.data||d.data;j(x=>[...x,c]),S(c.id.toString()),D(!1),R(""),U(""),s("Danh mục đã được tạo thành công!","s")}catch(d){if(console.error("Lỗi khi tạo danh mục:",((r=d.response)==null?void 0:r.data)||d.message),d.response&&d.response.status===422){const c=(a=d.response.data)==null?void 0:a.errors;c&&c.name?A(c.name[0]):f("Lỗi xác thực dữ liệu. Vui lòng kiểm tra lại thông tin.")}else f(((l=(o=d.response)==null?void 0:o.data)==null?void 0:l.message)||"Không thể tạo danh mục. Vui lòng thử lại.");s("Không thể tạo danh mục.","e")}finally{C(!1)}},te=()=>{const e={};return w.trim()||(e.title="Tiêu đề bài viết không được để trống."),ce(M)&&(e.content="Nội dung bài viết không được để trống."),!n&&!L&&(e.category="Vui lòng chọn hoặc tạo một danh mục."),F||(e.image="Vui lòng tải ảnh thumbnail lên."),T(e),Object.keys(e).length===0},re=async e=>{var r,a,o,l,d;if(e.preventDefault(),!te()){s("Vui lòng kiểm tra lại các trường bị lỗi.","e");return}C(!0),f(null);try{const c=de(M),x=y.turndown(c),g=new FormData;g.append("title",w.trim()),g.append("slug",H(w.trim())),g.append("content",x),g.append("descriptionPost",O.trim()||""),g.append("category_id",n||""),g.append("author_id",1),g.append("status",0),F&&g.append("image_thumbnail",F);const p=await E.post("/admin/post",g,{headers:{"Content-Type":"multipart/form-data"}});(p.status===201||p.status===200)&&(s("Bài viết đã được tạo thành công!","s"),u("/admin/post"))}catch(c){console.error("Lỗi khi tạo bài viết:",((r=c.response)==null?void 0:r.data)||c.message);const x=((o=(a=c.response)==null?void 0:a.data)==null?void 0:o.message)||"Có lỗi xảy ra khi tạo bài viết, vui lòng thử lại.";if(f(x),(d=(l=c.response)==null?void 0:l.data)!=null&&d.errors){const g={};for(const p in c.response.data.errors)g[p]=c.response.data.errors[p][0];T(p=>({...p,...g}))}s(x,"e")}finally{C(!1)}};if(Y)return t.jsx(oe,{});const v="w-full px-3 py-2 leading-tight text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 focus:border-transparent transition-colors",h="block text-sm font-bold mb-2 text-gray-700 dark:text-gray-300";return t.jsxs("div",{className:"max-w-5xl mx-auto my-8 p-4 sm:p-6 lg:p-8 bg-white dark:bg-gray-800 rounded-xl shadow-2xl transition-colors",children:[t.jsxs("button",{type:"button",onClick:()=>u(-1),className:"flex items-center gap-2 px-4 py-2 font-semibold text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800",children:[t.jsx(le,{size:18}),"Quay Lại"]}),t.jsx("h2",{className:"text-3xl font-bold text-center text-gray-800 dark:text-gray-100 mb-8",children:"Tạo Bài Viết Mới"}),K&&t.jsxs("div",{className:"bg-red-100 dark:bg-red-900/40 border border-red-400 dark:border-red-500/60 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg relative mb-6",role:"alert",children:[t.jsx("strong",{className:"font-bold",children:"Lỗi: "}),t.jsx("span",{className:"block sm:inline",children:K})]}),t.jsxs("form",{onSubmit:re,className:"space-y-8",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postTitle",className:h,children:"Tiêu đề bài viết"}),t.jsx("input",{type:"text",id:"postTitle",value:w,onChange:e=>J(e.target.value),className:v,placeholder:"Nhập tiêu đề bài viết"}),m.title&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:m.title})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postDescription",className:h,children:"Mô tả ngắn"}),t.jsx("textarea",{id:"postDescription",value:O,onChange:e=>G(e.target.value),rows:3,className:`${v} resize-y`,placeholder:"Mô tả ngắn gọn, hấp dẫn về bài viết"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postContent",className:h,children:"Nội dung bài viết"}),t.jsx("div",{className:"froala-container rounded-md overflow-hidden border border-gray-300 dark:border-gray-600",children:t.jsx(ne,{tag:"textarea",config:$,model:M,onModelChange:Q})}),m.content&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:m.content})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"imageFile",className:h,children:"Ảnh Thumbnail"}),t.jsx("input",{type:"file",id:"imageFile",accept:"image/*",onChange:e=>{const r=e.target.files[0];r&&(W(r),X(URL.createObjectURL(r)))},className:`block w-full text-sm text-gray-700 dark:text-gray-300\r
              file:mr-4 file:py-2 file:px-4\r
              file:rounded-full file:border-0\r
              file:text-sm file:font-semibold\r
              file:bg-indigo-50 dark:file:bg-indigo-900/40 file:text-indigo-700 dark:file:text-indigo-300\r
              hover:file:bg-indigo-100 dark:hover:file:bg-indigo-900/60 transition-colors`}),z&&t.jsx("div",{className:"mt-4",children:t.jsx("img",{src:z,alt:"Ảnh xem trước",className:"w-48 h-auto rounded-lg border-2 border-gray-300 dark:border-gray-600 shadow-sm"})}),m.image&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:m.image})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"categorySelect",className:h,children:"Danh mục"}),L?t.jsxs("div",{className:"border border-dashed border-gray-400 dark:border-gray-600 p-4 sm:p-6 rounded-lg bg-indigo-50 dark:bg-gray-700/50 mt-2",children:[t.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-gray-700 dark:text-gray-200 mb-4",children:"Tạo Danh Mục Mới"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"newCategoryName",className:h,children:"Tên danh mục"}),t.jsx("input",{type:"text",id:"newCategoryName",value:k,onChange:e=>R(e.target.value),className:v,placeholder:"VD: Tin công nghệ"}),I&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:I})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"newCategoryDescription",className:h,children:"Mô tả"}),t.jsx("textarea",{id:"newCategoryDescription",value:P,onChange:e=>U(e.target.value),className:`${v} h-24 resize-y`,placeholder:"Mô tả ngắn về danh mục"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-end items-center gap-3 mt-4",children:[t.jsx("button",{type:"button",onClick:()=>D(!1),className:"w-full sm:w-auto px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-md focus:outline-none focus:shadow-outline transition duration-200",children:"Hủy"}),t.jsx("button",{type:"button",onClick:ee,disabled:N,className:"w-full sm:w-auto px-4 py-2 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white font-bold rounded-md focus:outline-none focus:shadow-outline transition duration-200",children:N?"Đang tạo...":"Tạo Danh Mục"})]})]})]}):t.jsxs("select",{id:"categorySelect",value:n,onChange:e=>{e.target.value==="new"?(D(!0),S("")):(S(e.target.value),T(r=>({...r,category:""})))},className:`${v} cursor-pointer`,children:[t.jsx("option",{value:"",children:"-- Chọn danh mục --"}),V.map(e=>t.jsx("option",{value:e.id,className:"dark:bg-gray-800",children:e.name},e.id)),t.jsx("option",{value:"new",className:"font-bold text-indigo-600 dark:text-indigo-400",children:"-- Thêm danh mục mới --"})]}),m.category&&!L&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:m.category})]}),t.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:t.jsx("button",{type:"submit",disabled:N,className:`w-full sm:w-auto px-8 py-3 bg-green-600 text-white font-bold rounded-lg\r
                       hover:bg-green-700\r
                       focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50\r
                       disabled:bg-green-400 dark:disabled:bg-green-800 disabled:cursor-not-allowed\r
                       transition-all duration-200 text-lg shadow-lg hover:shadow-xl`,children:N?"Đang tạo bài viết...":"Tạo Bài Viết"})})]})]})}export{he as default};
