import{j as e,q as K,p as _,L as S,E,s as M,u as N,r as o,d as $,m as A,h as f,S as R,o as B}from"./index-B6v2l7qZ.js";import{H as v}from"./main-CooDa97h.js";import{T as U}from"./tag-ES60Am9B.js";import{K as F}from"./key-Dy3iU9QH.js";import{P as I}from"./plus-DnnTMQIa.js";const w=n=>n?new Date(n).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A",V=({status:n,endDate:i})=>{let r="Ngưng",d="bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300";return n==1?(r="Hoạt động",d="bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300"):n==2&&(r="Hết hạn",d="bg-yellow-100 text-yellow-800 dark:bg-yellow-900/40 dark:text-yellow-300"),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold ${d}`,children:r})};function W({loading:n,data:i,handleLock:r,handleUndo:d,searchTerm:c}){return e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-slate-500 dark:text-slate-400",children:[e.jsx("thead",{className:"text-xs text-slate-700 dark:text-slate-300 uppercase bg-slate-50 dark:bg-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Khuyến mãi (%)"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Thời gian hiệu lực"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Trạng thái"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Hành động"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:n?Array.from({length:5}).map((a,u)=>e.jsx("tr",{className:"animate-pulse",children:e.jsx("td",{className:"px-6 py-4",colSpan:"6",children:e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-full"})})},u)):i.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"text-center py-16 text-slate-500",children:[e.jsx(U,{size:48,className:"mx-auto mb-2"}),"Không tìm thấy mã giảm giá nào."]})}):i.map(a=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-slate-900 dark:text-slate-200",children:e.jsx(v,{highlightClassName:"bg-yellow-200 dark:bg-yellow-700 rounded-sm",searchWords:[c],autoEscape:!0,textToHighlight:a.id.toString()})}),e.jsx("td",{className:"px-6 py-4 font-semibold text-indigo-600 dark:text-indigo-400",children:e.jsx(v,{highlightClassName:"bg-yellow-200 dark:bg-yellow-700 rounded-sm",searchWords:[c],autoEscape:!0,textToHighlight:`${a.amount}%`})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 dark:text-slate-400",children:[e.jsx(K,{size:14}),e.jsx("span",{children:w(a.start_date)}),e.jsx(_,{size:14}),e.jsx("span",{children:w(a.end_date)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(V,{status:a.status,endDate:a.end_date})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx(S,{to:`/admin/donatePromotions/${a.id}`,title:"Xem chi tiết",className:"p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-500 hover:text-blue-600 transition-colors",children:e.jsx(E,{size:18})}),a.status===1?e.jsx("button",{onClick:()=>r(a.id),title:"Tắt khuyến mãi",className:"p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-500 hover:text-red-600 transition-colors",children:e.jsx(M,{size:18})}):e.jsx("button",{onClick:()=>d(a.id),title:"Kích hoạt lại",className:"p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-500 hover:text-green-600 transition-colors",children:e.jsx(F,{size:18})})]})})]},a.id))})]})})}const O=()=>{const{pop:n}=N(),[i,r]=o.useState([]),[d,c]=o.useState(!0),[a,u]=o.useState(null),P=$(),p=A(),{conFim:C}=N(),[h,L]=o.useState(""),[x,T]=o.useState({status:""}),[g,D]=o.useState({by:"id",direction:"desc"}),y=o.useMemo(()=>new URLSearchParams(p.search).get("page")||"1",[p.search]),j=o.useCallback(async()=>{c(!0);try{const t=await f.get(`/admin/donate_promotions?page=${y}`),{data:s,...l}=t.data.data;r(s),u(l)}catch{n("Lỗi khi tải khuyến mãi","e"),r([]),u(null)}finally{c(!1)}},[y,n]);o.useEffect(()=>{j()},[j]);const H=o.useMemo(()=>{let t=[...i];if(x.status!==""&&(t=t.filter(s=>s.status.toString()===x.status)),h){const s=h.toLowerCase();t=t.filter(l=>l.id.toString().includes(s)||l.amount.toString().includes(s))}return t.sort((s,l)=>{const b=s[g.by],m=l[g.by];return b<m?g.direction==="asc"?-1:1:b>m?g.direction==="asc"?1:-1:0}),t},[i,h,x,g]),z=t=>{const s=new URLSearchParams(p.search);s.set("page",t),P({search:s.toString()})},k=async(t,s,l)=>{if(await C(l))try{t==="undo"?await f.post(`/admin/donate_promotions/${s}/undo`):await f.delete(`/admin/donate_promotions/${s}`),j()}catch(m){console.error("Lỗi khi thực hiện hành động:",m)}};return e.jsxs("div",{className:"p-4 sm:p-6 bg-slate-50 dark:bg-slate-900 min-h-screen font-sans",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row justify-between sm:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100",children:"Khuyến mãi Nạp thẻ"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Quản lý các chương trình khuyến mãi khi người dùng nạp tiền."})]}),e.jsx(S,{to:"/admin/donatePromotions/new",children:e.jsxs("button",{className:"flex items-center justify-center gap-2 w-full sm:w-auto bg-indigo-600 text-white px-4 py-2.5 rounded-lg shadow-md hover:bg-indigo-700 transition-colors focus:ring-2 focus:ring-indigo-500",children:[e.jsx(I,{size:18}),"Tạo khuyến mãi"]})})]}),e.jsx("div",{className:"p-4 bg-white dark:bg-slate-800 rounded-lg shadow-sm mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Tìm theo ID, % khuyến mãi...",value:h,onChange:t=>L(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("select",{name:"status",value:x.status,onChange:t=>T({...x,status:t.target.value}),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Tất cả trạng thái"}),e.jsx("option",{value:"1",children:"Hoạt động"}),e.jsx("option",{value:"0",children:"Ngưng"}),e.jsx("option",{value:"2",children:"Hết hạn"})]}),e.jsxs("select",{onChange:t=>{const[s,l]=t.target.value.split(",");D({by:s,direction:l})},defaultValue:"id,desc",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"id,desc",children:"Mới nhất"}),e.jsx("option",{value:"end_date,asc",children:"Sắp hết hạn"}),e.jsx("option",{value:"amount,desc",children:"Khuyến mãi: Cao đến thấp"}),e.jsx("option",{value:"amount,asc",children:"Khuyến mãi: Thấp đến cao"})]})]})}),e.jsx(W,{loading:d,data:H,searchTerm:h,handleLock:t=>k("lock",t,"Bạn muốn khóa"),handleUndo:t=>k("undo",t,"Mở khóa")}),e.jsx(B,{meta:a,onPageChange:z})]})};export{O as default};
