import{k as he,d as xe,u as pe,r,j as e,h as D}from"./index-B6v2l7qZ.js";const ye=({children:g,className:o})=>e.jsx("span",{className:`inline-block w-5 h-5 mr-2 align-middle ${o}`,children:g}),ke=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6h.008v.008H6V6z"})]}),be=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M-4.5 12h27"})}),se=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962c.51.054.994.093 1.485.127a18.154 18.154 0 010 2.863m-7.5 0a9.094 9.094 0 013.741-.479 3 3 0 014.682-2.72M13.5 5.25h3V7.5h-3V5.25zm-8.25 5.25h3V13.5h-3V10.5z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),_e=()=>e.jsx("svg",{className:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"})}),je=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})}),ve=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"})}),N=({title:g,icon:o,children:h})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800/50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900 dark:text-gray-100 flex items-center",children:[e.jsx(ye,{className:"text-sky-600 dark:text-sky-400",children:o}),g]})}),e.jsx("div",{className:"p-5 space-y-6",children:h})]}),d=({label:g,id:o,error:h,children:t})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:o,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:g}),t,h&&e.jsx("p",{className:"mt-1.5 text-sm text-red-600 dark:text-red-500",children:h})]}),we=()=>{var W,$,K,P,H,G,O,q,Q,Z,J;const{id:g}=he(),o=xe(),{pop:h}=pe(),[t,I]=r.useState(null),[U,V]=r.useState(1),[i,f]=r.useState({}),[A,B]=r.useState(!1),[ae,ne]=r.useState(!0),[y,re]=r.useState(!1),[ie,le]=r.useState(""),[_,C]=r.useState("all"),[oe,j]=r.useState(-1),[k,E]=r.useState(""),[L,S]=r.useState([]),[z,de]=r.useState([]),[M,w]=r.useState(null),[ce,T]=r.useState(!1);r.useEffect(()=>{(async()=>{var s,p,l,v;try{const[u,ge]=await Promise.all([D.get(`/admin/discountcode/${g}`),D.get("/admin/discountcode/user")]),n=(s=u.data)==null?void 0:s.data;if(console.log("üöÄ ~ fetchData ~ promoData:",n),!n){h("Kh√¥ng t√¨m th·∫•y m√£ khuy·∫øn m√£i.","e"),o("/admin/discountcode");return}const X=((p=ge.data)==null?void 0:p.data)||[];de(X);const Y=m=>{if(!m)return"";const b=new Date(m);return b.setMinutes(b.getMinutes()-b.getTimezoneOffset()),b.toISOString().slice(0,16)};if(I({code:n.code||"",description:n.description||"",usage_limit:n.usage_limit??"",per_user_limit:n.per_user_limit??"",discount_value:n.discount_value||"",min_discount_amount:n.min_discount_amount||"",max_discount_amount:n.max_discount_amount||"",start_date:Y(n.start_date),end_date:Y(n.end_date)}),V(n.status),n.user_id&&n.user_id!==-1){C("specific"),j(n.user_id);const m=X.find(b=>Number(b.id)===Number(n.user_id));m?w(m):console.warn(`User with ID ${n.user_id} not found.`)}else C("all"),j(-1);const ee=new Date(n.end_date)<new Date,te=n.total_used>0;if(te||ee){re(!0);let m="";te&&(m="M√£ ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng."),ee&&(m+=(m?" ":"")+"M√£ ƒë√£ h·∫øt h·∫°n."),le(m+" Kh√¥ng th·ªÉ ch·ªânh s·ª≠a ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n.")}}catch(u){console.error("L·ªói khi t·∫£i d·ªØ li·ªáu:",u),h(((v=(l=u.response)==null?void 0:l.data)==null?void 0:v.message)||"L·ªói khi t·∫£i d·ªØ li·ªáu!","e"),o("/admin/discountcode")}finally{ne(!1)}})()},[g,o,h]);const x=a=>{const{name:s,value:p}=a.target;I(l=>({...l,[s]:p})),i[s]&&f(l=>({...l,[s]:null}))},F=r.useCallback(()=>{if(T(!0),!k.trim()){S([]),T(!1);return}const a=z.filter(s=>{var p,l;return((p=s.name)==null?void 0:p.toLowerCase().includes(k.toLowerCase()))||((l=s.email)==null?void 0:l.toLowerCase().includes(k.toLowerCase()))||s.id.toString().includes(k)});S(a),T(!1)},[k,z]);r.useEffect(()=>{const a=setTimeout(()=>F(),300);return()=>clearTimeout(a)},[k,F]);const ue=a=>{w(a),j(a.id),E(""),S([])},R=a=>{const s=a.target.value;C(s),s==="all"&&(j(-1),w(null))},me=async a=>{var l,v;if(a.preventDefault(),y)return;B(!0),f({});let s={...t};_==="specific"&&(s.usage_limit=s.per_user_limit);const p={...s,discount_value:s.discount_value?Number(s.discount_value):null,usage_limit:s.usage_limit!==""?Number(s.usage_limit):-1,per_user_limit:s.per_user_limit!==""?Number(s.per_user_limit):-1,min_discount_amount:s.min_discount_amount!==""?Number(s.min_discount_amount):null,max_discount_amount:s.max_discount_amount!==""?Number(s.max_discount_amount):null,target_user_id:oe,status:Number(U)};try{await D.put(`/admin/discountcode/${g}`,p),h("C·∫≠p nh·∫≠t m√£ gi·∫£m gi√° th√†nh c√¥ng!","s"),o("/admin/discountcode")}catch(u){u.response&&u.response.status===422?f(u.response.data.errors||{form:u.response.data.message}):f({form:((v=(l=u.response)==null?void 0:l.data)==null?void 0:v.message)||"ƒê√£ c√≥ l·ªói h·ªá th·ªëng x·∫£y ra."})}finally{B(!1)}},c="mt-1 block w-full px-3 py-2 bg-gray-50 dark:bg-gray-700/50 border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-sky-500 focus:border-sky-500 dark:text-white transition-colors disabled:bg-gray-200 dark:disabled:bg-gray-700 disabled:cursor-not-allowed";return ae?e.jsx("div",{className:"flex justify-center items-center h-screen bg-slate-50 dark:bg-gray-900 text-gray-600 dark:text-gray-400",children:"ƒêang t·∫£i d·ªØ li·ªáu..."}):e.jsx("div",{className:"font-sans bg-slate-50 dark:bg-gray-900 min-h-screen p-4 sm:p-6 lg:p-8",children:e.jsxs("form",{onSubmit:me,className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>o(-1),className:"flex items-center text-sm font-medium text-gray-600 hover:text-sky-600 dark:text-gray-400 dark:hover:text-sky-400 mb-2",children:[e.jsx(je,{}),"Quay l·∫°i danh s√°ch"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Ch·ªânh s·ª≠a Khuy·∫øn M√£i"}),e.jsxs("p",{className:"mt-1 text-md text-gray-600 dark:text-gray-400",children:["M√£:"," ",e.jsx("span",{className:"font-mono text-sky-600 dark:text-sky-400",children:t==null?void 0:t.code})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{type:"submit",disabled:A||y,className:"w-full sm:w-auto inline-flex justify-center items-center py-3 px-6 border border-transparent shadow-sm text-base font-medium rounded-lg text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:bg-gray-400 disabled:cursor-not-allowed dark:focus:ring-offset-gray-900 transition-colors",children:A?"ƒêang l∆∞u...":"L∆∞u thay ƒë·ªïi"})})]}),y&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300 p-4 rounded-lg flex items-center",children:[e.jsx(ve,{}),e.jsx("span",{className:"font-medium",children:ie})]}),i.form&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 p-4 rounded-lg text-sm",children:i.form}),e.jsx("fieldset",{disabled:y,className:"contents",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs(N,{title:"Th√¥ng tin c∆° b·∫£n",icon:e.jsx(ke,{}),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(d,{label:"M√£ gi·∫£m gi√°",id:"code",error:(W=i.code)==null?void 0:W[0],children:e.jsx("input",{type:"text",name:"code",id:"code",value:(t==null?void 0:t.code)||"",onChange:x,className:c,placeholder:"VD: SALEHE2025"})}),e.jsx(d,{label:"Ph·∫ßn trƒÉm gi·∫£m (%)",id:"discount_value",error:($=i.discount_value)==null?void 0:$[0],children:e.jsx("input",{type:"number",name:"discount_value",id:"discount_value",value:(t==null?void 0:t.discount_value)||"",onChange:x,min:"1",max:"100",className:c,placeholder:"VD: 20"})})]}),e.jsx(d,{label:"M√¥ t·∫£",id:"description",error:(K=i.description)==null?void 0:K[0],children:e.jsx("textarea",{name:"description",id:"description",value:(t==null?void 0:t.description)||"",onChange:x,rows:"4",className:c,placeholder:"M√¥ t·∫£ ng·∫Øn g·ªçn..."})})]}),e.jsx(N,{title:"ƒêi·ªÅu ki·ªán √°p d·ª•ng",icon:e.jsx(se,{}),children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[_==="all"&&e.jsx(d,{label:"T·ªïng l∆∞·ª£t s·ª≠ d·ª•ng",id:"usage_limit",error:(P=i.usage_limit)==null?void 0:P[0],children:e.jsx("input",{type:"number",name:"usage_limit",id:"usage_limit",value:(t==null?void 0:t.usage_limit)||"",onChange:x,min:"-1",className:c,placeholder:"-1 l√† kh√¥ng gi·ªõi h·∫°n"})}),e.jsx(d,{label:"L∆∞·ª£t d√πng/Ng∆∞·ªùi",id:"per_user_limit",error:(H=i.per_user_limit)==null?void 0:H[0],children:e.jsx("input",{type:"number",name:"per_user_limit",id:"per_user_limit",value:(t==null?void 0:t.per_user_limit)||"",onChange:x,min:"-1",className:c,placeholder:"-1 l√† kh√¥ng gi·ªõi h·∫°n"})}),e.jsx(d,{label:"Gi√° tr·ªã gi·∫£m t·ªëi thi·ªÉu (VNƒê)",id:"min_discount_amount",error:(G=i.min_discount_amount)==null?void 0:G[0],children:e.jsx("input",{type:"number",name:"min_discount_amount",id:"min_discount_amount",value:(t==null?void 0:t.min_discount_amount)||"",onChange:x,min:"0",className:c,placeholder:"B·ªè tr·ªëng n·∫øu kh√¥ng c√≥"})}),e.jsx(d,{label:"Gi√° tr·ªã gi·∫£m t·ªëi ƒëa (VNƒê)",id:"max_discount_amount",error:(O=i.max_discount_amount)==null?void 0:O[0],children:e.jsx("input",{type:"number",name:"max_discount_amount",id:"max_discount_amount",value:(t==null?void 0:t.max_discount_amount)||"",onChange:x,min:"0",className:c,placeholder:"B·ªè tr·ªëng n·∫øu kh√¥ng c√≥"})})]})})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[e.jsxs(N,{title:"Th·ªùi gian hi·ªáu l·ª±c",icon:e.jsx(be,{}),children:[e.jsx(d,{label:"Ng√†y b·∫Øt ƒë·∫ßu",id:"start_date",error:(q=i.start_date)==null?void 0:q[0],children:e.jsx("input",{type:"datetime-local",name:"start_date",id:"start_date",value:(t==null?void 0:t.start_date)||"",onChange:x,className:c})}),e.jsx(d,{label:"Ng√†y k·∫øt th√∫c",id:"end_date",error:(Q=i.end_date)==null?void 0:Q[0],children:e.jsx("input",{type:"datetime-local",name:"end_date",id:"end_date",value:(t==null?void 0:t.end_date)||"",onChange:x,className:c})})]}),e.jsxs(N,{title:"C·∫•u h√¨nh",icon:e.jsx(se,{}),children:[e.jsx(d,{label:"Tr·∫°ng th√°i",id:"status",error:(Z=i.status)==null?void 0:Z[0],children:e.jsxs("select",{id:"status",name:"status",value:U,onChange:a=>V(a.target.value),className:c,children:[e.jsx("option",{value:1,children:"K√≠ch ho·∫°t"}),e.jsx("option",{value:0,children:"·∫®n"})]})}),e.jsx(d,{label:"ƒê·ªëi t∆∞·ª£ng √°p d·ª•ng",id:"target_type",error:(J=i.user_id)==null?void 0:J[0],children:e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("label",{htmlFor:"target_all",className:`flex items-center p-3 w-full bg-gray-50 dark:bg-gray-700/50 border dark:border-gray-700 rounded-lg ${y?"cursor-not-allowed opacity-70":"cursor-pointer hover:bg-sky-50 hover:border-sky-300 dark:hover:bg-gray-700"} transition-all`,children:[e.jsx("input",{id:"target_all",name:"target_type",type:"radio",value:"all",checked:_==="all",onChange:R,className:"h-4 w-4 text-sky-600 border-gray-300 focus:ring-sky-500"}),e.jsx("span",{className:"ml-3 block text-sm font-medium text-gray-900 dark:text-gray-200",children:"T·∫•t c·∫£ ng∆∞·ªùi d√πng"})]}),e.jsxs("label",{htmlFor:"target_specific",className:`flex items-center p-3 w-full bg-gray-50 dark:bg-gray-700/50 border dark:border-gray-700 rounded-lg ${y?"cursor-not-allowed opacity-70":"cursor-pointer hover:bg-sky-50 hover:border-sky-300 dark:hover:bg-gray-700"} transition-all`,children:[e.jsx("input",{id:"target_specific",name:"target_type",type:"radio",value:"specific",checked:_==="specific",onChange:R,className:"h-4 w-4 text-sky-600 border-gray-300 focus:ring-sky-500"}),e.jsx("span",{className:"ml-3 block text-sm font-medium text-gray-900 dark:text-gray-200",children:"Ng∆∞·ªùi d√πng c·ª• th·ªÉ"})]})]})}),_==="specific"&&e.jsx("div",{className:"relative",children:M?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-sky-50 dark:bg-sky-900/40 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sky-800 dark:text-sky-200",children:M.username||"N/A"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:M.email})]}),!y&&e.jsx("button",{type:"button",onClick:()=>{w(null),j(null)},className:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-semibold text-2xl leading-none",children:"√ó"})]}):!y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(_e,{})}),e.jsx("input",{type:"text",value:k,onChange:a=>E(a.target.value),className:"block w-full pl-10 pr-3 py-2 bg-gray-50 dark:bg-gray-700/50 border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-sky-500 focus:border-sky-500 dark:text-white",placeholder:"T√¨m theo t√™n, email, ho·∫∑c ID..."})]}),k.trim()&&!ce&&L.length===0&&e.jsx("div",{className:"text-center py-4 text-sm text-gray-500 dark:text-gray-400",children:"Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng."}),L.length>0&&e.jsx("ul",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-800 shadow-lg max-h-60 rounded-md text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm",children:L.map((a,s)=>e.jsx("li",{onClick:()=>ue(a),className:"text-gray-900 dark:text-white cursor-pointer select-none relative py-2 pl-4 pr-4 hover:bg-sky-100 dark:hover:bg-sky-900/50",children:e.jsxs("span",{className:"font-normal block truncate",children:[a.username," ",e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["(",a.email,")"]})]})},s))})]})})]})]})]})})]})})};export{we as default};
