import{y as le,l as de,u as ce,r as i,j as e,e as L}from"./index-BDAcJp4Y.js";import{U as ue}from"./UserSelectionModal-I3o8ew99.js";const me=({children:m,className:o})=>e.jsx("span",{className:`inline-block w-5 h-5 mr-2 align-middle ${o}`,children:m}),ge=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6h.008v.008H6V6z"})]}),he=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0h18M-4.5 12h27"})}),Q=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962c.51.054.994.093 1.485.127a18.154 18.154 0 010 2.863m-7.5 0a9.094 9.094 0 013.741-.479 3 3 0 014.682-2.72M13.5 5.25h3V7.5h-3V5.25zm-8.25 5.25h3V13.5h-3V10.5z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),xe=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})}),pe=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"})}),w=({title:m,icon:o,children:g})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800/50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("h3",{className:"text-lg font-semibold leading-6 text-gray-900 dark:text-gray-100 flex items-center",children:[e.jsx(me,{className:"text-sky-600 dark:text-sky-400",children:o}),m]})}),e.jsx("div",{className:"p-5 space-y-6",children:g})]}),l=({label:m,id:o,error:g,children:t})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:o,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5",children:m}),t,g&&e.jsx("p",{className:"mt-1.5 text-sm text-red-600 dark:text-red-500",children:g})]}),ke=()=>{var B,E,z,A,F,O,P,R,W,$,H;const{id:m}=le(),o=de(),{pop:g}=ce(),[t,M]=i.useState(null),[S,T]=i.useState(1),[r,f]=i.useState({}),[D,I]=i.useState(!1),[J,X]=i.useState(!0),[k,Y]=i.useState(!1),[Z,ee]=i.useState(""),[j,C]=i.useState("all"),[te,v]=i.useState([]),[b,N]=i.useState([]),[se,ae]=i.useState([]),[ne,U]=i.useState(!1);i.useEffect(()=>{(async()=>{var s,_,y,x;try{const[c,oe]=await Promise.all([L.get(`/admin/discountcode/${m}`),L.get("/admin/discountcode/user")]),a=(s=c.data)==null?void 0:s.data;if(!a){g("Không tìm thấy mã khuyến mãi.","e"),o("/admin/discountcode");return}ae(((_=oe.data)==null?void 0:_.data)||[]);const K=u=>{if(!u)return"";const p=new Date(u);return p.setMinutes(p.getMinutes()-p.getTimezoneOffset()),p.toISOString().slice(0,16)};if(M({code:a.code||"",description:a.description||"",usage_limit:a.usage_limit??"",per_user_limit:a.per_user_limit??"",discount_value:a.discount_value||"",min_discount_amount:a.min_discount_amount||"",max_discount_amount:a.max_discount_amount||"",start_date:K(a.start_date),end_date:K(a.end_date)}),T(a.status),a.promotion_user_id===-1||!a.promotion_user||a.promotion_user.length===0)C("all"),N([]),v([]);else{C("specific");const u=a.promotion_user.map(p=>p.user);N(u),v(u.map(p=>p.id))}const G=new Date(a.end_date)<new Date,q=a.total_used>0;if(q||G){Y(!0);let u="";q&&(u="Mã đã được sử dụng."),G&&(u+=(u?" ":"")+"Mã đã hết hạn."),ee(u+" Không thể chỉnh sửa để đảm bảo tính nhất quán.")}}catch(c){console.error("Lỗi khi tải dữ liệu:",c),g(((x=(y=c.response)==null?void 0:y.data)==null?void 0:x.message)||"Lỗi khi tải dữ liệu!","e"),o("/admin/discountcode")}finally{X(!1)}})()},[m,o,g]);const h=n=>{const{name:s,value:_}=n.target,y=["usage_limit","per_user_limit","discount_value","min_discount_amount","max_discount_amount","start_date","end_date"];M(x=>({...x,[s]:y.includes(s)?_:_.toUpperCase()})),r[s]&&f(x=>({...x,[s]:null}))},re=n=>{N(n),v(n.map(s=>s.id))},V=n=>{const s=n.target.value;C(s),s==="all"&&(N([]),v([]))},ie=async n=>{var y,x;if(n.preventDefault(),k)return;I(!0),f({});let s={...t};j==="specific"&&(s.usage_limit=s.per_user_limit);const _={...s,discount_value:s.discount_value?Number(s.discount_value):null,usage_limit:s.usage_limit!==""?Number(s.usage_limit):-1,per_user_limit:s.per_user_limit!==""?Number(s.per_user_limit):-1,min_discount_amount:s.min_discount_amount!==""?Number(s.min_discount_amount):null,max_discount_amount:s.max_discount_amount!==""?Number(s.max_discount_amount):null,target_user_id:te,status:Number(S)};try{await L.put(`/admin/discountcode/${m}`,_),g("Cập nhật mã giảm giá thành công!","s"),o("/admin/discountcode")}catch(c){c.response&&c.response.status===422?f(c.response.data.errors||{form:c.response.data.message}):f({form:((x=(y=c.response)==null?void 0:y.data)==null?void 0:x.message)||"Đã có lỗi hệ thống xảy ra."})}finally{I(!1)}},d="mt-1 block w-full px-3 py-2 bg-gray-50 dark:bg-gray-700/50 border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-sky-500 focus:border-sky-500 dark:text-white transition-colors disabled:bg-gray-200 dark:disabled:bg-gray-700 disabled:cursor-not-allowed";return J?e.jsx("div",{className:"flex justify-center items-center h-screen bg-slate-50 dark:bg-gray-900 text-gray-600 dark:text-gray-400",children:"Đang tải dữ liệu..."}):e.jsxs("div",{className:"font-sans bg-slate-50 dark:bg-gray-900 min-h-screen p-4 sm:p-6 lg:p-8",children:[e.jsxs("form",{onSubmit:ie,className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>o(-1),className:"flex items-center text-sm font-medium text-gray-600 hover:text-sky-600 dark:text-gray-400 dark:hover:text-sky-400 mb-2",children:[e.jsx(xe,{}),"Quay lại danh sách"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Chỉnh sửa Khuyến Mãi"}),e.jsxs("p",{className:"mt-1 text-md text-gray-600 dark:text-gray-400",children:["Mã:"," ",e.jsx("span",{className:"font-mono text-sky-600 dark:text-sky-400",children:t==null?void 0:t.code})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{type:"submit",disabled:D||k,className:"w-full sm:w-auto inline-flex justify-center items-center py-3 px-6 border border-transparent shadow-sm text-base font-medium rounded-lg text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:bg-gray-400 disabled:cursor-not-allowed dark:focus:ring-offset-gray-900 transition-colors",children:D?"Đang lưu...":"Lưu thay đổi"})})]}),k&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300 p-4 rounded-lg flex items-center",children:[e.jsx(pe,{}),e.jsx("span",{className:"font-medium",children:Z})]}),r.form&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 p-4 rounded-lg text-sm",children:r.form}),e.jsx("fieldset",{disabled:k,className:"contents",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsxs(w,{title:"Thông tin cơ bản",icon:e.jsx(ge,{}),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{label:"Mã giảm giá",id:"code",error:(B=r.code)==null?void 0:B[0],children:e.jsx("input",{type:"text",name:"code",id:"code",value:(t==null?void 0:t.code)||"",onChange:h,className:d,placeholder:"VD: SALEHE2025"})}),e.jsx(l,{label:"Phần trăm giảm (%)",id:"discount_value",error:(E=r.discount_value)==null?void 0:E[0],children:e.jsx("input",{type:"number",name:"discount_value",id:"discount_value",value:(t==null?void 0:t.discount_value)||"",onChange:h,className:d,placeholder:"VD: 20"})})]}),e.jsx(l,{label:"Mô tả",id:"description",error:(z=r.description)==null?void 0:z[0],children:e.jsx("textarea",{name:"description",id:"description",value:(t==null?void 0:t.description)||"",onChange:h,rows:"4",className:d,placeholder:"Mô tả ngắn gọn..."})})]}),e.jsx(w,{title:"Điều kiện áp dụng",icon:e.jsx(Q,{}),children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[j==="all"&&e.jsx(l,{label:"Tổng lượt sử dụng",id:"usage_limit",error:(A=r.usage_limit)==null?void 0:A[0],children:e.jsx("input",{type:"number",name:"usage_limit",id:"usage_limit",value:(t==null?void 0:t.usage_limit)||"",onChange:h,className:d,placeholder:"-1 là không giới hạn"})}),e.jsx(l,{label:"Lượt dùng/Người",id:"per_user_limit",error:(F=r.per_user_limit)==null?void 0:F[0],children:e.jsx("input",{type:"number",name:"per_user_limit",id:"per_user_limit",value:(t==null?void 0:t.per_user_limit)||"",onChange:h,className:d,placeholder:"-1 là không giới hạn"})}),e.jsx(l,{label:"Giá trị giảm tối thiểu (VNĐ)",id:"min_discount_amount",error:(O=r.min_discount_amount)==null?void 0:O[0],children:e.jsx("input",{type:"number",name:"min_discount_amount",id:"min_discount_amount",value:(t==null?void 0:t.min_discount_amount)||"",onChange:h,className:d,placeholder:"Bỏ trống nếu không có"})}),e.jsx(l,{label:"Giá trị giảm tối đa (VNĐ)",id:"max_discount_amount",error:(P=r.max_discount_amount)==null?void 0:P[0],children:e.jsx("input",{type:"number",name:"max_discount_amount",id:"max_discount_amount",value:(t==null?void 0:t.max_discount_amount)||"",onChange:h,className:d,placeholder:"Bỏ trống nếu không có"})})]})})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-8",children:[e.jsxs(w,{title:"Thời gian hiệu lực",icon:e.jsx(he,{}),children:[e.jsx(l,{label:"Ngày bắt đầu",id:"start_date",error:(R=r.start_date)==null?void 0:R[0],children:e.jsx("input",{type:"datetime-local",name:"start_date",id:"start_date",value:(t==null?void 0:t.start_date)||"",onChange:h,className:d})}),e.jsx(l,{label:"Ngày kết thúc",id:"end_date",error:(W=r.end_date)==null?void 0:W[0],children:e.jsx("input",{type:"datetime-local",name:"end_date",id:"end_date",value:(t==null?void 0:t.end_date)||"",onChange:h,className:d})})]}),e.jsxs(w,{title:"Cấu hình",icon:e.jsx(Q,{}),children:[e.jsx(l,{label:"Trạng thái",id:"status",error:($=r.status)==null?void 0:$[0],children:e.jsxs("select",{id:"status",name:"status",value:S,onChange:n=>T(n.target.value),className:d,children:[e.jsx("option",{value:1,children:"Kích hoạt"}),e.jsx("option",{value:0,children:"Ẩn"})]})}),e.jsx(l,{label:"Đối tượng áp dụng",id:"target_type",error:(H=r.target_user_id)==null?void 0:H[0],children:e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("label",{htmlFor:"target_all",className:`flex items-center p-3 w-full bg-gray-50 dark:bg-gray-700/50 border dark:border-gray-700 rounded-lg ${k?"cursor-not-allowed opacity-70":"cursor-pointer"}`,children:[e.jsx("input",{id:"target_all",name:"target_type",type:"radio",value:"all",checked:j==="all",onChange:V,className:"h-4 w-4 text-sky-600 border-gray-300 focus:ring-sky-500"}),e.jsx("span",{className:"ml-3 block text-sm font-medium text-gray-900 dark:text-gray-200",children:"Tất cả người dùng"})]}),e.jsxs("label",{htmlFor:"target_specific",className:`flex items-center p-3 w-full bg-gray-50 dark:bg-gray-700/50 border dark:border-gray-700 rounded-lg ${k?"cursor-not-allowed opacity-70":"cursor-pointer"}`,children:[e.jsx("input",{id:"target_specific",name:"target_type",type:"radio",value:"specific",checked:j==="specific",onChange:V,className:"h-4 w-4 text-sky-600 border-gray-300 focus:ring-sky-500"}),e.jsx("span",{className:"ml-3 block text-sm font-medium text-gray-900 dark:text-gray-200",children:"Người dùng cụ thể"})]})]})}),j==="specific"&&e.jsxs("div",{className:"space-y-3 p-3 border border-dashed dark:border-gray-600 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"font-medium text-sm text-gray-700 dark:text-gray-300",children:["Người dùng đã chọn (",b.length,")"]}),e.jsx("button",{type:"button",onClick:()=>U(!0),className:"text-sm font-medium text-sky-600 hover:text-sky-800 dark:text-sky-400 dark:hover:text-sky-200",children:b.length>0?"Thay đổi danh sách":"Chọn người dùng"})]}),b.length>0&&e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2",children:b.map(n=>e.jsxs("div",{className:"flex items-center p-2 bg-gray-100 dark:bg-gray-700/50 rounded-md text-xs",children:[e.jsx("p",{className:"flex-1 font-medium text-gray-800 dark:text-gray-200 truncate",children:n.username}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 truncate ml-2",children:n.email})]},n.id))})]})]})]})]})})]}),e.jsx(ue,{isOpen:ne,onClose:()=>U(!1),onConfirm:re,allUsers:se,initialSelectedUsers:b})]})};export{ke as default};
