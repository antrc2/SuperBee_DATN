import{k as ie,d as oe,r as s,j as t,g as se,h as S}from"./index-DJ8jfsRI.js";import{T as ne,F as le}from"./file.min-ZlYAjpA8.js";import{k as ce}from"./marked.esm-CumxtpOb.js";import{y as c}from"./index-CI9egkgJ.js";const Q=u=>u.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-"),de=u=>u===null||u.trim()===""||u.replace(/<[^>]*>/g,"").trim()==="",W=u=>{const b=new DOMParser().parseFromString(u||"<div></div>","text/html");return b.querySelectorAll("img").forEach(n=>{n.style.display="block",n.style.marginLeft="auto",n.style.marginRight="auto",n.classList.remove("fr-fic","fr-dib","fr-fil","fr-fir")}),b.querySelectorAll("video, iframe").forEach(n=>{n.tagName==="VIDEO"&&(n.getAttribute("controls")||n.setAttribute("controls","")),n.style.display="block",n.style.marginLeft="auto",n.style.marginRight="auto",n.style.width="100%",n.tagName==="IFRAME"&&(n.style.height="auto",n.style.border="none")}),b.body.innerHTML};function fe(){const{id:u}=ie(),P=oe(),b=s.useMemo(()=>{const e=new ne({headingStyle:"atx",bulletListMarker:"*",codeBlockStyle:"fenced"});return e.addRule("videoLink",{filter:function(r){return r.nodeName==="VIDEO"&&(r.getAttribute("src")||r.querySelector("source"))},replacement:function(r,a){const o=a.getAttribute("src")||(a.querySelector("source")?a.querySelector("source").getAttribute("src"):null);return o?`![Video](${o})`:""}}),e.addRule("iframeEmbed",{filter:function(r){return r.nodeName==="IFRAME"&&(r.getAttribute("src")||r.getAttribute("data-src"))},replacement:function(r,a){const o=a.getAttribute("src")||a.getAttribute("data-src"),i=a.getAttribute("width")||"560",l=a.getAttribute("height")||"315";return`<iframe src="${o}" width="${i}" height="${l}" frameborder="0" allowfullscreen></iframe>`}}),e.addRule("fileLink",{filter:function(r){return r.nodeName==="A"&&r.classList.contains("fr-file")},replacement:function(r,a){const o=a.getAttribute("href");return`[${a.textContent.trim()}](${o})`}}),e},[]),[U,V]=s.useState(null),[n,I]=s.useState([]),[D,y]=s.useState(""),[A,L]=s.useState(!1),[v,F]=s.useState(""),[O,E]=s.useState(""),[B,w]=s.useState(""),[N,z]=s.useState(""),[_,K]=s.useState(""),[T,q]=s.useState(""),[k,Y]=s.useState(null),[H,J]=s.useState(null),[Z,G]=s.useState(!0),[C,j]=s.useState(!1),[g,M]=s.useState({}),[X,f]=s.useState(null),x="https://superbee.site/backend/public/index.php/api",$=sessionStorage.getItem("access_token"),ee={placeholderText:"Nhập nội dung bài viết...",toolbarButtons:{moreText:{buttons:["bold","italic","underline","strikeThrough","subscript","superscript","fontFamily","fontSize","textColor","backgroundColor","clearFormatting"],buttonsVisible:6},moreParagraph:{buttons:["alignLeft","alignCenter","alignRight","alignJustify","formatOL","formatUL","paragraphFormat","paragraphStyle","lineHeight","outdent","indent"],buttonsVisible:5},moreRich:{buttons:["insertLink","insertImage","insertVideo","insertFile","insertTable","emoticons","specialCharacters","insertHR","undo","redo"],buttonsVisible:6},moreMisc:{buttons:["quote","codeView","fullscreen","help","selectAll","print","getPDF","html","save"],buttonsVisible:3}},imageUpload:!0,imageUploadURL:`${x}/admin/post/upload`,imageUploadMethod:"POST",imageManagerLoadURL:`${x}/admin/post/load-images`,imageManagerDeleteURL:`${x}/admin/post/delete-image`,imageManagerDeleteMethod:"POST",imageAllowedTypes:["jpeg","jpg","png","gif"],imageMaxSize:5*1024*1024,imageEditButtons:["imageDisplay","imageAlign","imageSize","imageRemove","imageLink","imageAlt"],imageDefaultAlign:"center",imageDefaultDisplay:"block",videoUpload:!0,videoUploadURL:`${x}/admin/post/upload`,videoUploadMethod:"POST",videoAllowedTypes:["mp4","webm","ogg","avi","mov"],videoMaxSize:50*1024*1024,videoEditButtons:["videoDisplay","videoAlign","videoSize","videoRemove","videoLink"],videoDefaultAlign:"center",videoDefaultDisplay:"block",videoAllowedProviders:["youtube","vimeo","dailymotion","tiktok"],videoInsertButtons:["videoBack","|","videoByURL","videoEmbed","videoUpload"],fileUpload:!0,fileUploadURL:`${x}/admin/post/upload-file`,fileUploadMethod:"POST",fileAllowedTypes:["pdf","doc","docx","xls","xlsx","ppt","pptx","zip","rar","txt","csv","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/zip","application/x-rar-compressed","text/plain","text/csv"],fileMaxSize:20*1024*1024,htmlAllowedTags:[".*"],htmlAllowedAttrs:[".*"],htmlAllowedEmptyTags:["video","source","iframe"],requestHeaders:{Authorization:"Bearer "+$},events:{"image.inserted":function(e,r){e.css({display:"block","margin-left":"auto","margin-right":"auto"}),e.removeClass("fr-fic fr-dib fr-fil fr-fir")},"image.replaced":function(e,r){e.css({display:"block","margin-left":"auto","margin-right":"auto"}),e.removeClass("fr-fic fr-dib fr-fil fr-fir")},"video.inserted":function(e,r){try{let a=null;typeof r=="string"?a=JSON.parse(r).link:r&&r.link?a=r.link:e.attr("src")?a=e.attr("src"):e.find("source").length&&(a=e.find("source").attr("src")),a?e[0].tagName==="VIDEO"&&(e.attr("controls","true"),e.css({display:"block","margin-left":"auto","margin-right":"auto",width:"100%",height:"auto"}),e.removeClass("fr-fic fr-dib fr-fil fr-fir"),c.success("Video đã được chèn thành công!")):e[0].tagName==="IFRAME"?(e.css({display:"block","margin-left":"auto","margin-right":"auto",width:"100%",height:"auto",border:"none"}),c.success("Video nhúng đã được chèn thành công!")):(console.warn("Không xác định được loại video được chèn:",e,r),c.error("Có lỗi xảy ra: Không xác định được loại video được chèn."))}catch(a){console.error("Lỗi khi chèn video Froala:",a),c.error("Có lỗi xảy ra khi chèn video. Vui lòng thử lại.")}},"video.replaced":function(e,r){e.css({display:"block","margin-left":"auto","margin-right":"auto",width:"100%",height:"auto"}),e[0].tagName==="VIDEO"?e.attr("controls","true"):e[0].tagName==="IFRAME"&&e.css("border","none"),e.removeClass("fr-fic fr-dib fr-fil fr-fir")},"video.error":function(e,r){console.error("Lỗi Froala Video:",e),c.error(`Có lỗi khi tải lên/chèn video: ${e.message||"Không rõ lỗi"}. Vui lòng thử lại.`)},"file.inserted":function(e,r){try{const a=typeof r=="string"?JSON.parse(r):r,o=a.link,i=a.name||"Tệp đính kèm";if(!o){c.error("Có lỗi xảy ra: Không nhận được liên kết tệp từ máy chủ.");return}e.html(`<i class="fas fa-file-alt"></i> ${i}`),e.attr("href",o),e.attr("target","_blank"),e.attr("download",i),c.success(`Tệp "${i}" đã được chèn.`)}catch(a){console.error("Lỗi khi chèn file:",a),c.error("Có lỗi xảy ra khi chèn tệp. Vui lòng thử lại.")}},"file.error":function(e,r){console.error("Lỗi Froala File:",e),c.error(`Có lỗi khi tải lên/chèn tệp: ${e.message||"Không rõ lỗi"}. Vui lòng thử lại.`)}},heightMin:400,heightMax:800,charCounterCount:!0,wordPasteKeepFormatting:!1};s.useEffect(()=>{(async()=>{var r,a,o,i;try{G(!0);const[l,h]=await Promise.all([S.get(`/admin/post/${u}`),S.get("/admin/categoryPost")]),m=l.data.data;if(!m)throw new Error("Không tìm thấy dữ liệu bài viết trong phản hồi API.");V(m),z(m.title||""),K(m.description||"");let d=ce.parse(m.content||"");d=W(d),q(d),y(((r=m.category_id)==null?void 0:r.toString())||""),J(m.image_thumbnail_url||null),I(((o=(a=h.data)==null?void 0:a.data)==null?void 0:o.data)||[])}catch(l){console.error("Lỗi khi tải dữ liệu:",((i=l.response)==null?void 0:i.data)||l.message);const h=l.message||"Không thể tải dữ liệu bài viết hoặc danh mục.";f(h),c.error(h)}finally{G(!1)}})()},[u]);const te=async e=>{var r,a,o;if(e.preventDefault(),!v.trim()){w("Tên danh mục không được để trống.");return}w(""),j(!0),f(null);try{const i=await S.post("/admin/categoryPost/new",{name:v.trim(),slug:Q(v.trim()),description:O.trim()}),l=i.data.data||i.data;I(h=>[...h,l]),y(l.id.toString()),L(!1),F(""),E(""),c.success("Danh mục đã được tạo thành công!")}catch(i){if(console.error("Lỗi khi tạo danh mục:",((r=i.response)==null?void 0:r.data)||i.message),((a=i.response)==null?void 0:a.status)===422){const l=(o=i.response.data)==null?void 0:o.errors;l&&l.name?w(l.name[0]):f("Lỗi xác thực dữ liệu.")}else f("Không thể tạo danh mục.");c.error("Không thể tạo danh mục.")}finally{j(!1)}},re=()=>{const e={};return N.trim()||(e.title="Tiêu đề không được để trống."),de(T)&&(e.content="Nội dung không được để trống."),!D&&!A&&(e.category="Vui lòng chọn hoặc tạo danh mục."),M(e),Object.keys(e).length===0},ae=async e=>{var r,a,o,i,l,h,m;if(e.preventDefault(),!re()){c.error("Vui lòng kiểm tra lại các trường bị lỗi.");return}j(!0),f(null);try{const d=W(T),R=b.turndown(d),p=new FormData;p.append("title",N.trim()),p.append("slug",Q(N.trim())),p.append("content",R),p.append("descriptionPost",_.trim()||""),p.append("category_id",D||""),p.append("status",U.status||0),p.append("author_id",1),k&&p.append("image_thumbnail",k),p.append("_method","POST"),(await S.post(`/admin/post/${u}`,p,{headers:{"Content-Type":"multipart/form-data"}})).status===200&&(c.success("Bài viết đã được cập nhật thành công!"),P("/admin/post"))}catch(d){console.error("Lỗi khi cập nhật bài viết:",((r=d.response)==null?void 0:r.data)||d.message),f(((o=(a=d.response)==null?void 0:a.data)==null?void 0:o.message)||"Có lỗi xảy ra khi cập nhật bài viết, vui lòng thử lại."),(l=(i=d.response)==null?void 0:i.data)!=null&&l.errors&&M(R=>({...R,...d.response.data.errors})),c.error(((m=(h=d.response)==null?void 0:h.data)==null?void 0:m.message)||"Có lỗi xảy ra khi cập nhật bài viết.")}finally{j(!1)}};return Z?t.jsx(se,{}):t.jsxs("div",{className:"max-w-5xl mx-auto my-8 p-6 bg-white rounded-lg shadow-xl",children:[t.jsx("h2",{className:"text-3xl font-bold text-center text-gray-800 mb-6",children:"Chỉnh Sửa Bài Viết"}),X&&t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[t.jsx("strong",{className:"font-bold",children:"Lỗi: "}),t.jsx("span",{className:"block sm:inline",children:X})]}),t.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postTitle",className:"block text-gray-700 text-sm font-bold mb-2",children:"Tiêu đề bài viết:"}),t.jsx("input",{type:"text",id:"postTitle",value:N,onChange:e=>z(e.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent",placeholder:"Nhập tiêu đề bài viết"}),g.title&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:g.title})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postDescription",className:"block text-gray-700 text-sm font-bold mb-2",children:"Mô tả bài viết:"}),t.jsx("textarea",{id:"postDescription",value:_,onChange:e=>K(e.target.value),rows:4,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-y",placeholder:"Nhập mô tả bài viết"}),g.descriptionPost&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:g.descriptionPost})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"postContent",className:"block text-gray-700 text-sm font-bold mb-2",children:"Nội dung bài viết:"}),t.jsx(le,{tag:"textarea",config:ee,model:T,onModelChange:q}),g.content&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:g.content})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"imageFile",className:"block text-gray-700 text-sm font-bold mb-2",children:"Ảnh Thumbnail:"}),t.jsx("input",{type:"file",id:"imageFile",accept:"image/*",onChange:e=>{const r=e.target.files[0];r&&(Y(r),J(URL.createObjectURL(r)))},className:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),k&&t.jsxs("p",{className:"text-gray-600 text-xs italic mt-2",children:["Đã chọn file: ",k.name]}),H&&t.jsxs("div",{className:"mt-4",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Xem trước ảnh:"}),t.jsx("img",{src:H,alt:"Ảnh xem trước",className:"w-48 h-auto rounded-lg border border-gray-300 shadow-sm"})]}),g.image&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:g.image})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"categorySelect",className:"block text-gray-700 text-sm font-bold mb-2",children:"Danh mục:"}),!A&&t.jsxs("select",{id:"categorySelect",value:D,onChange:e=>{e.target.value==="new"?(L(!0),y("")):(y(e.target.value),M(r=>({...r,category:""})))},className:"block appearance-none w-full bg-white border border-gray-300 text-gray-700 py-2 px-3 pr-8 rounded leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent cursor-pointer",children:[t.jsx("option",{value:"",children:"-- Chọn danh mục --"}),n.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id)),t.jsx("option",{value:"new",children:"-- Thêm danh mục mới --"})]}),g.category&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:g.category})]}),A&&t.jsxs("div",{className:"border border-dashed border-gray-400 p-6 rounded-lg bg-blue-50",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-4",children:"Tạo Danh Mục Mới"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"newCategoryName",className:"block text-gray-700 text-sm font-bold mb-2",children:"Tên danh mục:"}),t.jsx("input",{type:"text",id:"newCategoryName",value:v,onChange:e=>F(e.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent",placeholder:"Nhập tên danh mục mới"}),B&&t.jsx("p",{className:"text-red-500 text-xs italic mt-2",children:B})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"newCategoryDescription",className:"block text-gray-700 text-sm font-bold mb-2",children:"Mô tả:"}),t.jsx("textarea",{id:"newCategoryDescription",value:O,onChange:e=>E(e.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent h-24 resize-y",placeholder:"Mô tả ngắn về danh mục"})]}),t.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[t.jsx("button",{type:"button",onClick:te,disabled:C,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-200",children:"Tạo Danh Mục"}),t.jsx("button",{type:"button",onClick:()=>{L(!1),F(""),E(""),w("")},className:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-200",children:"Hủy"})]})]})]}),t.jsx("div",{className:"flex justify-end pt-4",children:t.jsx("button",{type:"submit",disabled:C,className:`
                            ${C?"bg-green-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}
                            text-white font-bold py-3 px-6 rounded-lg focus:outline-none focus:shadow-outline transition duration-200 text-lg
                        `,children:C?"Đang cập nhật...":"Cập Nhật Bài Viết"})})]})]})}export{fe as default};
