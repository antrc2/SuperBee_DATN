import{c as k,r as n,m as x,d as p,b as v,h as j,D as b,j as t,aK as E,L}from"./index-DNv7UJt1.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]],V=k("mail-check",N);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["path",{d:"M22 10.5V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h12.5",key:"e61zoh"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"M20 14v4",key:"1hm744"}],["path",{d:"M20 22v.01",key:"12bgn6"}]],w=k("mail-warning",_),S=()=>{const[r,s]=n.useState(""),[K,f]=n.useState(null),[l,m]=n.useState(!1),h=x(),d=p(),{setUser:u}=v(),i=n.useRef(!1),g=n.useCallback(async o=>{var a;if(i.current){console.log("Xác minh đã được thử, bỏ qua yêu cầu trùng lặp.");return}if(!o){s("Không có mã xác minh để thực hiện. Vui lòng tải lại trang.");return}i.current=!0,m(!0),s("");try{const e=await j.get(`/verify-email?token=${o}`);if(((a=e==null?void 0:e.data)==null?void 0:a.status)===!1)throw new Error(e.data.message||"Không nhận được access_token từ server email.");const y=e.data.access_token;sessionStorage.setItem("access_token",y);const c=b();if(c)u({name:c.name,money:c.money,avatar:c.avatar,donate_code:c.donate_code}),d("/");else throw new Error("Không thể giải mã token từ phản hồi server. Vui lòng thử lại.")}catch(e){console.log("🚀 ~ verifyEmail ~ err:",e),e.response&&e.response.data?s(e.response.data.message||"Đã xảy ra lỗi khi xác minh email."):s("Không thể kết nối đến máy chủ để xác minh email. Vui lòng kiểm tra kết nối của bạn.")}finally{m(!1)}},[d,u]);return n.useEffect(()=>{const a=new URLSearchParams(h.search).get("token");a?(f(a),i.current||g(a)):s("Không tìm thấy mã xác minh trong liên kết. Vui lòng kiểm tra lại đường dẫn.")},[h.search,g]),t.jsx(E,{title:"Xác minh Email",icon:l?V:w,children:t.jsxs("div",{className:"text-center",children:[l&&!r&&t.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 my-4",children:[t.jsx("div",{className:"w-10 h-10 border-4 border-accent border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-lg font-semibold text-secondary",children:"Đang kiểm tra..."})]}),r&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"alert alert-danger",children:r}),t.jsxs("p",{className:"mt-6 text-sm text-secondary",children:["Vui lòng kiểm tra lại liên kết hoặc"," ",t.jsx(L,{to:"/activeAcc",className:"font-semibold text-accent hover:underline",children:"yêu cầu gửi lại email xác minh"}),"."]})]})]})})};export{S as default};
