import{c as M,r as o,j as e,e as S,W as O,aj as _,P as T,E as K,u as V,X as F,al as L,am as z,ah as A,Y as P,z as E,D as $,aB as I,ak as q,aw as H}from"./index-BDAcJp4Y.js";import{T as G}from"./trash-2-DFLD5LDh.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],X=M("film",U);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Y=M("upload",W),J={incorrect_login:"Sai thông tin đăng nhập",account_banned:"Tài khoản bị khóa/hạn chế",wrong_description:"Sản phẩm không đúng mô tả",account_retrieved:"Tài khoản bị chủ cũ lấy lại",other:"Lý do khác"},R=({item:n,order:m,onClose:u,onDisputeSuccess:p})=>{var D;const[l,v]=o.useState("incorrect_login"),[h,N]=o.useState(""),[x,j]=o.useState([]),[s,c]=o.useState(null),[i,g]=o.useState(!1);if(!n)return null;const f=a=>{const t=Array.from(a.target.files);if(x.length+t.length>10){c("Chỉ được tải lên tối đa 10 tệp (ảnh và video).");return}const r=[];for(const d of t){if(d.size>50*1024*1024){c(`Tệp "${d.name}" quá lớn. Kích thước tối đa là 50MB.`),a.target.value=null;return}r.push(d)}j(d=>[...d,...r]),c(null),a.target.value=null},b=a=>{j(t=>t.filter((r,d)=>d!==a)),x.length-1<=10&&c(null)},w=async a=>{var r,d;if(a.preventDefault(),!h.trim()){c("Vui lòng mô tả chi tiết sự cố.");return}if(x.length>10){c("Chỉ được tải lên tối đa 10 tệp. Vui lòng xóa bớt.");return}g(!0),c(null);const t=new FormData;t.append("order_item_id",n.id),t.append("dispute_type",l),t.append("description",h),x.forEach(y=>{t.append("attachments[]",y)});try{await S.post("/disputes",t,{headers:{"Content-Type":"multipart/form-data"}}),p()}catch(y){const B=((d=(r=y.response)==null?void 0:r.data)==null?void 0:d.message)||"Đã có lỗi xảy ra khi gửi khiếu nại. Vui lòng thử lại.";c(B),console.error(y)}finally{g(!1)}},C=a=>{if(a===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,d)).toFixed(2))+" "+r[d]};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex justify-center items-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dropdown border border-themed rounded-2xl shadow-2xl w-full max-w-lg max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-themed",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-500/10 rounded-lg",children:e.jsx(_,{className:"h-6 w-6 text-red-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Báo cáo sự cố"}),e.jsxs("p",{className:"text-secondary text-sm",children:["Sản phẩm: ",((D=n.product)==null?void 0:D.sku)||n.product_id]})]})]}),e.jsx("button",{onClick:u,className:"p-2 rounded-full text-secondary hover:text-primary hover:bg-accent/10 transition-colors",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:w,className:"p-6 overflow-y-auto flex-1 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Loại sự cố"}),e.jsx("select",{value:l,onChange:a=>v(a.target.value),className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover",children:Object.entries(J).map(([a,t])=>e.jsx("option",{value:a,children:t},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Mô tả chi tiết"}),e.jsx("textarea",{value:h,onChange:a=>N(a.target.value),className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover min-h-[120px]",placeholder:"Vui lòng mô tả rõ ràng vấn đề bạn gặp phải với tài khoản...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-secondary mb-2",children:["Ảnh/Video bằng chứng (",x.length,"/10 tệp)"]}),e.jsx("div",{className:"mt-2 flex justify-center rounded-lg border border-dashed border-themed px-6 py-10 bg-input",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"mx-auto h-12 w-12 text-secondary/50"}),e.jsxs("div",{className:"mt-4 flex text-sm leading-6 text-secondary",children:[e.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-semibold text-accent focus-within:outline-none hover:text-accent/80",children:[e.jsx("span",{children:"Tải tệp lên"}),e.jsx("input",{id:"file-upload",name:"attachments",type:"file",className:"sr-only",multiple:!0,accept:"image/png, image/jpeg, image/jpg, video/mp4, video/quicktime, video/webm",onChange:f})]}),e.jsx("p",{className:"pl-1",children:"hoặc kéo và thả"})]}),e.jsx("p",{className:"text-xs leading-5 text-secondary/70",children:"PNG, JPG, MP4, MOV, WEBM. Tối đa 50MB mỗi tệp."})]})}),x.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-primary",children:"Tệp đã chọn:"}),e.jsx("ul",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:x.map((a,t)=>e.jsxs("li",{className:"flex items-center justify-between text-sm text-secondary gap-2 bg-background/50 p-2 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[a.type.startsWith("image/")?e.jsx(P,{className:"h-5 w-5 text-accent flex-shrink-0"}):e.jsx(X,{className:"h-5 w-5 text-accent flex-shrink-0"}),e.jsx("span",{className:"truncate",title:a.name,children:a.name}),e.jsxs("span",{className:"text-xs text-secondary/70 flex-shrink-0",children:["(",C(a.size),")"]})]}),e.jsx("button",{type:"button",onClick:()=>b(t),className:"p-1 text-red-500 hover:text-red-400 flex-shrink-0",children:e.jsx(G,{className:"h-4 w-4"})})]},t))})]})]}),s&&e.jsx("div",{className:"p-3 bg-red-500/10 text-red-500 text-sm rounded-lg",children:s})]}),e.jsxs("div",{className:"p-4 border-t border-themed bg-background/50 text-right flex-shrink-0 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:u,className:"action-button action-button-secondary !w-auto",disabled:i,children:"Hủy"}),e.jsx("button",{type:"submit",onClick:w,className:"action-button action-button-primary !w-auto bg-gradient-danger hover:brightness-110",disabled:i||x.length>10||!h.trim(),children:i?e.jsx(E,{className:"h-5 w-5 animate-spin"}):"Gửi Khiếu nại"})]})]})})},Q=n=>{if(!n)return"N/A";const m=new Date(n),u=String(m.getDate()).padStart(2,"0"),p=String(m.getMonth()+1).padStart(2,"0"),l=m.getFullYear();return`${u}/${p}/${l}`},k=n=>(n==null&&(n=0),new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(n)),Z=({order:n,onClose:m,onStartDispute:u})=>{if(!n)return null;const{pop:p}=V(),[l,v]=o.useState({}),h=s=>{v(c=>({...c,[s]:!c[s]}))},N=s=>{s&&navigator.clipboard.writeText(s).then(()=>{p("Đã sao chép mật khẩu!","success")}).catch(c=>{p("Không thể sao chép mật khẩu!","error")})},x=s=>{const i={0:{text:"Chờ xử lý",icon:e.jsx(q,{className:"h-4 w-4"}),className:"text-yellow-500 bg-yellow-500/10"},1:{text:"Đang xử lý",icon:e.jsx(E,{className:"h-4 w-4 animate-spin"}),className:"text-blue-500 bg-blue-500/10"},2:{text:"Đã giải quyết",icon:e.jsx(I,{className:"h-4 w-4"}),className:"text-green-500 bg-green-500/10"},3:{text:"Đã từ chối",icon:e.jsx($,{className:"h-4 w-4"}),className:"text-red-500 bg-red-500/10"}}[s.status]||{text:"Không rõ",icon:e.jsx(H,{className:"h-4 w-4"}),className:"bg-gray-500/20 text-gray-400"};return e.jsxs("span",{className:`inline-flex items-center gap-1.5 text-xs font-semibold px-2 py-1 rounded-full ${i.className}`,children:[i.icon,i.text]})},j=n.items.reduce((s,c)=>s+Number.parseFloat(c.unit_price),0);return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex justify-center items-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dropdown border border-themed rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-themed flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-accent/10 rounded-lg",children:e.jsx(T,{className:"h-6 w-6 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Chi tiết đơn hàng"}),e.jsxs("p",{className:"text-secondary text-sm font-mono",children:["#",n.order_code]})]})]}),e.jsx("button",{onClick:m,className:"p-2 rounded-full text-secondary hover:text-primary hover:bg-accent/10 transition-colors",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Danh sách sản phẩm"}),e.jsx("div",{className:"space-y-3",children:n.items.map(s=>{var c,i,g,f;return e.jsxs("div",{className:"p-4 bg-background/50 rounded-lg border border-themed",children:[e.jsxs("div",{className:"flex items-start md:items-center gap-4 flex-col md:flex-row",children:[e.jsx("img",{src:((i=(c=s.product)==null?void 0:c.images[0])==null?void 0:i.image_url)||"/placeholder.svg",alt:s.product_name||"Sản phẩm",className:"h-16 w-16 object-cover rounded-lg border border-themed"}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("p",{className:"font-semibold text-primary",children:["SKU: ",((g=s.product)==null?void 0:g.sku)||s.product_id]}),e.jsx("p",{className:"text-sm font-bold text-accent",children:k(s.unit_price)})]}),e.jsxs("div",{className:"flex flex-row md:flex-col items-start md:items-end gap-2 mt-2 md:mt-0",children:[e.jsxs("button",{onClick:()=>h(s.id),className:"action-button action-button-secondary !w-auto !py-2 !px-3 !text-sm",children:[l[s.id]?"Ẩn":"Xem",l[s.id]?e.jsx(L,{className:"h-4 w-4 ml-1"}):e.jsx(z,{className:"h-4 w-4 ml-1"})]}),s.dispute?x(s.dispute):e.jsxs("button",{onClick:()=>u(s),className:"flex items-center gap-1 text-xs font-semibold text-red-500 hover:text-red-400 transition-colors",children:[e.jsx(_,{className:"h-3.5 w-3.5"})," Báo cáo sự cố"]})]})]}),l[s.id]&&e.jsx("div",{className:"mt-4 pt-4 border-t border-themed",children:(f=s.product)!=null&&f.credentials&&s.product.credentials.length>0?e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-primary mb-2",children:"Thông tin tài khoản"}),e.jsxs("div",{className:"space-y-3 bg-background/50 p-4 rounded-lg border border-themed",children:[e.jsxs("p",{className:"text-sm text-secondary",children:[e.jsx("span",{className:"font-medium text-primary",children:"Tên đăng nhập:"})," ",s.product.credentials[0].username]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-secondary",children:[e.jsx("span",{className:"font-medium text-primary",children:"Mật khẩu:"}),e.jsx("input",{type:"text",value:s.product.credentials[0].password,readOnly:!0,className:"bg-background text-same border border-themed p-1 rounded w-auto selection:bg-accent selection:text-background",onFocus:b=>b.target.select()}),e.jsx("button",{onClick:()=>N(s.product.credentials[0].password),className:"p-1.5 rounded-md bg-accent/10 hover:bg-accent/20 transition-colors",title:"Sao chép mật khẩu",children:e.jsx(A,{className:"h-4 w-4 text-accent"})})]}),e.jsx("i",{className:"text-xs text-secondary/70",children:"*Click vào ô mật khẩu để xem."})]})]}):e.jsx("p",{className:"text-sm text-secondary",children:"Không có thông tin chi tiết cho sản phẩm này."})})]},s.id)})})]}),e.jsxs("div",{className:"border-t border-themed pt-6",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Tổng kết"}),e.jsxs("div",{className:"space-y-3 bg-background/50 p-4 rounded-lg border border-themed",children:[e.jsxs("div",{className:"flex justify-between text-secondary",children:[e.jsx("span",{children:"Tạm tính:"}),e.jsx("span",{className:"font-medium",children:k(j)})]}),e.jsxs("div",{className:"flex justify-between text-secondary",children:[e.jsxs("span",{children:["Giảm giá (Mã: ",n.promo_code||"N/A","):"]}),e.jsxs("span",{className:"font-medium text-red-400",children:["- ",k(n.discount_amount)]})]}),e.jsxs("div",{className:"flex justify-between text-xl border-t border-themed pt-3 mt-3",children:[e.jsx("span",{className:"text-primary font-bold",children:"Thành tiền:"}),e.jsx("span",{className:"font-bold text-accent",children:k(n.total_amount)})]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-themed bg-background/50 text-right flex-shrink-0",children:e.jsx("button",{onClick:m,className:"action-button action-button-secondary !w-auto",children:"Đóng"})})]})})};function se(){const[n,m]=o.useState([]),[u,p]=o.useState([]),[l,v]=o.useState({search:"",status:"all",startDate:"",endDate:""}),[h,N]=o.useState(null),[x,j]=o.useState(!0),[s,c]=o.useState(null),[i,g]=o.useState(null),f=async()=>{j(!0),c(null);try{const r=(await S.get("/orders")).data.data.sort((d,y)=>new Date(y.created_at)-new Date(d.created_at));m(r),p(r)}catch(t){c("Không thể tải lịch sử đơn hàng. Vui lòng thử lại sau."),console.error(t)}finally{j(!1)}};o.useEffect(()=>{f()},[]),o.useEffect(()=>{let t=n.filter(r=>r.order_code.toLowerCase().includes(l.search.toLowerCase())&&(l.status==="all"||r.status.toString()===l.status)&&(!l.startDate||new Date(r.created_at)>=new Date(l.startDate))&&(!l.endDate||new Date(r.created_at)<=new Date(new Date(l.endDate).setDate(new Date(l.endDate).getDate()+1))));p(t)},[l,n]);const b=t=>{v(r=>({...r,[t.target.name]:t.target.value}))},w=async t=>{try{const r=await S.get(`/orders/${t.id}`);N(r.data.data)}catch(r){console.error("Failed to fetch order details",r),c("Không thể tải chi tiết đơn hàng.")}},C=async()=>{g(null),h&&await w(h),await f()},D=t=>{const d={1:{text:"Hoàn thành",className:"bg-green-500/10 text-green-500"},0:{text:"Đang xử lý",className:"bg-blue-500/10 text-blue-500"},2:{text:"Đã hủy",className:"bg-red-500/10 text-red-500"}}[t]||{text:"Không xác định",className:"bg-gray-500/20 text-gray-400"};return e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded-full ${d.className}`,children:d.text})},a=()=>x?e.jsx(O,{}):s?e.jsxs("div",{className:"alert alert-danger",children:[e.jsx(_,{className:"w-5 h-5 inline-block mr-2"}),s]}):u.length===0?e.jsxs("div",{className:"text-center p-10 bg-background rounded-lg border border-themed",children:[e.jsx(T,{className:"w-12 h-12 mx-auto text-secondary/50 mb-4"}),e.jsx("p",{className:"text-secondary",children:"Không có đơn hàng nào phù hợp."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:u.map(t=>e.jsxs("div",{className:"bg-background p-4 rounded-xl border border-themed transition-all duration-300 hover:border-accent hover:shadow-lg hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-mono text-sm text-secondary",children:["#",t.order_code]}),e.jsx("p",{className:"font-semibold text-primary",children:Q(t.created_at)})]}),D(t.status)]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-themed flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-secondary",children:"Tổng tiền"}),e.jsx("p",{className:"text-xl font-bold text-accent",children:k(t.total_amount)})]}),e.jsxs("button",{onClick:()=>w(t),className:"flex items-center gap-1.5 text-sm font-semibold text-accent hover:text-accent/80 transition-colors",children:[e.jsx(K,{className:"h-4 w-4"})," Xem chi tiết"]})]})]},t.id))});return e.jsxs("section",{className:"section-bg p-6 md:p-8 rounded-2xl shadow-lg space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-2xl md:text-3xl font-bold text-primary",children:"Lịch sử Đơn hàng"}),e.jsx("p",{className:"text-secondary mt-1",children:"Theo dõi và quản lý tất cả các đơn hàng đã mua của bạn."})]}),e.jsx("div",{className:"bg-background p-4 rounded-xl border border-themed",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Mã đơn hàng"}),e.jsx("input",{type:"text",name:"search",value:l.search,onChange:b,className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover placeholder-theme",placeholder:"VD: #12345"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Trạng thái"}),e.jsxs("select",{name:"status",value:l.status,onChange:b,className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"1",children:"Hoàn thành"}),e.jsx("option",{value:"0",children:"Đang xử lý"}),e.jsx("option",{value:"2",children:"Đã hủy"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Từ ngày"}),e.jsx("input",{type:"date",name:"startDate",value:l.startDate,onChange:b,className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Đến ngày"}),e.jsx("input",{type:"date",name:"endDate",value:l.endDate,onChange:b,className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover"})]})]})}),e.jsx("div",{className:"min-h-[20rem]",children:a()}),h&&e.jsx(Z,{order:h,onClose:()=>N(null),onStartDispute:t=>g(t)}),i&&e.jsx(R,{item:i,order:h,onClose:()=>g(null),onDisputeSuccess:C})]})}export{se as default};
