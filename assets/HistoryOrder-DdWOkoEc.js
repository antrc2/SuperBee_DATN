import{c as _,r as c,j as e,h as C,B as O,a5 as S,aM as T,E as L,X as M,ap as K,l as E,n as V,aF as A,a6 as P,az as $}from"./index-C-Tm1Ach.js";import{C as H}from"./chevron-up-DmLCsj1w.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]],B=_("paperclip",I);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],q=_("upload",G),U={incorrect_login:"Sai thông tin đăng nhập",account_banned:"Tài khoản bị khóa/hạn chế",wrong_description:"Sản phẩm không đúng mô tả",account_retrieved:"Tài khoản bị chủ cũ lấy lại",other:"Lý do khác"},X=({item:s,order:u,onClose:p,onDisputeSuccess:m})=>{var v;const[n,y]=c.useState("incorrect_login"),[h,f]=c.useState(""),[t,d]=c.useState([]),[i,x]=c.useState(null),[b,g]=c.useState(!1);if(!s)return null;const k=l=>{if(l.target.files.length>3){x("Chỉ được tải lên tối đa 3 ảnh.");return}const o=Array.from(l.target.files);d(o),x(null)},j=async l=>{var D,a;if(l.preventDefault(),!h.trim()){x("Vui lòng mô tả chi tiết sự cố.");return}g(!0),x(null);const o=new FormData;o.append("order_item_id",s.id),o.append("dispute_type",n),o.append("description",h),t.forEach(r=>{o.append("attachments[]",r)});try{await C.post("/disputes",o,{headers:{"Content-Type":"multipart/form-data"}}),m()}catch(r){const N=((a=(D=r.response)==null?void 0:D.data)==null?void 0:a.message)||"Đã có lỗi xảy ra khi gửi khiếu nại. Vui lòng thử lại.";x(N),console.error(r)}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex justify-center items-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dropdown border border-themed rounded-2xl shadow-2xl w-full max-w-lg max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-themed",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-red-500/10 rounded-lg",children:e.jsx(S,{className:"h-6 w-6 text-red-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Báo cáo sự cố"}),e.jsxs("p",{className:"text-secondary text-sm",children:["Sản phẩm: ",((v=s.product)==null?void 0:v.sku)||s.product_id]})]})]}),e.jsx("button",{onClick:p,className:"p-2 rounded-full text-secondary hover:text-primary hover:bg-accent/10 transition-colors",children:e.jsx(M,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 overflow-y-auto flex-1 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Loại sự cố"}),e.jsx("select",{value:n,onChange:l=>y(l.target.value),className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover",children:Object.entries(U).map(([l,o])=>e.jsx("option",{value:l,children:o},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Mô tả chi tiết"}),e.jsx("textarea",{value:h,onChange:l=>f(l.target.value),className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover min-h-[120px]",placeholder:"Vui lòng mô tả rõ ràng vấn đề bạn gặp phải với tài khoản...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Ảnh bằng chứng (Tối đa 3 ảnh)"}),e.jsx("div",{className:"mt-2 flex justify-center rounded-lg border border-dashed border-themed px-6 py-10 bg-input",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"mx-auto h-12 w-12 text-secondary/50"}),e.jsxs("div",{className:"mt-4 flex text-sm leading-6 text-secondary",children:[e.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-semibold text-accent focus-within:outline-none hover:text-accent/80",children:[e.jsx("span",{children:"Tải tệp lên"}),e.jsx("input",{id:"file-upload",name:"attachments",type:"file",className:"sr-only",multiple:!0,accept:"image/png, image/jpeg, image/jpg",onChange:k})]}),e.jsx("p",{className:"pl-1",children:"hoặc kéo và thả"})]}),e.jsx("p",{className:"text-xs leading-5 text-secondary/70",children:"PNG, JPG, JPEG tối đa 2MB mỗi tệp"})]})}),t.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-primary",children:"Tệp đã chọn:"}),e.jsx("ul",{className:"space-y-1",children:t.map((l,o)=>e.jsxs("li",{className:"flex items-center text-sm text-secondary gap-2",children:[" ",e.jsx(B,{className:"h-4 w-4"})," ",l.name," "]},o))})]})]}),i&&e.jsx("div",{className:"alert alert-danger",children:i})]}),e.jsxs("div",{className:"p-4 border-t border-themed bg-background/50 text-right flex-shrink-0 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:p,className:"action-button action-button-secondary !w-auto",disabled:b,children:"Hủy"}),e.jsx("button",{type:"submit",onClick:j,className:"action-button action-button-primary !w-auto bg-gradient-danger hover:brightness-110",disabled:b,children:b?e.jsx(E,{className:"h-5 w-5 animate-spin"}):"Gửi Khiếu nại"})]})]})})},z=s=>{if(!s)return"N/A";const u=new Date(s),p=String(u.getDate()).padStart(2,"0"),m=String(u.getMonth()+1).padStart(2,"0"),n=u.getFullYear();return`${p}/${m}/${n}`},w=s=>(s==null&&(s=0),new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s)),J=({order:s,onClose:u,onStartDispute:p})=>{if(!s)return null;const[m,n]=c.useState({}),y=t=>{n(d=>({...d,[t]:!d[t]}))},h=t=>{const i={0:{text:"Chờ xử lý",icon:e.jsx(P,{className:"h-4 w-4"}),className:"text-yellow-500 bg-yellow-500/10"},1:{text:"Đang xử lý",icon:e.jsx(E,{className:"h-4 w-4 animate-spin"}),className:"text-blue-500 bg-blue-500/10"},2:{text:"Đã giải quyết",icon:e.jsx(A,{className:"h-4 w-4"}),className:"text-green-500 bg-green-500/10"},3:{text:"Đã từ chối",icon:e.jsx(V,{className:"h-4 w-4"}),className:"text-red-500 bg-red-500/10"}}[t.status]||{text:"Không rõ",icon:e.jsx($,{className:"h-4 w-4"}),className:"bg-gray-500/20 text-gray-400"};return e.jsxs("span",{className:`inline-flex items-center gap-1.5 text-xs font-semibold px-2 py-1 rounded-full ${i.className}`,children:[i.icon,i.text]})},f=s.items.reduce((t,d)=>t+Number.parseFloat(d.unit_price),0);return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex justify-center items-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-dropdown border border-themed rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-themed flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-accent/10 rounded-lg",children:e.jsx(T,{className:"h-6 w-6 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-heading text-xl font-bold text-primary",children:"Chi tiết đơn hàng"}),e.jsxs("p",{className:"text-secondary text-sm font-mono",children:["#",s.order_code]})]})]}),e.jsx("button",{onClick:u,className:"p-2 rounded-full text-secondary hover:text-primary hover:bg-accent/10 transition-colors",children:e.jsx(M,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Danh sách sản phẩm"}),e.jsx("div",{className:"space-y-3",children:s.items.map(t=>{var d,i,x,b;return e.jsxs("div",{className:"p-4 bg-background/50 rounded-lg border border-themed",children:[e.jsxs("div",{className:"flex items-start md:items-center gap-4 flex-col md:flex-row",children:[e.jsx("img",{src:((i=(d=t.product)==null?void 0:d.images[0])==null?void 0:i.image_url)||"/placeholder.svg",alt:t.product_name||"Sản phẩm",className:"h-16 w-16 object-cover rounded-lg border border-themed"}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("p",{className:"font-semibold text-primary",children:["SKU: ",((x=t.product)==null?void 0:x.sku)||t.product_id]}),e.jsx("p",{className:"text-sm font-bold text-accent",children:w(t.unit_price)})]}),e.jsxs("div",{className:"flex flex-row md:flex-col items-start md:items-end gap-2 mt-2 md:mt-0",children:[e.jsxs("button",{onClick:()=>y(t.id),className:"action-button action-button-secondary !w-auto !py-2 !px-3 !text-sm",children:[m[t.id]?"Ẩn":"Xem",m[t.id]?e.jsx(H,{className:"h-4 w-4 ml-1"}):e.jsx(K,{className:"h-4 w-4 ml-1"})]}),t.dispute?h(t.dispute):e.jsxs("button",{onClick:()=>p(t),className:"flex items-center gap-1 text-xs font-semibold text-red-500 hover:text-red-400 transition-colors",children:[e.jsx(S,{className:"h-3.5 w-3.5"}),"Báo cáo sự cố"]})]})]}),m[t.id]&&e.jsx("div",{className:"mt-4 pt-4 border-t border-themed",children:(b=t.product)!=null&&b.credentials&&t.product.credentials.length>0?e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-primary mb-2",children:"Thông tin tài khoản"}),e.jsxs("div",{className:"bg-input p-3 rounded-lg space-y-2 border border-themed",children:[e.jsxs("p",{className:"text-sm text-secondary",children:[e.jsx("span",{className:"font-medium text-primary",children:"Tên đăng nhập:"})," ",t.product.credentials[0].username]}),e.jsxs("div",{className:"text-sm text-secondary",children:[e.jsx("span",{className:"font-medium text-primary",children:"Mật khẩu:"})," ",e.jsx("input",{type:"text",value:t.product.credentials[0].password,readOnly:!0,className:"bg-background text-primary border border-themed p-1 rounded w-auto selection:bg-accent selection:text-accent-contrast",onFocus:g=>g.target.select()})]}),e.jsx("i",{className:"text-xs text-secondary/70",children:"*Click vào ô mật khẩu để copy."})]})]}):e.jsx("p",{className:"text-sm text-secondary",children:"Không có thông tin chi tiết cho sản phẩm này."})})]},t.id)})})]}),e.jsxs("div",{className:"border-t border-themed pt-6",children:[e.jsx("h4",{className:"font-heading text-lg font-bold text-primary mb-4",children:"Tổng kết"}),e.jsxs("div",{className:"space-y-3 bg-background/50 p-4 rounded-lg border border-themed",children:[e.jsxs("div",{className:"flex justify-between text-secondary",children:[e.jsx("span",{children:"Tạm tính:"}),e.jsx("span",{className:"font-medium",children:w(f)})]}),e.jsxs("div",{className:"flex justify-between text-secondary",children:[e.jsxs("span",{children:["Giảm giá (Mã: ",s.promo_code||"N/A","):"]}),e.jsxs("span",{className:"font-medium text-red-400",children:["- ",w(s.discount_amount)]})]}),e.jsxs("div",{className:"flex justify-between text-xl border-t border-themed pt-3 mt-3",children:[e.jsx("span",{className:"text-primary font-bold",children:"Thành tiền:"}),e.jsx("span",{className:"font-bold text-accent",children:w(s.total_amount)})]})]})]})]}),e.jsx("div",{className:"p-4 border-t border-themed bg-background/50 text-right flex-shrink-0",children:e.jsx("button",{onClick:u,className:"action-button action-button-secondary !w-auto",children:"Đóng"})})]})})};function Q(){const[s,u]=c.useState([]),[p,m]=c.useState([]),[n,y]=c.useState({search:"",status:"all",startDate:"",endDate:""}),[h,f]=c.useState(null),[t,d]=c.useState(!0),[i,x]=c.useState(null),[b,g]=c.useState(null),k=async()=>{d(!0),x(null);try{const r=(await C.get("/orders")).data.data.sort((N,F)=>new Date(F.created_at)-new Date(N.created_at));u(r),m(r)}catch(a){x("Không thể tải lịch sử đơn hàng. Vui lòng thử lại sau."),console.error(a)}finally{d(!1)}};c.useEffect(()=>{k()},[]),c.useEffect(()=>{let a=s.filter(r=>r.order_code.toLowerCase().includes(n.search.toLowerCase())&&(n.status==="all"||r.status.toString()===n.status)&&(!n.startDate||new Date(r.created_at)>=new Date(n.startDate))&&(!n.endDate||new Date(r.created_at)<=new Date(new Date(n.endDate).setDate(new Date(n.endDate).getDate()+1))));m(a)},[n,s]);const j=a=>{y(r=>({...r,[a.target.name]:a.target.value}))},v=async a=>{try{const r=await C.get(`/orders/${a.id}`);f(r.data.data)}catch(r){console.error("Failed to fetch order details",r),x("Không thể tải chi tiết đơn hàng.")}},l=async()=>{g(null),h&&await v(h),await k()},o=a=>{const N={1:{text:"Hoàn thành",className:"bg-green-500/10 text-green-500"},0:{text:"Đang xử lý",className:"bg-blue-500/10 text-blue-500"},2:{text:"Đã hủy",className:"bg-red-500/10 text-red-500"}}[a]||{text:"Không xác định",className:"bg-gray-500/20 text-gray-400"};return e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded-full ${N.className}`,children:N.text})},D=()=>t?e.jsx(O,{}):i?e.jsxs("div",{className:"alert alert-danger",children:[e.jsx(S,{className:"w-5 h-5 inline-block mr-2"}),i]}):p.length===0?e.jsxs("div",{className:"text-center p-10 bg-background rounded-lg border border-themed",children:[e.jsx(T,{className:"w-12 h-12 mx-auto text-secondary/50 mb-4"}),e.jsx("p",{className:"text-secondary",children:"Không có đơn hàng nào phù hợp."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:p.map(a=>e.jsxs("div",{className:"bg-background p-4 rounded-xl border border-themed transition-all duration-300 hover:border-accent hover:shadow-lg hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-mono text-sm text-secondary",children:["#",a.order_code]}),e.jsx("p",{className:"font-semibold text-primary",children:z(a.created_at)})]}),o(a.status)]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-themed flex justify-between items-end",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-secondary",children:"Tổng tiền"}),e.jsx("p",{className:"text-xl font-bold text-accent",children:w(a.total_amount)})]}),e.jsxs("button",{onClick:()=>v(a),className:"flex items-center gap-1.5 text-sm font-semibold text-accent hover:text-accent/80 transition-colors",children:[e.jsx(L,{className:"h-4 w-4"}),"Xem chi tiết"]})]})]},a.id))});return e.jsxs("section",{className:"section-bg p-6 md:p-8 rounded-2xl shadow-lg space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-2xl md:text-3xl font-bold text-primary",children:"Lịch sử Đơn hàng"}),e.jsx("p",{className:"text-secondary mt-1",children:"Theo dõi và quản lý tất cả các đơn hàng đã mua của bạn."})]}),e.jsx("div",{className:"bg-background p-4 rounded-xl border border-themed",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Mã đơn hàng"}),e.jsx("input",{type:"text",name:"search",value:n.search,onChange:j,className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover placeholder-theme",placeholder:"VD: #12345"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Trạng thái"}),e.jsxs("select",{name:"status",value:n.status,onChange:j,className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"1",children:"Hoàn thành"}),e.jsx("option",{value:"0",children:"Đang xử lý"}),e.jsx("option",{value:"2",children:"Đã hủy"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Từ ngày"}),e.jsx("input",{type:"date",name:"startDate",value:n.startDate,onChange:j,className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:"Đến ngày"}),e.jsx("input",{type:"date",name:"endDate",value:n.endDate,onChange:j,className:"w-full rounded-lg px-3 py-2 bg-input text-input border-themed border-hover"})]})]})}),e.jsx("div",{className:"min-h-[20rem]",children:D()}),h&&e.jsx(J,{order:h,onClose:()=>f(null),onStartDispute:a=>g(a)}),b&&e.jsx(X,{item:b,order:h,onClose:()=>g(null),onDisputeSuccess:l})]})}export{Q as default};
