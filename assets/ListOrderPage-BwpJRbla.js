import{r as n,d as P,m as E,h as F,j as e,n as L,R,ap as T,L as v,E as O,a3 as z,o as U}from"./index-CBuA2RNo.js";import{u as $}from"./index-BkzvNM70.js";import{D as _}from"./react-datepicker-Ozdj8vWy.js";import{C as G}from"./chevron-up-CzPdMc5w.js";const V=d=>new Date(d).toLocaleString("vi-VN"),D=d=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(d),X=({status:d})=>{const r={1:{text:"Hoàn thành",classes:"bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300"},0:{text:"Đang xử lý",classes:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/40 dark:text-yellow-300"},2:{text:"Đã hủy",classes:"bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-300"}}[d]||{text:"Không rõ",classes:"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold ${r.classes}`,children:r.text})},H=({order:d})=>{var i;return e.jsx("tr",{className:"bg-slate-50 dark:bg-slate-800/50",children:e.jsxs("td",{colSpan:"7",className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-slate-800 dark:text-slate-200 mb-3",children:"Chi tiết sản phẩm:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(i=d.items)==null?void 0:i.map(r=>{var m,x;return console.log("🚀 ~ item:",r),e.jsxs("div",{className:"flex items-start gap-4 p-4 rounded-lg bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600",children:[e.jsx("img",{src:((x=(m=r.product.images)==null?void 0:m[0])==null?void 0:x.image_url)||"/placeholder.png",alt:"Ảnh sản phẩm",className:"w-20 h-20 object-cover rounded-md border dark:border-slate-600"}),e.jsxs("div",{className:"text-xs",children:[e.jsxs("p",{className:"font-bold text-slate-700 dark:text-slate-200",children:["Mã SP: ",r.product.sku]}),e.jsxs("p",{className:"text-slate-500 dark:text-slate-400",children:["Giá: ",D(r.unit_price)]}),e.jsx(v,{to:`/admin/products/${r.product.id}`,className:"mt-4 ml-1 block",children:"Xem chi tiết"})]})]},r.id)})})]})})};function I(){const[d,i]=n.useState([]),[r,m]=n.useState(null),[x,b]=n.useState(!0),[f,C]=n.useState([]),h=P(),o=E(),c=n.useMemo(()=>new URLSearchParams(o.search),[o.search]),[a,u]=n.useState({search:c.get("search")||"",status:c.get("status")||"",start_date:c.get("start_date")||"",end_date:c.get("end_date")||"",min_amount:c.get("min_amount")||"",max_amount:c.get("max_amount")||""});parseInt(c.get("page")||"1",10);const j=$(a,500),y=n.useCallback(async()=>{b(!0);try{const t=await F.get(`/admin/orders${o.search}`);i(t.data.data.data),m(t.data.data)}catch(t){console.error("Failed to fetch orders:",t)}finally{b(!1)}},[o.search]);n.useEffect(()=>{y()},[y]);const N=n.useCallback(t=>{const s=new URLSearchParams(o.search);Object.keys(t).forEach(l=>{t[l]?s.set(l,t[l]):s.delete(l)}),new URLSearchParams(o.search).get("page")&&s.set("page","1"),h({search:s.toString()})},[o.search,h]);n.useEffect(()=>{N(j)},[j,N]);const g=t=>{const{name:s,value:l}=t.target;(s==="min_amount"||s==="max_amount")&&parseFloat(l)<0||u(p=>({...p,[s]:l}))},k=(t,s)=>{const l=t?new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().split("T")[0]:"";u(p=>({...p,[s]:l}))},w=n.useMemo(()=>Object.values(a).filter(t=>t!=="").length,[a]),S=()=>{u({search:"",status:"",start_date:"",end_date:"",min_amount:"",max_amount:""})},M=t=>C(s=>s.includes(t)?s.filter(l=>l!==t):[...s,t]);return e.jsxs("div",{className:"p-4 sm:p-6 bg-slate-50 dark:bg-slate-900 min-h-screen font-sans",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-800 dark:text-slate-100",children:"Quản lý Đơn hàng"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Danh sách các đơn hàng sản phẩm"})]}),e.jsx("div",{className:"my-6 p-4 bg-white dark:bg-slate-800 rounded-lg shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("input",{type:"text",name:"search",placeholder:"Mã đơn, username...",value:a.search,onChange:g,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 lg:col-span-2"}),e.jsx(_,{selectsStart:!0,selected:a.start_date?new Date(a.start_date):null,onChange:t=>k(t,"start_date"),startDate:a.start_date?new Date(a.start_date):null,endDate:a.end_date?new Date(a.end_date):null,maxDate:a.end_date?new Date(a.end_date):null,placeholderText:"Từ ngày",dateFormat:"dd/MM/yyyy",isClearable:!0,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx(_,{selectsEnd:!0,selected:a.end_date?new Date(a.end_date):null,onChange:t=>k(t,"end_date"),startDate:a.start_date?new Date(a.start_date):null,endDate:a.end_date?new Date(a.end_date):null,minDate:a.start_date?new Date(a.start_date):null,placeholderText:"Đến ngày",dateFormat:"dd/MM/yyyy",isClearable:!0,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("input",{type:"number",name:"min_amount",placeholder:"Giá từ...",value:a.min_amount,onChange:g,min:"0",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),e.jsx("input",{type:"number",name:"max_amount",placeholder:"Giá đến...",value:a.max_amount,onChange:g,min:"0",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"}),e.jsxs("select",{name:"status",value:a.status,onChange:g,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"",children:"Tất cả trạng thái"}),e.jsx("option",{value:"1",children:"Hoàn thành"}),e.jsx("option",{value:"0",children:"Đang xử lý"}),e.jsx("option",{value:"2",children:"Đã hủy"})]}),e.jsxs("button",{onClick:S,className:"relative flex items-center justify-center gap-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 px-4 py-2 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",children:[e.jsx(L,{size:16}),"Xóa bộ lọc",w>0&&e.jsx("span",{className:"absolute -top-2 -right-2 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-xs font-bold text-white",children:w})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-slate-500 dark:text-slate-400",children:[e.jsx("thead",{className:"text-xs text-slate-700 dark:text-slate-300 uppercase bg-slate-50 dark:bg-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 px-2 py-3"}),e.jsx("th",{className:"px-6 py-3",children:"Mã đơn hàng"}),e.jsx("th",{className:"px-6 py-3",children:"Người mua"}),e.jsx("th",{className:"px-6 py-3",children:"Ngày đặt"}),e.jsx("th",{className:"px-6 py-3",children:"Tổng tiền"}),e.jsx("th",{className:"px-6 py-3",children:"Trạng thái"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Chi tiết"})]})}),e.jsx("tbody",{children:x?Array.from({length:5}).map((t,s)=>e.jsx("tr",{className:"animate-pulse",children:e.jsx("td",{colSpan:"7",className:"p-4",children:e.jsx("div",{className:"h-6 bg-slate-200 dark:bg-slate-700 rounded w-full"})})},s)):d.length>0?d.map(t=>e.jsxs(R.Fragment,{children:[e.jsxs("tr",{className:"border-b dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[e.jsx("td",{className:"px-2 text-center",children:e.jsx("button",{onClick:()=>M(t.id),className:"p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700",children:f.includes(t.id)?e.jsx(G,{size:16}):e.jsx(T,{size:16})})}),e.jsxs("td",{className:"px-6 py-4 font-mono font-semibold text-indigo-600 dark:text-indigo-400",children:["#",t.order_code]}),e.jsx("td",{className:"px-6 py-4 font-medium text-slate-800 dark:text-slate-100",children:t.user.username}),e.jsx("td",{className:"px-6 py-4",children:V(t.created_at)}),e.jsx("td",{className:"px-6 py-4",children:D(t.total_amount)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(X,{status:t.status})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(v,{to:`/admin/orders/${t.id}`,className:"p-2 inline-block rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-500 hover:text-blue-600",children:e.jsx(O,{size:18})})})]}),f.includes(t.id)&&e.jsx(H,{order:t})]},t.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"text-center py-16",children:[e.jsx(z,{size:48,className:"mx-auto mb-2 text-slate-400"}),"Không tìm thấy đơn hàng nào."]})})})]})}),!x&&r&&e.jsx(U,{meta:r,onPageChange:t=>h({search:`?page=${t}`})})]})}export{I as default};
