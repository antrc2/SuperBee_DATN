import{e as B,r as h,n as H,j as t,X as K,y as A,ar as M,as as O,o as q,at as z}from"./index-BDAcJp4Y.js";import{P as Q}from"./Product-DsRugYZ5.js";import{B as W}from"./Breadcrumbs-MjFt3emo.js";import{N}from"./NoProduct-CcddV_8_.js";import{C as X}from"./CategoryCha-DTGGRMJI.js";import{F as G}from"./funnel-1AEyEKEx.js";import"./recharge-7Wy_Gsf5.js";const J=async o=>(await B.get(`/products/${o}`)).data,V=async(o,a)=>{const i=new URLSearchParams;return a.key&&i.append("key",a.key),a.sku&&i.append("sku",a.sku),a.categoryId&&i.append("categoryId",a.categoryId),a.min_price&&i.append("min_price",a.min_price),a.max_price&&i.append("max_price",a.max_price),a.attribute_key&&i.append("attribute_key",a.attribute_key),a.attribute_value&&i.append("attribute_value",a.attribute_value),a.sortBy&&a.sortBy!=="newest"&&i.append("sortBy",a.sortBy),a.page&&a.page!==1&&i.append("page",a.page),a.limit&&i.append("limit",a.limit),(await B.get(`/products/filter/${o}?${i}`)).data};function Y({slug:o,initialFilters:a,onApplyFilters:i}){const[d,u]=h.useState(a),{homeData:r,setHomeData:f}=H(),[C,b]=h.useState([]),[j,l]=h.useState("");h.useEffect(()=>{if(a.min_price&&a.max_price){const c=Number(a.min_price),n=Number(a.max_price);l(c===0&&n===5e5?"under500k":c===5e5&&n===1e6?"500k-1m":c===1e6&&n===5e6?"1m-5m":c===5e6&&n===1e7?"5m+":c===1e7&&n===5e7?"10m+":c===5e7&&n===99999999?"50m+":"")}else l("")},[a]);const _=c=>{const n=c.target.value;l(n);let m="",p="";n==="under500k"?(m=0,p=5e5):n==="500k-1m"?(m=5e5,p=1e6):n==="1m-5m"?(m=1e6,p=5e6):n==="5m+"?(m=5e6,p=1e7):n==="10m+"?(m=1e7,p=5e7):n==="50m+"&&(m=5e7,p=99999999),u(y=>({...y,min_price:m,max_price:p}))};h.useEffect(()=>{u(a),(async()=>{try{const n=await B.get(`/products/filter/${o}`,{params:{limit:1,page:1}});n.data.success&&b(n.data.data.category.children||[])}catch(n){console.error("Error fetching categories:",n)}})()},[a,o]);const g=c=>{const{name:n,value:m}=c.target;u(p=>({...p,[n]:m}))},k=()=>{const c={...d,page:1,limit:12};i(c)},v=()=>{const c={key:"",sku:"",categoryId:"",min_price:"",max_price:"",attribute_key:"",attribute_value:"",sortBy:"newest",page:1,limit:12};u(c),i(c)};return t.jsx("aside",{className:"w-full lg:w-1/4 space-y-6",children:t.jsxs("div",{className:"bg-content p-6 rounded-xl border-themed space-y-4",children:[t.jsxs("h3",{className:"font-heading text-xl font-semibold text-primary flex items-center gap-2",children:[t.jsx(G,{className:"text-highlight"}),"Bộ Lọc Sản Phẩm"]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-primary mb-1",children:"Mã sản phẩm (SKU)"}),t.jsx("input",{type:"text",name:"sku",value:d.sku||"",onChange:g,placeholder:"Nhập mã SKU",className:"block w-full px-4 py-2 text-sm rounded-lg border-hover bg-input text-input"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-primary mb-1",children:"Khoảng giá"}),t.jsxs("select",{id:"priceRange",name:"priceRange",value:j,onChange:_,className:"block w-full px-4 py-2 text-sm rounded-lg border-hover bg-input text-input",children:[t.jsx("option",{value:"",children:"Tất cả giá"}),t.jsx("option",{value:"under500k",children:"Dưới 500.000đ"}),t.jsx("option",{value:"500k-1m",children:"500.000đ - 1.000.000đ"}),t.jsx("option",{value:"1m-5m",children:"1.000.000đ - 5.000.000đ"}),t.jsx("option",{value:"5m+",children:"5.000.000đ - 10.000.000đ"}),t.jsx("option",{value:"10m+",children:"10.000.000đ - 50.000.000đ"}),t.jsx("option",{value:"50m+",children:"Trên 50.000.000đ"})]})]}),t.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[t.jsx("button",{onClick:k,className:"action-button action-button-primary flex-1",children:"Áp dụng"}),t.jsx("button",{onClick:v,className:"action-button action-button-secondary p-3",children:t.jsx(K,{size:16})})]})]})})}function se(){var c,n,m,p,y,S,I,R,E,P,$,w,D,U,T;const{slug:o}=A(),[a,i]=M(),d={key:a.get("key")||"",sku:a.get("sku")||"",categoryId:a.get("categoryId")||"",min_price:a.get("min_price")||"",max_price:a.get("max_price")||"",attribute_key:a.get("attribute_key")||"",attribute_value:a.get("attribute_value")||"",sortBy:a.get("sortBy")||"newest",page:parseInt(a.get("page")||"1",10),limit:parseInt(a.get("limit")||"12",10)},u=Object.entries(d).some(([e,s])=>e==="page"||e==="limit"||e==="sortBy"&&s==="newest"?!1:s!==""&&s!=null),{data:r,isLoading:f,isError:C,error:b}=O({queryKey:["listProducts",o,d],queryFn:async()=>{if(u){const e=Object.fromEntries(Object.entries(d).filter(([s,x])=>s==="sortBy"&&x==="newest"?!1:x!=null&&x!==""));return await V(o,e)}else return await J(o)},enabled:!!o,keepPreviousData:!0}),j=e=>{const s=new URLSearchParams;e.key&&s.append("key",e.key),e.sku&&s.append("sku",e.sku),e.categoryId&&s.append("categoryId",e.categoryId),e.min_price&&s.append("min_price",e.min_price),e.max_price&&s.append("max_price",e.max_price),e.attribute_key&&s.append("attribute_key",e.attribute_key),e.attribute_value&&s.append("attribute_value",e.attribute_value),e.sortBy&&e.sortBy!=="newest"&&s.append("sortBy",e.sortBy),e.page&&e.page!==1&&s.append("page",e.page),e.limit&&e.limit!==12&&s.append("limit",e.limit),i(s,{replace:!0})},l=e=>{if(e&&e!==d.page){const s=new URLSearchParams(a);s.set("page",e),i(s,{replace:!0}),window.scrollTo({top:0,behavior:"smooth"})}};if(f)return t.jsx(q,{});if(C)return t.jsx(z,{statusCode:((c=b.response)==null?void 0:c.status)||500});if(!(r!=null&&r.data))return t.jsx(N,{});const _=[{label:"Trang chủ",href:"/"},{label:"Mua Acc",href:"/mua-acc"},{label:o}],g=((n=r==null?void 0:r.data)==null?void 0:n.type)===1,k=g&&((p=(m=r==null?void 0:r.data)==null?void 0:m.products)==null?void 0:p.length)>0,v=!g&&((S=(y=r==null?void 0:r.data)==null?void 0:y.categories)==null?void 0:S.length)>0;return t.jsxs("div",{className:"max-w-screen-xl mx-auto min-h-screen",children:[t.jsx("div",{className:"mt-5",children:t.jsx(W,{items:_})}),g?t.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 mt-6",children:[t.jsx(Y,{slug:o,initialFilters:d,onApplyFilters:j}),t.jsxs("main",{className:"w-full lg:w-3/4 px-4",children:[t.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4 bg-content p-3 rounded-xl border-themed",children:t.jsxs("div",{className:"text-sm text-secondary mb-2 sm:mb-0",children:[t.jsx("span",{children:"Hiển thị "}),t.jsx("strong",{className:"text-primary",children:(I=r==null?void 0:r.data)!=null&&I.pagination?`${r.data.products.length} / ${r.data.pagination.total}`:((E=(R=r==null?void 0:r.data)==null?void 0:R.products)==null?void 0:E.length)||0}),t.jsx("span",{children:" sản phẩm"})]})}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4",children:($=(P=r==null?void 0:r.data)==null?void 0:P.products)==null?void 0:$.map((e,s)=>t.jsx(Q,{product:e},e.id||s))}),((w=r==null?void 0:r.data)==null?void 0:w.pagination)&&r.data.pagination.last_page>1&&t.jsx("div",{className:"flex justify-center items-center gap-2 mt-8",children:(D=r.data.pagination.links)==null?void 0:D.map((e,s)=>{const x=e.url?new URL(e.url).searchParams.get("page"):null;return t.jsx("button",{onClick:()=>l(x),disabled:!e.url||f,dangerouslySetInnerHTML:{__html:e.label},className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${e.active?"bg-primary text-white shadow-md":"bg-card hover:bg-gray-200 dark:hover:bg-gray-700"} ${e.url?"":"text-gray-400 cursor-not-allowed opacity-50"}`},s)})}),!k&&t.jsx(N,{})]})]}):t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 px-4 mt-6",children:[(T=(U=r==null?void 0:r.data)==null?void 0:U.categories)==null?void 0:T.map((e,s)=>t.jsx(X,{item:e},s)),!v&&t.jsx(N,{})]})]})}export{se as default};
