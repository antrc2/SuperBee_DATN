import{r as a,a as S,j as e,N as I,e as L,L as f,E as _}from"./index-OefKdV4-.js";import{u as D}from"./index.esm-C6rTP9RF.js";import{C as O}from"./chevron-left-DzZmHbAx.js";import{E as P}from"./eye-off-v4p3ouL9.js";function K(){const[j,y]=a.useState(0),[i,N]=a.useState(!1),[d,o]=a.useState(""),[m,g]=a.useState(!1),u=a.useRef(null),v="0x4AAAAAABmbwPkYMazVEtre",r=a.useRef(null),{login:C,loading:h,user:k}=S(),A=localStorage.getItem("web_id")||1,{register:c,handleSubmit:E,formState:{errors:n},setError:l,clearErrors:p}=D();a.useEffect(()=>{if(window.turnstile){g(!0);return}const s=document.createElement("script");return s.src=`https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback&rnd=${Date.now()}`,s.async=!0,s.defer=!0,document.body.appendChild(s),window.onloadTurnstileCallback=()=>{g(!0)},()=>{window.turnstile&&r.current&&window.turnstile.remove(r.current),delete window.onloadTurnstileCallback,document.body.removeChild(s)}},[]),a.useEffect(()=>{m&&window.turnstile&&u.current&&(r.current&&window.turnstile.remove(r.current),r.current=window.turnstile.render(u.current,{sitekey:v,callback:s=>{o(s)},"expired-callback":()=>{o("")},"error-callback":()=>{o("")}}))},[m,j]);const b=()=>{window.turnstile&&r.current!==null&&(window.turnstile.remove(r.current),r.current=null),o(""),y(s=>s+1)};if(k)return e.jsx(I,{to:"/",replace:!0});const T=async s=>{var w;if(p(),!d){l("captcha",{type:"manual",message:"Vui lòng xác thực CAPTCHA"});return}const t=await C({...s,"cf-turnstile-response":d,web_id:A});b(),t.success||(t.validationErrors&&Object.entries(t.validationErrors).forEach(([R,x])=>{l(R,{type:"server",message:Array.isArray(x)?x[0]:x})}),(t.code==="CAPTCHA_FAILED"||t.code==="CAPTCHA_ERROR")&&l("captcha",{type:"server",message:t.message||"Xác thực CAPTCHA thất bại"}),t.code==="VALIDATION_ERROR"&&((w=t.validationErrors)!=null&&w["cf-turnstile-response"])&&b(),t.code==="INVALID_CREDENTIALS"&&(l("username",{type:"server",message:t.message||"Tên đăng nhập hoặc mật khẩu không đúng"}),l("password",{type:"server",message:t.message||"Tên đăng nhập hoặc mật khẩu không đúng"})),(t.code==="NO_ACTIVE"||t.code==="LOCKED_ACCOUNT"||t.code==="INVALID_STATUS")&&l("username",{type:"server",message:t.message}))};return h?e.jsx(L,{}):e.jsxs("div",{className:"flex flex-col flex-1 w-full overflow-y-auto lg:w-1/2 no-scrollbar",children:[e.jsx("div",{className:"w-full max-w-md mx-auto mb-5 sm:pt-10",children:e.jsxs(f,{to:"/",className:"inline-flex items-center text-sm text-secondary hover:text-primary transition-colors",children:[e.jsx(O,{className:"size-5"}),"Quay lại trang chủ"]})}),e.jsx("div",{className:"flex flex-col justify-center flex-1 w-full max-w-md mx-auto px-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-5 sm:mb-8",children:[e.jsx("h1",{className:"font-heading mb-2 font-semibold text-primary text-title-sm sm:text-title-md",children:"Đăng Nhập"}),e.jsx("p",{className:"text-sm text-secondary",children:"Chào mừng bạn trở lại! Vui lòng nhập thông tin."})]}),e.jsx("form",{onSubmit:E(T),children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"username",className:"block text-sm font-medium text-primary mb-1",children:["Tên đăng nhập",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"username",placeholder:"Nhập tên đăng nhập của bạn",className:"block w-full px-4 py-[12px] text-sm rounded-lg border-hover placeholder-theme bg-input text-input",...c("username",{required:"Tên đăng nhập là bắt buộc"}),onChange:s=>{p("username"),c("username").onChange(s)}}),n.username&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:n.username.message})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"password",className:"block text-sm font-medium text-primary mb-1",children:["Mật khẩu",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:i?"text":"password",id:"password",placeholder:"Nhập mật khẩu của bạn",className:"block w-full px-4 py-[12px] text-sm rounded-lg border-hover placeholder-theme pr-10 bg-input text-input",...c("password",{required:"Mật khẩu là bắt buộc"}),onChange:s=>{p("password"),c("password").onChange(s)}}),e.jsx("span",{onClick:()=>N(!i),className:"absolute z-10 -translate-y-1/2 cursor-pointer right-4 top-1/2 text-secondary",children:i?e.jsx(_,{className:"size-5"}):e.jsx(P,{className:"size-5"})})]}),n.password&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:n.password.message})]}),e.jsxs("div",{children:[e.jsx("div",{ref:u,id:"captcha",className:"mb-2"}),n.captcha&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:n.captcha.message})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"font-heading flex items-center justify-center w-full px-4 py-3 text-sm font-bold rounded-lg transition-all text-accent-contrast bg-gradient-button hover:brightness-110 disabled:opacity-50 disabled:cursor-not-allowed",disabled:h||m&&!d,children:h?"Đang đăng nhập...":"Đăng Nhập"})})]})}),e.jsxs("div",{className:"mt-5 flex items-center justify-between flex-wrap gap-y-2",children:[e.jsxs("p",{className:"text-sm font-normal text-secondary",children:["Chưa có tài khoản?"," ",e.jsx(f,{to:"/auth/register",className:"font-heading font-semibold transition-colors text-highlight hover:brightness-125",children:"Đăng ký"})]}),e.jsx("p",{className:"text-sm font-normal",children:e.jsx(f,{to:"/forgot-password",className:"font-heading font-semibold transition-colors text-secondary hover:text-highlight",children:"Quên mật khẩu?"})})]})]})})]})}export{K as default};
