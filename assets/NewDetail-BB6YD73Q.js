import{k as G,r as n,h as b,j as e,q as L,aG as B,aL as F,a6 as M,L as P}from"./index-D48GFfOH.js";import{k as U}from"./marked.esm-CumxtpOb.js";const Y="https://via.placeholder.com/40",E=(a,i=null)=>Array.isArray(a)?a.filter(t=>t.parent_id===i).map(t=>({...t,replies:E(a,t.id)})):[],V=({comment:a,onReply:i})=>{var h,m,p;const[t,f]=n.useState(!1),[c,d]=n.useState(""),u=l=>{l.preventDefault(),c.trim()&&(i(a.id,c),d(""),f(!1))};return e.jsxs("div",{className:`comment-item flex gap-4 ${a.parent_id?"ml-6 md:ml-10":""}`,children:[e.jsx("img",{src:((h=a.user)==null?void 0:h.avatar_url)||Y,alt:((m=a.user)==null?void 0:m.username)||"Anonymous",className:"w-10 h-10 rounded-full object-cover mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-input rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-bold text-primary",children:((p=a.user)==null?void 0:p.username)||"Anonymous"}),e.jsx("span",{className:"text-xs text-secondary",children:new Date(a.created_at).toLocaleString("vi-VN")})]}),e.jsx("p",{className:"text-secondary text-[15px]",children:a.content})]}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-secondary mt-2",children:e.jsx("button",{onClick:()=>f(!t),className:"font-semibold text-accent hover:brightness-125 transition",children:t?"Hủy":"Phản hồi"})}),t&&e.jsxs("form",{onSubmit:u,className:"mt-3 flex flex-col gap-3",children:[e.jsx("textarea",{value:c,onChange:l=>d(l.target.value),placeholder:"Viết phản hồi của bạn...",rows:"2",required:!0,className:"w-full p-2 text-sm bg-background text-input border-themed rounded-md focus:border-hover focus:ring-1 focus:ring-accent/50 outline-none transition"}),e.jsx("button",{type:"submit",className:"action-button action-button-primary !w-auto self-end !py-1.5 !px-4 !text-sm",children:"Gửi"})]}),a.replies&&a.replies.length>0&&e.jsx("div",{className:"comment-replies mt-4 space-y-4",children:a.replies.map(l=>e.jsx(V,{comment:l,onReply:i},l.id))})]})]})};function J(){var A;const{category:a,slug:i}=G(),[t,f]=n.useState(null),[c,d]=n.useState([]),[u,h]=n.useState([]),[m,p]=n.useState(""),[l,w]=n.useState(!0),[v,C]=n.useState(!1),[S,_]=n.useState(null),[y,k]=n.useState(null),[q,R]=n.useState(""),T=s=>{if(!s)return"";const r=/<img\s[^>]*src="([^"]+\.(?:mp4|webm|ogg))"[^>]*alt="([^"]*)"[^>]*>/gi;return s.replace(r,'<video controls preload="metadata" class="w-full rounded-lg my-4" alt="$2"><source src="$1" type="video/mp4">Your browser does not support the video tag.</video>')};n.useEffect(()=>{(async()=>{var r,x;try{w(!0),_(null);const o=(r=(await b.get(`/post/${i}`)).data)==null?void 0:r.data;if(!o)throw new Error("Dữ liệu bài viết không tồn tại");if(f(o),o.content){const $=U.parse(o.content),N=T($);R(N)}else R("");if(o.category_id){const N=(x=(await b.get(`/post/bycategory/${o.category_id}`)).data)==null?void 0:x.data;Array.isArray(N)?d(N.filter(K=>K.id!==o.id)):d([])}else d([])}catch(g){_(`Không thể tải chi tiết bài viết: ${g.message}`)}finally{w(!1)}})(),window.scrollTo({top:0,behavior:"smooth"})},[i]);const j=n.useCallback(async s=>{var r;if(s)try{C(!0),k(null);const g=(r=(await b.get(`/comment/post/${s}`)).data)==null?void 0:r.data;Array.isArray(g)?h(E(g)):h([])}catch(x){k(`Không thể tải bình luận: ${x.message}`)}finally{C(!1)}},[]);n.useEffect(()=>{t!=null&&t.id&&j(t.id)},[t==null?void 0:t.id,j]);const D=async(s=null,r)=>{if(t!=null&&t.id)try{await b.post("/comment",{post_id:t.id,content:r,parent_id:s}),j(t.id),p("")}catch{alert("Không thể thêm bình luận. Vui lòng thử lại.")}},H=s=>{s.preventDefault(),m.trim()&&D(null,m)};return l?e.jsx("p",{className:"text-center text-secondary py-8",children:"Đang tải bài viết..."}):S?e.jsx("p",{className:"alert alert-danger mx-auto max-w-7xl",children:S}):t?e.jsx("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("div",{className:"flex-1 bg-input p-6 sm:p-8 rounded-xl shadow-themed min-w-0",children:[e.jsx("h1",{className:"font-heading text-3xl md:text-4xl font-black text-primary mb-2",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 text-sm text-secondary",children:[e.jsxs("span",{children:["By ",((A=t.author)==null?void 0:A.username)||"Unknown Author"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(L,{className:"h-4 w-4 mr-1.5"}),new Date(t.created_at).toLocaleDateString("vi-VN")]})]}),t.image_thumbnail_url&&e.jsx("img",{src:t.image_thumbnail_url,alt:t.title,className:"w-full h-auto max-h-[500px] object-cover rounded-lg mb-6"}),e.jsx("div",{className:"prose prose-lg max-w-none text-primary prose-headings:font-heading prose-headings:text-primary prose-a:text-accent hover:prose-a:text-highlight prose-strong:text-primary",dangerouslySetInnerHTML:{__html:q}}),e.jsxs("div",{className:"mt-10 pt-8 border-t border-themed",children:[e.jsxs("h2",{className:"font-heading text-2xl font-bold text-primary mb-6 flex items-center gap-3",children:[e.jsx(B,{className:"text-accent"})," Bình luận (",u.flat().length,")"]}),e.jsxs("form",{onSubmit:H,className:"flex flex-col gap-4 mb-8",children:[e.jsx("textarea",{value:m,onChange:s=>p(s.target.value),placeholder:"Viết bình luận của bạn...",rows:"4",required:!0,className:"w-full p-3 bg-background text-input border-themed rounded-lg focus:border-hover focus:ring-2 focus:ring-accent/50 outline-none transition placeholder-theme"}),e.jsxs("button",{type:"submit",className:"action-button action-button-primary !w-auto self-end",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Gửi bình luận"]})]}),e.jsxs("div",{className:"comment-list space-y-6",children:[v&&e.jsx("p",{className:"text-center text-secondary",children:"Đang tải bình luận..."}),y&&e.jsx("p",{className:"alert alert-danger",children:y}),!v&&!y&&(u.length>0?u.map(s=>e.jsx(V,{comment:s,onReply:D},s.id)):e.jsx("p",{className:"text-secondary text-center py-4",children:"Chưa có bình luận nào. Hãy là người đầu tiên!"}))]})]})]}),c.length>0&&e.jsx("aside",{className:"lg:w-80 lg:flex-shrink-0",children:e.jsxs("div",{className:"bg-input rounded-xl p-6 sticky top-8 shadow-themed",children:[e.jsxs("h3",{className:"font-heading text-lg font-bold text-primary mb-4 flex items-center",children:[e.jsx(M,{className:"h-5 w-5 mr-2 text-accent"}),"Tin tức liên quan"]}),e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsxs(P,{to:`/tin-tuc/${a}/${s.slug}`,className:"flex space-x-4 group p-2 rounded-lg transition-colors hover:bg-tertiary",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:s.image_thumbnail_url||"/placeholder.svg",alt:s.title,className:"w-16 h-16 object-cover rounded-md"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-bold text-primary line-clamp-2 mb-1 transition-colors group-hover:text-accent",children:s.title}),e.jsxs("div",{className:"flex items-center text-xs text-secondary",children:[e.jsx(L,{className:"h-3 w-3 mr-1.5"}),new Date(s.created_at).toLocaleDateString("vi-VN")]})]})]},s.id))})]})})]})}):e.jsx("p",{className:"text-center text-secondary py-8",children:"Không tìm thấy bài viết."})}export{J as default};
