import{c as R,r,j as e,p as Q,q as X,C as G,s as J,X as W,e as E}from"./index-BDAcJp4Y.js";import{y as b}from"./index-Dgh-o5Dl.js";import{D as Y}from"./react-datepicker-CQ5IvY2E.js";import{M as Z}from"./mail-DmgTA-FO.js";import{S as ee}from"./save-DMv6XSqM.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],v=R("camera",ae);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],ce=R("pen-line",te),i=({icon:s,label:d,isEditing:l,type:u="text",previewImage:t,onImageChange:f,value:c,onChange:o,...m})=>{const p=s;return u==="file"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:d}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-secondary z-10",children:e.jsx(p,{size:18})}),e.jsx("input",{type:"file",disabled:!l,className:`w-full rounded-lg px-4 py-3 pl-12 bg-input text-input border-themed transition-all duration-200
                          ${l?"border-hover cursor-pointer":"bg-background cursor-not-allowed opacity-50"}`,onChange:f,accept:"image/*",...m})]}),t&&t.trim()!==""&&t!=="undefined"?e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:t,alt:d,className:"w-32 h-24 object-cover rounded-lg border-2 border-themed",onError:h=>{console.log(`Error loading image: ${t}`),h.target.style.display="none"}})}):e.jsx("div",{className:"mt-3 text-center py-8 border-2 border-dashed border-themed rounded-lg bg-background",children:e.jsx("p",{className:"text-secondary text-sm",children:"Chưa có ảnh"})})]})]}):u==="date"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:d}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-secondary z-10",children:e.jsx(p,{size:18})}),e.jsx(Y,{selected:c?new Date(c):null,onChange:o,disabled:!l,dateFormat:"yyyy-MM-dd",placeholderText:"Chọn ngày",className:`w-full rounded-lg px-4 py-3 pl-12 bg-input text-input border-themed transition-all duration-200
                        ${l?"border-hover cursor-pointer":"bg-background cursor-not-allowed opacity-50"}`,wrapperClassName:"w-full",popperClassName:"z-50",...m})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-secondary mb-2",children:d}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-secondary",children:e.jsx(p,{size:18})}),e.jsx("input",{type:u,readOnly:!l,value:c||"",onChange:o,className:`w-full rounded-lg px-4 py-3 pl-12 bg-input text-input border-themed transition-all duration-200
                        ${l?"border-hover":"bg-background cursor-not-allowed"}`,...m})]})]})};function ie(){const[s,d]=r.useState(!1),[l,u]=r.useState(!1),[t,f]=r.useState({username:"...",email:"",phone:"",avatar_url:"",cccd_number:"",cccd_frontend:"",cccd_backend:"",cccd_created_at:""}),[c,o]=r.useState({}),[m,p]=r.useState(null),[h,C]=r.useState(null),[N,k]=r.useState(null),[I,g]=r.useState(""),[M,y]=r.useState(""),[T,j]=r.useState(""),w=r.useRef(null),D=async()=>{try{const a=await E.get("/user/profile"),{username:n,email:x,phone:S,avatar_url:F,cccd_number:L,cccd_frontend_url:U,cccd_backend_url:P,cccd_created_at:z}=a.data;f({username:n,email:x||"",phone:S||"",avatar_url:F||"",cccd_number:L||"",cccd_frontend:U||"",cccd_backend:P||"",cccd_created_at:z||""}),o({email:x||"",phone:S||"",cccd_number:L||"",cccd_created_at:z||""}),g(F||""),y(U||""),j(P||"")}catch(a){console.error("Error fetching user data:",a),b.error("Không thể tải thông tin người dùng.")}},B=async()=>{try{u(!0);const a=new FormData;a.append("email",c.email),a.append("phone",c.phone||""),a.append("cccd_number",c.cccd_number||""),a.append("cccd_created_at",c.cccd_created_at||""),m?a.append("avatar",m):t.avatar_url&&a.append("avatar_url",t.avatar_url),h?a.append("cccd_frontend",h):t.cccd_frontend&&a.append("cccd_frontend_url",t.cccd_frontend),N?a.append("cccd_backend",N):t.cccd_backend&&a.append("cccd_backend_url",t.cccd_backend),await E.post("/user/profile-update",a,{headers:{"Content-Type":"multipart/form-data"}}),await D(),d(!1),_(),b.success("Cập nhật thông tin thành công!")}catch(a){if(console.error("Error updating user data:",a),a.response&&a.response.status===422){const n=a.response.data.errors;for(const x in n)b.error(n[x][0])}else b.error("Cập nhật thông tin thất bại. Vui lòng thử lại.")}finally{u(!1)}},_=()=>{p(null),C(null),k(null),g(t.avatar_url||""),y(t.cccd_frontend||""),j(t.cccd_backend||"")};r.useEffect(()=>{D()},[]);const O=()=>{d(!0),o({email:t.email,phone:t.phone,cccd_number:t.cccd_number,cccd_created_at:t.cccd_created_at}),_()},$=()=>{d(!1),_()},A=async()=>{await B()},q=()=>{var a;s&&((a=w.current)==null||a.click())},H=a=>{const n=a.target.files[0];n&&(p(n),g(URL.createObjectURL(n)))},V=a=>{const n=a.target.files[0];n&&(C(n),y(URL.createObjectURL(n)))},K=a=>{const n=a.target.files[0];n&&(k(n),j(URL.createObjectURL(n)))};return e.jsxs("section",{className:"section-bg p-6 md:p-8 rounded-2xl shadow-lg",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between pb-6 border-b border-themed",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-2xl md:text-3xl font-bold text-primary",children:"Thông tin tài khoản"}),e.jsx("p",{className:"text-secondary mt-1",children:"Quản lý và bảo mật thông tin cá nhân của bạn."})]}),!s&&e.jsxs("button",{onClick:O,disabled:l,className:"action-button action-button-primary mt-4 sm:mt-0 !w-auto",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Chỉnh sửa"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 pt-8",children:[e.jsxs("div",{className:"lg:col-span-1 flex flex-col items-center text-center",children:[e.jsxs("div",{className:"relative group w-40 h-40",children:[e.jsx("img",{src:I||"/default-avatar.png",alt:"Avatar",className:"w-full h-full object-cover rounded-full ring-4 ring-offset-4 ring-offset-content-bg ring-accent/70",onError:a=>{a.target.src="/default-avatar.png"}}),s&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:q,className:"absolute inset-0 bg-black/60 rounded-full flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:e.jsx(v,{size:24})}),e.jsx("input",{type:"file",ref:w,className:"hidden",accept:"image/*",onChange:H})]})]}),e.jsx("p",{className:"text-secondary text-sm mt-4",children:"Ảnh đại diện của bạn."})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(i,{icon:Q,label:"Tên đăng nhập",isEditing:!1,value:t.username,placeholder:"Tên đăng nhập"}),e.jsx(i,{icon:Z,label:"Địa chỉ Email",isEditing:s,name:"email",type:"email",value:c.email||"",onChange:a=>o({...c,email:a.target.value}),placeholder:"example@email.com"}),e.jsx(i,{icon:X,label:"Số điện thoại",isEditing:s,name:"phone",type:"tel",value:c.phone||"",onChange:a=>o({...c,phone:a.target.value}),placeholder:"0123 456 789"}),e.jsx(i,{icon:G,label:"Số CCCD",isEditing:s,name:"cccd_number",type:"text",value:c.cccd_number||"",onChange:a=>o({...c,cccd_number:a.target.value}),placeholder:"Nhập số CCCD"}),e.jsx(i,{icon:v,label:"Ảnh mặt trước CCCD",isEditing:s,type:"file",previewImage:M,onImageChange:V}),e.jsx(i,{icon:v,label:"Ảnh mặt sau CCCD",isEditing:s,type:"file",previewImage:T,onImageChange:K}),e.jsx(i,{icon:J,label:"Ngày cấp",isEditing:s,type:"date",value:c.cccd_created_at,onChange:a=>o({...c,cccd_created_at:a?a.toISOString().split("T")[0]:""}),placeholder:"Chọn ngày"}),s&&e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsxs("button",{onClick:$,disabled:l,className:"action-button action-button-secondary !w-auto",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Hủy"]}),e.jsxs("button",{onClick:A,disabled:l,className:"action-button action-button-primary !w-auto",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),l?"Đang lưu...":"Lưu thay đổi"]})]})]})]})]})}export{ie as default};
