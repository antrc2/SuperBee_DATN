import{r,h as w,j as e,g as F,L as _}from"./index-CBuA2RNo.js";const S="/admin/authorization/roles",q="/admin/authorization/permissions";function M({role:s,onSave:h,onCancel:u}){const[b,l]=r.useState(""),[c,x]=r.useState("");r.useEffect(()=>{s?(l(s.name||""),x(s.description||"")):(l(""),x(""))},[s]);const y=m=>{m.preventDefault(),h({id:s==null?void 0:s.id,name:b,description:c})};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-8 border border-transparent dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-700 dark:text-gray-200",children:s?"Chỉnh sửa vai trò":"Tạo vai trò mới"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"roleName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tên vai trò (không dấu, không khoảng trắng)"}),e.jsx("input",{id:"roleName",type:"text",value:b,onChange:m=>l(m.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",placeholder:"vi-du: sales_manager",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"roleDescription",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Mô tả"}),e.jsx("input",{id:"roleDescription",type:"text",value:c,onChange:m=>x(m.target.value),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400",placeholder:"Mô tả ngắn về vai trò này"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[s&&e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 dark:bg-gray-600 dark:text-gray-200 dark:border-gray-500 dark:hover:bg-gray-700",children:"Hủy"}),e.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800",children:s?"Lưu thay đổi":"Tạo mới"})]})]})]})}function O({groupName:s,permissions:h,selectedPermissions:u,onCheckboxChange:b,onSelectAllChange:l}){const[c,x]=r.useState(!0),y=h.map(t=>t.name),m=y.length>0&&y.every(t=>u.includes(t));return e.jsxs("div",{className:"border border-gray-200 rounded-md mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 cursor-pointer hover:bg-gray-100",onClick:()=>x(!c),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-3",checked:m,onChange:t=>l(y,t.target.checked),onClick:t=>t.stopPropagation()}),e.jsx("h3",{className:"font-semibold text-gray-700",children:s})]}),e.jsx("span",{className:`transform transition-transform ${c?"rotate-180":""}`,children:"▼"})]}),c&&e.jsx("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:h.map(t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:`perm-${t.id}`,type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:u.includes(t.name),onChange:()=>b(t.name)}),e.jsx("label",{htmlFor:`perm-${t.id}`,className:"ml-2 block text-sm text-gray-900 font-mono",children:t.description||t.name.split(".")[1]||t.name})]},t.id))})]})}function z({role:s,allPermissions:h,onClose:u,onSave:b,isSaving:l}){const[c,x]=r.useState([]);r.useEffect(()=>{s&&s.permissions&&x(s.permissions.map(i=>i.name))},[s]);const y=i=>{x(d=>d.includes(i)?d.filter(k=>k!==i):[...d,i])},m=(i,d)=>{x(k=>{const f=k.filter(C=>!i.includes(C));return d?[...f,...i]:f})},t=()=>{b(s.id,c)};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold mb-4",children:["Gán quyền cho vai trò:"," ",e.jsx("span",{className:"text-indigo-600",children:s.name})]}),e.jsx("div",{className:"flex-grow overflow-y-auto pr-2 border-t border-b py-4",children:Object.entries(h).map(([i,d])=>e.jsx(O,{groupName:i,permissions:d,selectedPermissions:c,onCheckboxChange:y,onSelectAllChange:m},i))}),e.jsxs("div",{className:"flex justify-end gap-4 mt-auto pt-4",children:[e.jsx("button",{onClick:u,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Hủy"}),e.jsx("button",{onClick:t,disabled:l,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300",children:l?"Đang lưu...":"Lưu thay đổi"})]})]})}):null}function G({isOpen:s,onClose:h,onConfirm:u,title:b,message:l}){return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:b}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:l}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Hủy"}),e.jsx("button",{onClick:u,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700",children:"Xác nhận"})]})]})}):null}function V(){const[s,h]=r.useState([]),[u,b]=r.useState({}),[l,c]=r.useState(!0),[x,y]=r.useState(!1),[m,t]=r.useState(""),[i,d]=r.useState(""),[k,f]=r.useState(null),[C,L]=r.useState(null),[j,P]=r.useState(null),D=()=>{setTimeout(()=>{t(""),d("")},3e3)},v=r.useCallback(async()=>{var a,g;c(!0);try{const[n,o]=await Promise.all([w.get(S),w.get(q)]);n.data.status?h(n.data.data):t(n.data.message||"Không thể tải danh sách vai trò."),o.data.status?b(o.data.data):t(o.data.message||"Không thể tải danh sách quyền.")}catch(n){t(((g=(a=n.response)==null?void 0:a.data)==null?void 0:g.message)||"Không thể tải dữ liệu. Vui lòng thử lại.")}finally{c(!1)}},[]);r.useEffect(()=>{v()},[v]);const A=async({id:a,name:g,description:n})=>{var E,$;d(""),t("");const o=!!a,p=o?`${S}/${a}`:S,R=new FormData;R.append("name",g),n&&R.append("description",n),o&&R.append("_method","PUT");try{const N=await w.post(p,R);N.data.status?(d(N.data.message),f(null),v()):t(N.data.message||"Đã có lỗi xảy ra.")}catch(N){t((($=(E=N.response)==null?void 0:E.data)==null?void 0:$.message)||`Lỗi khi ${o?"cập nhật":"tạo"} vai trò.`)}finally{D()}},I=async()=>{var a,g;if(j){d(""),t("");try{const n=new FormData;n.append("_method","DELETE");const o=await w.post(`${S}/${j.id}`,n);o.data.status?(d(o.data.message),v()):t(o.data.message)}catch(n){t(((g=(a=n.response)==null?void 0:a.data)==null?void 0:g.message)||"Lỗi khi xóa vai trò.")}finally{P(null),D()}}},T=async(a,g)=>{var n,o;y(!0),d(""),t("");try{const p=await w.post(`${S}/${a}/permissions`,{permissions:g});p.data.status?(d(p.data.message),L(null),v()):t(p.data.message)}catch(p){t(((o=(n=p.response)==null?void 0:n.data)==null?void 0:o.message)||"Lỗi khi gán quyền cho vai trò.")}finally{y(!1),D()}};return l?e.jsx(F,{}):e.jsxs("div",{className:"container mx-auto p-4 md:p-6 bg-gray-100 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:" dark:bg-gray-900 flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 dark:text-gray-200  uppercase",children:"Quản lý Vai trò (Roles)"}),e.jsx(_,{to:"/admin/authorization",className:"px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:"← Về Dashboard"})]}),m&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:m}),i&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert",children:i}),e.jsx(M,{role:k,onSave:A,onCancel:()=>f(null)}),e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Vai trò"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Quyền hạn"}),e.jsx("th",{className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Hành động"})})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:s.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:a.description})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-md",children:[a.permissions.length>0?a.permissions.slice(0,5).map(g=>e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300",children:g.name},g.id)):e.jsx("span",{className:"text-gray-400 italic",children:"Chưa có quyền"}),a.permissions.length>5&&e.jsxs("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200",children:["+",a.permissions.length-5]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>L(a),className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200",children:"Gán quyền"}),e.jsx("button",{onClick:()=>f(a),className:"px-3 py-1 text-xs bg-yellow-100 text-yellow-700 rounded-md hover:bg-yellow-200",children:"Sửa"}),e.jsx("button",{onClick:()=>P(a),className:"px-3 py-1 text-xs bg-red-100 text-red-700 rounded-md hover:bg-red-200",children:"Xóa"})]})]},a.id))})]})}),C&&e.jsx(z,{role:C,allPermissions:u,onClose:()=>L(null),onSave:T,isSaving:x}),e.jsx(G,{isOpen:!!j,onClose:()=>P(null),onConfirm:I,title:"Xác nhận xóa vai trò",message:`Bạn có chắc chắn muốn xóa vai trò "${j==null?void 0:j.name}"?`})]})}export{V as default};
