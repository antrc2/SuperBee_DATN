import{r,e as k,j as e,o as A,m as I}from"./index-BDAcJp4Y.js";const C="/admin/authorization/roles",$="/admin/authorization/permissions";function D({groupName:d,permissions:m,selectedPermissions:x,onCheckboxChange:u,onSelectAllChange:g}){const[c,b]=r.useState(!0),h=m.map(s=>s.name),y=h.length>0&&h.every(s=>x.includes(s));return e.jsxs("div",{className:"border border-gray-200 rounded-md mb-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 cursor-pointer hover:bg-gray-100",onClick:()=>b(!c),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-3",checked:y,onChange:s=>g(h,s.target.checked),onClick:s=>s.stopPropagation()}),e.jsx("h3",{className:"font-semibold text-gray-700",children:d})]}),e.jsx("span",{className:`transform transition-transform ${c?"rotate-180":""}`,children:"▼"})]}),c&&e.jsx("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:m.map(s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:`perm-${s.id}`,type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:x.includes(s.name),onChange:()=>u(s.name)}),e.jsx("label",{htmlFor:`perm-${s.id}`,className:"ml-2 block text-sm text-gray-900 font-mono",children:s.description||s.name.split(".")[1]||s.name})]},s.id))})]})}function O({role:d,allPermissions:m,onClose:x,onSave:u,isSaving:g}){const[c,b]=r.useState([]);r.useEffect(()=>{d&&d.permissions&&b(d.permissions.map(a=>a.name))},[d]);const h=a=>{b(n=>n.includes(a)?n.filter(j=>j!==a):[...n,a])},y=(a,n)=>{b(j=>{const w=j.filter(v=>!a.includes(v));return n?[...w,...a]:w})},s=()=>{u(d.id,c)};return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[20] flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full max-h-[80vh] flex flex-col",children:[e.jsx("div",{className:"flex-grow overflow-y-auto pr-2 border-t border-b py-4",children:Object.entries(m).map(([a,n])=>e.jsx(D,{groupName:a,permissions:n,selectedPermissions:c,onCheckboxChange:h,onSelectAllChange:y},a))}),e.jsxs("div",{className:"flex justify-end gap-4 mt-auto pt-4",children:[e.jsx("button",{onClick:x,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Hủy"}),e.jsx("button",{onClick:s,disabled:g,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300",children:g?"Đang lưu...":"Lưu thay đổi"})]})]})}):null}function z({isOpen:d,onClose:m,onConfirm:x,title:u,message:g}){return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:u}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:g}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Hủy"}),e.jsx("button",{onClick:x,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700",children:"Xác nhận"})]})]})}):null}function q(){const[d,m]=r.useState([]),[x,u]=r.useState({}),[g,c]=r.useState(!0),[b,h]=r.useState(!1),[y,s]=r.useState(""),[a,n]=r.useState(""),[j,w]=r.useState(null),[v,S]=r.useState(null),[p,R]=r.useState(null),P=()=>{setTimeout(()=>{s(""),n("")},3e3)},N=r.useCallback(async()=>{var t,l;c(!0);try{const[i,o]=await Promise.all([k.get(C),k.get($)]);i.data.status?m(i.data.data):s(i.data.message||"Không thể tải danh sách vai trò."),o.data.status?u(o.data.data):s(o.data.message||"Không thể tải danh sách quyền.")}catch(i){s(((l=(t=i.response)==null?void 0:t.data)==null?void 0:l.message)||"Không thể tải dữ liệu. Vui lòng thử lại.")}finally{c(!1)}},[]);r.useEffect(()=>{N()},[N]);const E=async()=>{var t,l;if(p){n(""),s("");try{const i=new FormData;i.append("_method","DELETE");const o=await k.post(`${C}/${p.id}`,i);o.data.status?(n(o.data.message),N()):s(o.data.message)}catch(i){s(((l=(t=i.response)==null?void 0:t.data)==null?void 0:l.message)||"Lỗi khi xóa vai trò.")}finally{R(null),P()}}},L=async(t,l)=>{var i,o;h(!0),n(""),s("");try{const f=await k.post(`${C}/${t}/permissions`,{permissions:l});f.data.status?(n(f.data.message),S(null),N()):s(f.data.message)}catch(f){s(((o=(i=f.response)==null?void 0:i.data)==null?void 0:o.message)||"Lỗi khi gán quyền cho vai trò.")}finally{h(!1),P()}};return g?e.jsx(A,{}):e.jsxs("div",{className:"container mx-auto p-4 md:p-6 bg-gray-100 dark:bg-gray-900 min-h-screen",children:[e.jsxs("div",{className:" dark:bg-gray-900 flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 dark:text-gray-200  uppercase",children:"Quản lý Vai trò (Roles)"}),e.jsx(I,{to:"/admin/authorization",className:"px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors",children:"← Về Dashboard"})]}),y&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:y}),a&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",role:"alert",children:a}),e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Vai trò"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Quyền hạn"}),e.jsx("th",{className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Hành động"})})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:d.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/40 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:t.description})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-md",children:[t.permissions.length>0?t.permissions.slice(0,5).map(l=>e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300",children:l.name},l.id)):e.jsx("span",{className:"text-gray-400 italic",children:"Chưa có quyền"}),t.permissions.length>5&&e.jsxs("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200",children:["+",t.permissions.length-5]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:e.jsx("button",{onClick:()=>S(t),className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200",children:"Gán quyền"})})]},t.id))})]})}),v&&e.jsx(O,{role:v,allPermissions:x,onClose:()=>S(null),onSave:L,isSaving:b}),e.jsx(z,{isOpen:!!p,onClose:()=>R(null),onConfirm:E,title:"Xác nhận xóa vai trò",message:`Bạn có chắc chắn muốn xóa vai trò "${p==null?void 0:p.name}"?`})]})}export{q as default};
