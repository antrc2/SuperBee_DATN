import{j as e,ar as k,n as w,as as f,r as g,X as _,e as v}from"./index-BDAcJp4Y.js";import{P as S}from"./Product-DsRugYZ5.js";import{B as P}from"./Breadcrumbs-MjFt3emo.js";import{F as I}from"./funnel-1AEyEKEx.js";import"./recharge-7Wy_Gsf5.js";function R(){return e.jsxs("div",{className:"bg-content rounded-xl border border-themed overflow-hidden h-full animate-pulse",children:[e.jsx("div",{className:"h-[160px] bg-primary/10"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-4 bg-primary/20 rounded w-3/4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-primary/10 rounded w-full"}),e.jsx("div",{className:"h-3 bg-primary/10 rounded w-5/6"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsx("div",{className:"h-6 bg-highlight/20 rounded w-1/3"}),e.jsx("div",{className:"h-8 w-8 bg-highlight/20 rounded-full"})]})]})]})}function y(t,i=""){return t.children&&t.children.length>0?[e.jsx("option",{value:t.id,disabled:!0,children:i+t.name},t.id),...t.children.map(u=>y(u,i+"— "))]:e.jsx("option",{value:t.id,children:i+t.name},t.id)}function T({categories:t,initialFilters:i,onApplyFilters:u}){const[l,x]=g.useState(i),[d,r]=g.useState(""),[p,m]=g.useState("");g.useEffect(()=>{if(i.min_price&&i.max_price){const s=Number(i.min_price),a=Number(i.max_price);m(s===0&&a===5e5?"under500k":s===5e5&&a===1e6?"500k-1m":s===1e6&&a===5e6?"1m-5m":s===5e6&&a===1e7?"5m+":s===1e7&&a===5e7?"10m+":s===5e7&&a===99999999?"50m+":"")}else m("")},[i]);const j=s=>{const a=s.target.value;m(a);let c="",o="";a==="under500k"?(c=0,o=5e5):a==="500k-1m"?(c=5e5,o=1e6):a==="1m-5m"?(c=1e6,o=5e6):a==="5m+"?(c=5e6,o=1e7):a==="10m+"?(c=1e7,o=5e7):a==="50m+"&&(c=5e7,o=99999999),x(N=>({...N,min_price:c,max_price:o}))};g.useEffect(()=>{x(i),r("")},[i]);const b=s=>{const{name:a,value:c}=s.target;x(o=>({...o,[a]:c})),r("")},n=()=>{const s=Number(l.min_price),a=Number(l.max_price),c=1e8;if(l.min_price&&l.max_price&&s>a){r("Giá tối thiểu phải nhỏ hơn giá tối đa.");return}if(l.max_price&&a>c){r(`Giá tối đa không được vượt quá ${c.toLocaleString()}đ.`);return}r(""),u(l)},h=()=>{const s={key:"",sku:"",categoryId:"",min_price:"",max_price:"",sortBy:"newest",page:1};x(s),r(""),u(s)};return e.jsx("aside",{className:"w-full lg:w-1/4 space-y-6",children:e.jsxs("div",{className:"bg-content p-6 rounded-xl border-themed space-y-4",children:[e.jsxs("h3",{className:"font-heading text-xl font-semibold text-primary flex items-center gap-2",children:[e.jsx(I,{className:"text-highlight"}),"Bộ Lọc Tìm Kiếm"]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sku",className:"block text-sm font-medium text-primary mb-1",children:"Mã sản phẩm (SKU)"}),e.jsx("input",{type:"text",id:"sku",name:"sku",value:l.sku||"",onChange:b,placeholder:"Nhập mã SKU...",className:"block w-full px-4 py-2 text-sm rounded-lg border-hover bg-input text-input"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"categoryId",className:"block text-sm font-medium text-primary mb-1",children:"Danh mục game"}),e.jsxs("select",{id:"categoryId",name:"categoryId",value:l.categoryId||"",onChange:b,className:"block w-full px-4 py-2 text-sm rounded-lg border-hover bg-input text-input",children:[e.jsx("option",{value:"",children:"Tất cả danh mục"}),t.map(s=>e.jsx("optgroup",{label:s.name,children:s.children&&s.children.length>0?s.children.map(a=>y(a)):e.jsx("option",{value:s.id,disabled:!0,children:s.name},s.id)},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priceRange",className:"block text-sm font-medium text-primary mb-1",children:"Khoảng giá"}),e.jsxs("select",{id:"priceRange",name:"priceRange",value:p,onChange:j,className:"block w-full px-4 py-2 text-sm rounded-lg border-hover bg-input text-input",children:[e.jsx("option",{value:"",children:"Tất cả giá"}),e.jsx("option",{value:"under500k",children:"Dưới 500.000đ"}),e.jsx("option",{value:"500k-1m",children:"500.000đ - 1.000.000đ"}),e.jsx("option",{value:"1m-5m",children:"1.000.000đ - 5.000.000đ"}),e.jsx("option",{value:"5m+",children:"5.000.000đ - 10.000.000đ"}),e.jsx("option",{value:"10m+",children:"10.000.000đ - 50.000.000đ"}),e.jsx("option",{value:"50m+",children:"Trên 50.000.000đ"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx("button",{onClick:n,className:"action-button action-button-primary flex-1",children:"Áp dụng"}),e.jsx("button",{onClick:h,className:"action-button action-button-secondary p-3",children:e.jsx(_,{size:16})})]})]})})}const L=t=>f({queryKey:["products_search",t],queryFn:async()=>{const i=Object.fromEntries(Object.entries(t).filter(([x,d])=>d!=null&&d!=="")),u=new URLSearchParams(i),{data:l}=await v.get(`/home/products?${u}`);return l},keepPreviousData:!0}),C=()=>f({queryKey:["categories"],queryFn:async()=>{const{data:t}=await v.get("/categories");return t.data.treeCategories},staleTime:1e3*60*5});function U(){const[t,i]=k(),{homeData:u}=w(),{data:l=[],isLoading:x}=C(),d={key:t.get("key")||"",sku:t.get("sku")||"",categoryId:t.get("categoryId")||"",min_price:t.get("min_price")||"",max_price:t.get("max_price")||"",sortBy:t.get("sortBy")||"newest",page:parseInt(t.get("page")||"1",10)},{data:r,isLoading:p}=L(d),m=n=>{n.page=1,i(n)},j=n=>{if(n&&n!==d.page){const h=new URLSearchParams(t);h.set("page",n),i(h)}},b=[{label:"Trang chủ",href:"/"},{label:"Tìm kiếm sản phẩm"}];return e.jsxs("div",{className:"max-w-screen-xl mx-auto min-h-screen ",children:[e.jsx(P,{items:b}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 mt-6",children:[e.jsx(T,{categories:l,initialFilters:d,onApplyFilters:m}),e.jsxs("main",{className:"w-full lg:w-3/4 px-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4 bg-content p-3 rounded-xl border-themed",children:e.jsxs("div",{className:"text-sm text-secondary mb-2 sm:mb-0",children:[e.jsx("span",{children:"Tìm thấy "}),e.jsx("strong",{className:"text-primary",children:(r==null?void 0:r.total)||0}),e.jsx("span",{children:" kết quả"}),d.key&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:" cho "}),e.jsxs("strong",{className:"text-highlight",children:['"',d.key,'"']})]})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p?Array.from({length:12}).map((n,h)=>e.jsx(R,{},h)):r==null?void 0:r.data.map(n=>e.jsx(S,{product:n},n.id))}),!p&&(r==null?void 0:r.data.length)===0&&e.jsx("div",{className:"text-center py-16 bg-content rounded-lg",children:e.jsx("p",{className:"text-secondary",children:"Không tìm thấy sản phẩm nào."})}),r&&r.last_page>1&&e.jsx("div",{className:"flex justify-center items-center gap-2 mt-8",children:r.links.map((n,h)=>{const s=n.url?new URL(n.url).searchParams.get("page"):null;return e.jsx("button",{onClick:()=>j(s),disabled:!n.url||p,dangerouslySetInnerHTML:{__html:n.label},className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${n.active?"bg-primary text-white shadow-md":"bg-card hover:bg-gray-200 dark:hover:bg-gray-700"} ${n.url?"":"text-gray-400 cursor-not-allowed opacity-50"}`},h)})})]})]})]})}export{U as default};
