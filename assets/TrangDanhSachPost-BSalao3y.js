import{j as e,L as P,E as D,s as K,u as _,r as i,d as O,m as U,h as p,g as z}from"./index-b9nMIW9s.js";import{L as H}from"./Layout-BvMI2kQB.js";import{F as M}from"./file-pen-line-eNEtVEuj.js";import{K as X}from"./key-Dccaqhcf.js";import"./plus-CKLTUpDc.js";import"./funnel-CD6nwXoW.js";function I({posts:c,handleKey:u,handleLock:x}){const m=(a,l)=>typeof a!="string"?"":a.length<=l?a:a.substring(0,l)+"...",b=a=>a?new Date(a).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}):"Không xác định",g=Array.isArray(c)?c:[];return e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full bg-white dark:bg-gray-800",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-4 text-left text-xs sm:text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"STT"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs sm:text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Tiêu đề"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs sm:text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Danh mục"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs sm:text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Ngày tạo"}),e.jsx("th",{className:"py-3 px-4 text-left text-xs sm:text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Trạng thái"}),e.jsx("th",{className:"py-3 px-4 text-center text-xs sm:text-sm font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Hành động"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"py-8 px-4 text-center text-gray-500 dark:text-gray-400",children:"Không có bài viết nào để hiển thị."})}):g.map((a,l)=>{var d;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"py-3 px-4 text-sm text-gray-700 dark:text-gray-300",children:l+1}),e.jsx("td",{className:"py-3 px-4 text-sm font-medium text-gray-900 dark:text-gray-100",children:m(a.title,60)}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-300",children:((d=a.category)==null?void 0:d.name)||"Không có"}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600 dark:text-gray-300",children:b(a.created_at)}),e.jsx("td",{className:"py-3 px-4 text-sm",children:e.jsx("span",{className:`px-2.5 py-1 text-xs font-semibold rounded-full ${a.status===1?"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":a.status===2?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":a.status===0?"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300":"bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200"}`,children:a.status===1?"Xuất bản":a.status===2?"Lưu trữ":a.status===0?"Nháp":"Không rõ"})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx(P,{to:`/admin/post/${a.slug}`,title:"Xem chi tiết",children:e.jsx(D,{className:"text-gray-500 hover:text-green-600 dark:hover:text-green-400 cursor-pointer transition-colors",size:18})}),e.jsx(P,{to:`/admin/post/${a.slug}/edit`,title:"Chỉnh sửa",children:e.jsx(M,{className:"text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 cursor-pointer transition-colors",size:18})}),a.status===1?e.jsx("button",{onClick:()=>x(a.id),title:"Hủy xuất bản",children:e.jsx(K,{className:"text-gray-500 hover:text-red-600 dark:hover:text-red-400 cursor-pointer transition-colors",size:18})}):e.jsx("button",{onClick:()=>u(a.id),title:"Xuất bản",children:e.jsx(X,{className:"text-gray-500 hover:text-yellow-600 dark:hover:text-yellow-400 cursor-pointer transition-colors",size:18})})]})})]},a.id)})})]})})}const S=[{name:"status",type:"select",label:"Trạng thái",options:[{value:"",label:"Tất cả"},{value:"0",label:"Nháp"},{value:"1",label:"Đã xuất bản"},{value:"2",label:"Lưu trữ"}]}],V=["title"],Z=()=>{const{pop:c,conFim:u}=_(),[x,m]=i.useState([]),[b,g]=i.useState(null),[a,l]=i.useState(!0),[d,L]=i.useState(""),[f,A]=i.useState(!1),y=O(),h=U(),w=i.useMemo(()=>{const t=new URLSearchParams(h.search),s={};return S.forEach(r=>{t.has(r.name)&&(s[r.name]=t.get(r.name))}),t.forEach((r,n)=>{s.hasOwnProperty(n)||(s[n]=r)}),s},[h.search]),k=i.useCallback(async()=>{var t,s,r;l(!0);try{const n=new URLSearchParams(h.search),o=await p.get("/admin/post",{params:n}),F=Array.isArray((s=(t=o.data)==null?void 0:t.data)==null?void 0:s.data)?o.data.data.data:[],v=(r=o.data)!=null&&r.data?{...o.data.data}:{};delete v.data,m(F),g(v)}catch(n){console.error("Lỗi khi tải dữ liệu:",n),c("Lấy danh sách bài viết thất bại","e"),m([]),g(null)}finally{l(!1)}},[h.search,c]),j=i.useCallback(async()=>{var t;try{const r=(t=(await p.get("/admin/post/business")).data)==null?void 0:t.data;A((r==null?void 0:r.auto_post)===1)}catch(s){console.error("Lỗi khi lấy trạng thái auto_post:",s)}},[]);i.useEffect(()=>{k(),j()},[k,j]);const C=t=>{const r=new URLSearchParams(h.search).get("page"),n=new URLSearchParams;r&&n.set("page",r);for(const o in t)t[o]&&n.set(o,t[o]);y({search:n.toString()})},E=()=>{y({search:""}),L("")},T=t=>{const s=new URLSearchParams(h.search);s.set("page",t),y({search:s.toString()})},$=i.useMemo(()=>{if(!d)return x||[];const t=d.toLowerCase();return x.filter(s=>V.some(r=>{var n;return(n=s[r])==null?void 0:n.toString().toLowerCase().includes(t)}))},[x,d]),R=()=>y("/admin/post/new"),N=async(t,s,r)=>{if(await u(r))try{const o=`/admin/post/${s}/${t}`;await p.patch(o),k(),c(`${t==="publish"?"Xuất bản":"Lưu trữ"} thành công`,"s")}catch(o){c(`Lỗi khi ${t==="publish"?"xuất bản":"lưu trữ"} bài viết`,"e"),console.error(`Lỗi khi thực hiện hành động ${t}:`,o)}},B=async()=>{const t=f?"hủy":"bật",s=f?"/admin/post/RefreshAuto":"/admin/post/auto";if(await u(`Bạn có chắc muốn ${t} tự động đăng bài?`))try{await p.post(s),c(`Đã ${t} tự động đăng bài thành công.`,"s"),j()}catch(n){c(`Lỗi khi ${t} tự động đăng bài.`,"e"),console.error(`Lỗi khi ${t} tự động đăng bài:`,n)}};return a?e.jsx(z,{}):e.jsx(H,{title:"Danh sách bài viết",showBackButton:!1,showAddButton:!0,showAuToPost:!0,autoPostButtonLabel:f?"Hủy tự động đăng":"Bật tự động đăng",onshow:B,onAdd:R,onLocalSearch:L,initialSearchTermLocal:d,onApplyFilters:C,onResetFilters:E,initialFilters:w,filterConfig:S,activeFilterCount:Object.keys(w).filter(t=>t!=="page").length,paginationMeta:b,onPageChange:T,children:e.jsx(I,{posts:$,handleKey:t=>N("publish",t,"Bạn có chắc muốn xuất bản bài viết này?"),handleLock:t=>N("unpublish",t,"Bạn có chắc muốn lưu trữ bài viết này?")})})};export{Z as default};
